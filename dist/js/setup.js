"use strict";var _slicedToArray=function(){function e(e,t){var a=[],s=!0,n=!1,r=void 0;try{for(var l,d=e[Symbol.iterator]();!(s=(l=d.next()).done)&&(a.push(l.value),!(t&&a.length===t));s=!0);}catch(e){n=!0,r=e}finally{try{!s&&d["return"]&&d["return"]()}finally{if(n)throw r}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();chrome.runtime.sendMessage({request:"valid_site"});var dlog={ERROR:1,WARN:2,LOG:3,INFO:4,DEBUG:5,VERBOSE:6,empty:function(){},set level(e){this.error=e>=this.ERROR?function(){}:this.empty,this.warn=e>=this.WARN?function(){}:this.empty,this.log=e>=this.LOG?function(){}:this.empty,this.info=e>=this.INFO?function(){}:this.empty,this.debug=e>=this.DEBUG?function(){}:this.empty,this.verbose=e>=this.VERBOSE?function(){}:this.empty,this.loggingLevel=e},get level(){return this.loggingLevel}};dlog.level=dlog.LOG,jQuery.noConflict();function isObj(e){return jQuery.isPlainObject(e)&&!jQuery.isEmptyObject(e)}function goodVal(e,a,s){return e.hasOwnProperty(a)&&jQuery.type(e[a])===s}function override(e,t,a){e[t]=a(e[t])}function applyAfter(e){return function(t){return function(){var a=t.apply(this,arguments);return e.apply(this,arguments),a}}}function applyBefore(e){return function(t){return function(){return e.apply(this,arguments),t.apply(this,arguments)}}}function applyCompose(e){return function(t){return function(){return e.call(this,t.apply(this,arguments))}}}var domParse=new DOMParser;function cleanHTML(e){var t=domParse.parseFromString(e,"text/html"),a=t.querySelectorAll("head, img, svg, link, style");return a.forEach(function(e){e.remove()}),t.documentElement.innerHTML}var storageUserSettingsKey="fp_user_settings";function clearStoredData(){chrome.storage.local.get(null,function(e){jQuery.each(e,function(e){e!==storageUserSettingsKey&&chrome.storage.local.remove(e)})})}var res_num=2;chrome.storage.local.get("fp_data_reset",function(e){e&&isObj(e)&&!(e<res_num)||(clearStoredData(),chrome.storage.local.set({fp_data_reset:res_num}))});var alldata,league_settings,custom_cols,observer,observer_disconned,league_id,league_settings_url,storage_translation_data,activity_data,activity_data_current_season_site,siteType,onMatchupPreviewPage,onClubhousePage,onFreeAgencyPage,onGeneralProjPage,storageLeagueKey,storageLeagueUpdateKey,storagePlayerKey,storageUpdateKey,storageUpdateTypeKey,storageTranslationKey,storageTranslationUpdateKey,playerTable,player_table_selector,player_table_body,player_table_body_selector,player_table_header,player_table_header_selector,player_table_rows,player_table_row_selector,proj_head,player_table_header_proj_selector,header_index,player_name_selector,base_table_selector,base_table,page_menu_selector,page_menu,pts_total_selector,pts_total,ld_selector,hasProjTotals,hasPlayerTable,hasProjectionTable,depth_data,depth_data_current_week,fetch_fail=!1,idp_fetch_fail=!1,depth_fail=!1,total_players=0,total_players_depth=0,user_settings={},updated_times={},updated_types={},updated_league=0,updated_depth=0,ajax_timeout=5e3,show_proj=!0,show_rank=!0,show_ros=!0,show_depth=!0,show_spark=!0,show_avg=!0,show_med=!0,show_current=!0,check_minutes=30,check_minutes_avg=1440,check_minutes_avg_done=20,check_minutes_avg_live=1,check_minutes_depth=120,experts={proj:{selection:["all"]},rank:{selection:["all"],num:{top:10,updated:1}},ros:{selection:["all"],num:{top:5,updated:7}}},remove_ads=!0,fix_css=!0,season_start_map={2014:[8,2],2015:[8,8],2016:[8,6],2017:[8,5],2018:[8,4]},expected_player={QB:{pass_yds:254.3,pass_tds:1.6,pass_ints:.83,pass_att:35.25,pass_cmp:22.18,rush_yds:13.82,rush_tds:.12,rush_att:3.35,fumbles:.18},RB:{rush_yds:45.53,rush_tds:.28,rush_att:10.95,rec_yds:16.07,rec_att:1.97,rec_tds:.07,fumbles:.07},WR:{rec_yds:49.83,rec_att:3.78,rec_tds:.31,fumbles:.03},TE:{rec_yds:31.61,rec_att:2.87,rec_tds:.26,fumbles:.02},"D/ST":{def_sack:2.33,def_ff:.86,def_int:.86,def_td:.21,def_fr:.6,def_pa:22.82,def_tyda:352.67,def_safety:.02},K:{xpt:2.16,fg:1.65,fga:1.95},LB:{Scks:.26,FumFrc:.08,Tack:4.11,Asst:1.78,PassDef:.22,Int:.04,DefTD:.01,Fum:.04},DL:{Scks:.32,FumFrc:.06,Tack:2.14,Asst:.95,PassDef:.1,Int:.01,DefTD:0,Fum:.03},DB:{Scks:.03,FumFrc:.05,Tack:3.84,Asst:.92,PassDef:.58,Int:.12,DefTD:.02,Fum:.03}},current_date=new Date,current_time=current_date.getTime(),current_month=current_date.getMonth(),current_year=current_date.getFullYear(),current_season=current_year,current_season_avg=current_year,current_season_avg_week=current_year;(5>current_month||!season_start_map[current_year]&&season_start_map[current_year-1])&&(current_season-=1);var seasonstart;try{seasonstart=new Date(current_season,season_start_map[current_season][0],season_start_map[current_season][1],4)}catch(t){throw"FantasyPlus: Season "+current_season+" does not exist in records"}var seasonstart_avg=seasonstart,seasonstart_avg_week=seasonstart,oneweekbefore=new Date(seasonstart.getTime());oneweekbefore.setDate(oneweekbefore.getDate()-7),current_date<oneweekbefore&&(current_season_avg-=1,seasonstart_avg=new Date(current_season_avg,season_start_map[current_season_avg][0],season_start_map[current_season_avg][1],4)),current_date<seasonstart&&(current_season_avg_week-=1,seasonstart_avg_week=new Date(current_season_avg_week,season_start_map[current_season_avg_week][0],season_start_map[current_season_avg_week][1],4));var current_week=Math.max(Math.ceil((current_date-seasonstart)/864e5/7),1),current_week_avg=Math.max(Math.ceil((current_date-seasonstart_avg_week)/864e5/7),1),team_abbrevs={"Seattle Seahawks":"SEA","Carolina Panthers":"CAR","Arizona Cardinals":"ARI","Denver Broncos":"DEN","Los Angeles Rams":"LAR","Houston Texans":"HOU","Kansas City Chiefs":"KC","Cincinnati Bengals":"CIN","New England Patriots":"NE","Minnesota Vikings":"MIN","New York Jets":"NYJ","Philadelphia Eagles":"PHI","Green Bay Packers":"GB","Buffalo Bills":"BUF","Pittsburgh Steelers":"PIT","Baltimore Ravens":"BAL","Oakland Raiders":"OAK","Jacksonville Jaguars":"JAC","Miami Dolphins":"MIA","Detroit Lions":"DET","Tennessee Titans":"TEN","Cleveland Browns":"CLE","San Francisco 49ers":"SF","New York Giants":"NYG","Chicago Bears":"CHI","Tampa Bay Buccaneers":"TB","Washington Redskins":"WAS","Atlanta Falcons":"ATL","Los Angeles Chargers":"LAC","Indianapolis Colts":"IND","New Orleans Saints":"NO","Dallas Cowboys":"DAL"},player_name_fix={"Stevie Johnson":"Steve Johnson","Ha Ha Clinton-Dix":"Hasean Clinton-Dix","Corey Brown":"Philly Brown","Boobie Dixon":"Anthony Dixon","Wil Lutz":"Will Lutz","MarQuies Gray":"MarQueis Gray","Jerry Attaochu":"Jeremiah Attaochu","Kahlil Mack":"Khalil Mack","Justin March-Lillard":"Justin March","Odell Beckham":"Odell Beckham Jr.","A.J. McCarron":"AJ McCarron","A.J. Derby":"AJ Derby","E.J. Manuel":"EJ Manuel","Jurell Casey":"Jurrell Casey","Johnathan Hankins":"Jonathan Hankins","Malcolm Brown":"Malcom Brown","Dante Fowler":"Dante Fowler Jr.","Vic Beasley Jr.":"Vic Beasley","Nickell Robey":"Nickell Robey-Coleman","Terrod Ward":"Terron Ward","Steven Hauschka":"Stephen Hauschka","Stephen Hauschka":"Steven Hauschka","Adoree' Jackson":"Adoree Jackson","Daniel Sorensen":"Daniel Sorenson"},player_name_translations={Christopher:"Chris",Chris:"Christopher",Benjamin:"Benny",Benny:"Benjamin",Tim:"Timothy",Timothy:"Tim",Rob:"Robert",Robert:"Rob",Mike:"Michael",Michael:"Mike",Mitchell:"Mitch",Mitch:"Mitchell",John:"Johnathan",Johnathan:"John",Jon:"Jonathan",Jonathan:"Jon",Matt:"Matthew",Matthew:"Matt",Zach:"Zachary",Zachary:"Zach"},player_position_fix={"Ty Montgomery":"RB","Jadeveon Clowney":"LB","Derrick Morgan":"LB","Vic Beasley":"LB","Shea McClellin":"LB","Trent Murphy":"LB","Kevin Dodd":"LB","Lorenzo Alexander":"LB","Ryan Kerrigan":"LB","Preston Smith":"LB","Su'a Cravens":"DB","Jabaal Sheard":"DL","Frank Clark":"DL","Khalil Mack":"LB","Melvin Ingram":"DE"},player_position_fix_depth={"Derrick Morgan":"LB","Vic Beasley":"LB","Shea McClellin":"LB","Trent Murphy":"LB","Kevin Dodd":"LB","Su'a Cravens":"LB","Bruce Irvin":"LB","Ryan Kerrigan":"LB","Preston Smith":"LB","Tyrann Mathieu":"S","Lamarcus Joyner":"S","Jadeveon Clowney":"DE","Jabaal Sheard":"DE","Frank Clark":"DE","Emmanuel Ogbah":"DE","Dwight Freeney":"DE","Timmy Jernigan":"DE","Jaye Howard":"DE","Chris Baker":"DE","Kendall Langford":"DE","Adolphus Washington":"DE","Robert Nkemdiche":"DE","DaQuan Jones":"DE","Yannick Ngakoue":"DE","Melvin Ingram":"DE","Cameron Heyward":"DE","Aaron Donald":"DE","Akiem Hicks":"DE"},player_position_fix_sharks={"Su'a Cravens":"DB","Khalil Mack":"LB","Bruce Irvin":"DL"},team_abbrev_fix_fleaflicker={LA:"LAR"},off_positions_proj=["qb","rb","wr","te","k","dst"],def_positions_proj=["8","9","10"],all_positions_proj=off_positions_proj.concat(def_positions_proj),all_positions_rank=["qb","rb","wr","te","k","dst","dl","lb","db"],idp_positions=["DL","LB","DB"],idp_conversion={8:"DL",9:"LB",10:"DB"},team_name_conversion={ARZ:"ARI",GBP:"GB",KCC:"KC",NEP:"NE",NOR:"NO",RAM:"LA",SDC:"SD",SFO:"SF",TBB:"TB"},fpros_proj_headers={QB:["Player","Team","pass_att","pass_cmp","pass_yds","pass_tds","pass_ints","rush_att","rush_yds","rush_tds","fumbles","fpts"],RB:["Player","Team","rush_att","rush_yds","rush_tds","rec_att","rec_yds","rec_tds","fumbles","fpts"],WR:["Player","Team","rush_att","rush_yds","rush_tds","rec_att","rec_yds","rec_tds","fumbles","fpts"],TE:["Player","Team","rec_att","rec_yds","rec_tds","fumbles","fpts"],K:["Player","Team","fg","fga","xpt","fpts"],DST:["Player","Team","def_sack","def_int","def_fr","def_ff","def_td","def_assist","def_safety","def_pa","def_tyda","fpts"]},fpros_rank_headers=["Rank","WSIS","Player","Team","Matchup","Best Rank","Worst Rank","Avg Rank","Std Dev"],fpros_rank_idp_headers=["Rank","WSIS","Player","Team","Pos","Matchup","Best Rank","Worst Rank","Avg Rank","Std Dev"],fpros_ros_headers=["Rank","WSIS","Player","Team","Bye","Best Rank","Worst Rank","Avg Rank","Std Dev","ADP","vs. ADP"],fpros_ros_idp_headers=["Rank","WSIS","Player","Team","Pos","Bye","Best Rank","Worst Rank","Avg Rank","Std Dev"],depth_type_map={blue:"Starter",green:"Situational",red:"Fill-in",brown:"Fill-in",black:"Reserve"},depth_url="//subscribers.footballguys.com/apps/depthchart.php?type=all&lite=no&exclude_coaches=yes",loadingDiv="<div class=\"fp-spinner-cell\"><div class=\"fp-spinner-container\"><div class=\"fp-spinner fp-spinner-1\"></div><div class=\"fp-spinner fp-spinner-2\"></div><div class=\"fp-spinner fp-spinner-3\"></div></div></div>",projDone=jQuery.Deferred(),rankDone=jQuery.Deferred(),rosDone=jQuery.Deferred(),activityDone=jQuery.Deferred(),depthDone=jQuery.Deferred(),totalsDone=jQuery.Deferred(),storageActivityKey="fp_player_activity_data",storageDepthKey="fp_depth_data",storageDepthUpdateKey="fp_last_updated_depth",storageKeys=[storageActivityKey,storageDepthKey,storageDepthUpdateKey],baseUrlESPN="games.espn.com",baseUrlYahoo="football.fantasysports.yahoo.com",baseUrlFleaflicker="fleaflicker.com";document.URL.match(new RegExp(baseUrlESPN))?siteType="espn":document.URL.match(new RegExp(baseUrlYahoo))?siteType="yahoo":document.URL.match(new RegExp(baseUrlFleaflicker))&&(siteType="fleaflicker");function getParams(e){var t={},a=e.indexOf("?");return-1<a&&e.substr(a+1).split("&").forEach(function(e){var a=e.split("="),s=a[0],n=a[1]&&decodeURIComponent(a[1]);s in t?t[s].push(n):t[s]=[n]}),t}function makePromise(e){return new Promise(e)}function getLocalStorage(e,t){return makePromise(function(a,s){chrome.storage.local.get(e,function(e){t(e,a,s)})})}function setLocalStorage(e){return makePromise(function(t){chrome.storage.local.set(e,function(){dlog.log("set"),t()})})}function getUserSettings(){return getLocalStorage(storageUserSettingsKey,function(e,t){var a=e[storageUserSettingsKey];dlog.log("user settings:"),dlog.log(a),isObj(a)&&(user_settings=jQuery.extend(!0,{},a));var s={};isObj(user_settings.columns)?s=user_settings.columns:user_settings.columns={},show_proj=s.hasOwnProperty("proj")&&show_proj?s.proj:show_proj,show_rank=s.hasOwnProperty("rank")&&show_rank?s.rank:show_rank,show_ros=s.hasOwnProperty("ros")&&show_ros?s.ros:show_ros,show_depth=s.hasOwnProperty("depth")&&show_depth?s.depth:show_depth,show_spark=s.hasOwnProperty("spark")&&show_spark?s.spark:show_spark,show_avg=s.hasOwnProperty("avg")&&show_avg?s.avg:show_avg,show_med=s.hasOwnProperty("med")&&show_med?s.med:show_med,show_current=s.hasOwnProperty("current")&&show_current?s.current:show_current;var n={};isObj(user_settings.update_freq)?n=user_settings.update_freq:user_settings.update_freq={},jQuery.each(n,function(e,t){isObj(t)||(t={});var a=t.time,s=t.typ;if(a&&s){var n=a;"h"===s&&(n*=60),"player"===e&&(check_minutes=Math.max(n,1))}}),isObj(user_settings.experts)?experts=user_settings.experts:user_settings.experts={};var r={};isObj(user_settings.misc)?r=user_settings.misc:user_settings.misc={};var l=r.remove_ads,d=r.fix_css;"undefined"!=typeof l&&(remove_ads=l),"undefined"!=typeof d&&(fix_css=d),t()})}function isDataCurrent(t){function a(e){var t=check_minutes,a=0;if("league"===e)a=updated_league;else if("translation"===e)a=updated_translation;else if("depth"===e){if(!show_depth)return!0;t=check_minutes_depth,a=updated_depth}else{if("proj"===e&&!show_proj)return!0;if("rank"===e&&!show_rank)return!0;if("ros"===e&&!show_ros)return!0;if(isObj(updated_times)){a=updated_times[e];var s=e,n=experts[s]||{},l=n.selection||"none",d=l.toString();if("rank"===s||"ros"===s){var o=n.num||{},i=o.top||10,p=o.updated||7;d+="-"+i+"-"+p}dlog.log(d),updated_types[s]!==d&&(dlog.log("Different update type for: "+s+", stored is: "+updated_types[s]+", want: "+d),a=0)}}var f=!1;return f=!!parseFloat(a)&&current_time-a<60000*t,!1==f&&dlog.log(e+" is out of date: "+a),f}if(!t||!(Array.isArray(t)||"string"==typeof t)||0>=t.length)return!1;if(Array.isArray(t)){for(var s=!0,n=0;n<t.length;n++)!1===a(t[n])&&(s=!1);return s}return a(t)}function isActivityDataCurrent(e,t,a,s){var n,l=!0;if("league"===a)"live"===s?(dlog.info("using live"),n=check_minutes_avg_live):"done"===s?(dlog.info("using done"),n=check_minutes_avg_done):(dlog.info("using day"),n=check_minutes_avg),l=current_time-t<60000*n;else if("games"===a){var d=Math.max(Math.ceil((t-seasonstart_avg_week)/864e5/7),1);dlog.info("update week for player: "+e+": "+d),d!==current_week_avg&&(l=!1)}return!1===l&&dlog.info("Activity data out of date for player: "+e+", type is: "+a+", by: "+(current_time-t)/1e3),l}var AssignDataFromStorage=function(){var e=this;this.resolver=null,this.r=null,this._resolve=function(){e.resolver()},this._cb=function(t,a){e.resolver=a,e.r=t,alldata=t[storagePlayerKey],isObj(alldata)?(updated_times=t[storageUpdateKey],!isObj(updated_times)&&(updated_times={})):(dlog.log("Could not find alldata"),alldata={},updated_times={}),dlog.info(updated_times),updated_types=t[storageUpdateTypeKey],dlog.log(updated_types),isObj(updated_types)||(updated_types={}),depth_data=t[storageDepthKey],isObj(depth_data)||(depth_data={}),depth_data.hasOwnProperty(current_season)||(depth_data[current_season]={}),depth_data[current_season].hasOwnProperty("W"+current_week)||(depth_data[current_season]["W"+current_week]={}),depth_data_current_week=depth_data[current_season]["W"+current_week],updated_depth=isObj(depth_data_current_week)?t[storageDepthUpdateKey]:0,dlog.info("depth data:"),dlog.info(depth_data),dlog.info(updated_depth),activity_data=t[storageActivityKey],isObj(activity_data)||(activity_data={}),activity_data.hasOwnProperty(current_season)||(activity_data[current_season]={});var s=activity_data[current_season];s.hasOwnProperty(siteType)||(s[siteType]={}),activity_data_current_season_site=s[siteType],league_settings=t[storageLeagueKey],updated_league=t[storageLeagueUpdateKey],isObj(league_settings)&&isDataCurrent("league")?(dlog.log("Using cache for league"),e._resolve()):(league_settings={},dlog.log("Fetching league data, Updated time: "+updated_league+", Current Time: "+current_time),jQuery.get(league_settings_url,function(t){t=cleanHTML(t);var a=parseLeagueSettings(t,siteType),s={};s[storageLeagueKey]=a,s[storageLeagueUpdateKey]=updated_league,setLocalStorage(s).then(function(){e._resolve()})}))},this.run=function(){return getLocalStorage(storageKeys,e._cb)}},assignDataFromStorage=new AssignDataFromStorage;function resetLeagueYear(){if("espn"===siteType&&(current_season!==current_season_avg||current_season!==current_season_avg_week)){var e={leagueId:league_id,seasonId:current_season,xhr:"1"};jQuery.get("//games.espn.com/ffl/freeagency",e)}}function updatePlayerStorage(){jQuery.when(projDone,rankDone,rosDone).done(function(){if(dlog.log("Attempting to set new player data"),dlog.log("fetch fail: "+fetch_fail),dlog.log("idp fetch fail: "+idp_fetch_fail),!fetch_fail&&!idp_fetch_fail){dlog.log("Setting new player data");var e={};e[storagePlayerKey]=alldata,e[storageUpdateKey]=updated_times,e[storageUpdateTypeKey]=updated_types,chrome.storage.local.set(e,function(){resetLeagueYear()})}})}function updateDepthStorage(){jQuery.when(depthDone).done(function(){if(dlog.log("Attempting to set new depth data"),dlog.log("depth fail: "+depth_fail),!depth_fail){dlog.log("Setting new depth data");var e={};e[storageDepthKey]=depth_data,e[storageDepthUpdateKey]=updated_depth,chrome.storage.local.set(e,function(){resetLeagueYear()})}})}function updateActivityStorage(){jQuery.when(activityDone).done(function(){dlog.log("Setting new activity data");var e={};e[storageActivityKey]=activity_data,chrome.storage.local.set(e,function(){resetLeagueYear()})})}function doLeagueThings(){onMatchupPreviewPage?(jQuery.when(projDone,totalsDone).done(function(){dlog.log("all done"),"fleaflicker"===siteType&&watchForChanges()}),"yahoo"===siteType?jQuery.when(yahooIdsDone).done(function(){getAllData("proj")}):getAllData("proj")):(jQuery.when(projDone,rankDone,rosDone,activityDone,depthDone,totalsDone).done(function(){dlog.log("all done"),watchForChanges()}),"yahoo"===siteType?jQuery.when(yahooIdsDone).done(function(){getAllData()}):getAllData())}function getIdxSpan(e,t){if(t="undefined"!=typeof t&&t,e&&e.length){var a=0;return jQuery(e[0]).prevAll("td, th").each(function(){a+=this.colSpan}),t&&(a+=e[0].colSpan),a}return!1}function addColumns(){var e=Number.isInteger;if(-1!==header_index||"fleaflicker"===siteType&&hasProjectionTable){var t,a,n,r,l,d,o,i,p,f,c,u,y,h,g,_,m,P,F,v;if("espn"===siteType){if(a="<td class=\"playertableStat FantasyPlus FantasyPlusProjections FantasyPlusProjectionsHeader\" title=\"Consensus point projections from FantasyPros (via FantasyPlus)\">FPROS</td>",u="<td class=\"playertableStat FantasyPlus FantasyPlusProjections FantasyPlusProjectionsData\">"+loadingDiv+"</td>",onMatchupPreviewPage)show_proj&&(proj_head.after(a),proj_head.text("ESPN"),t=player_table_body.find(".playertableSectionHeader th:contains(STATS)"),t.each(function(){var e=jQuery(this).attr("colspan");jQuery(this).attr("colspan",e+1);var t=jQuery(this).closest("table");t.find("tr.pncPlayerRow:not(.emptyRow)").each(function(){var e=jQuery(this);e.find("td").last().after(u)})}));else{r="<td class=\"playertableStat FantasyPlus FantasyPlusSpark FantasyPlusSparkHeader\" title=\"Graph of fantasy points over previous weeks (via FantasyPlus)\">TREND</td>",l="<th class=\"FantasyPlus\" colspan=\"2\" title=\"Projected position rank (lower is better) with 95% confidence interval from FantasyPros (via FantasyPlus)\">PROJ RANK (\xB1RANGE)</th>",n="<td colspan=\"2\" style=\"text-align: center\" class=\"playertableStat FantasyPlus FantasyPlusRankings FantasyPlusRankingsHeader\" title=\"Projected position rank (lower is better) for *this week* from FantasyPros (via FantasyPlus)\">THIS WEEK</td>",d="<td colspan=\"2\" style=\"text-align: center\" class=\"playertableStat FantasyPlus FantasyPlusRos FantasyPlusRosHeader\" title=\"Projected position rank (lower is better) for *the rest of the season* from FantasyPros (via FantasyPlus)\">REMAINING</td>",o="<td class=\"playertableStat FantasyPlus FantasyPlusDepth FantasyPlusDepthHeader\" title=\"Depth chart information (via FantasyPlus)\">DEPTH</td>";_="<td class=\"playertableStat FantasyPlus FantasyPlusSpark FantasyPlusSparkData\">"+loadingDiv+"</td>",y="<td class=\"playertableStat FantasyPlus FantasyPlusRankings FantasyPlusRankingsData\">"+loadingDiv+"</td>",m="<td class=\"playertableStat FantasyPlus FantasyPlusRankings FantasyPlusRankingsStdevData\"></td>",P="<td class=\"playertableStat FantasyPlus FantasyPlusRos FantasyPlusRosData\">"+loadingDiv+"</td>",F="<td class=\"playertableStat FantasyPlus FantasyPlusRos FantasyPlusRosStdevData\"></td>",v="<td class=\"playertableStat FantasyPlus FantasyPlusDepth FantasyPlusDepthData\">"+loadingDiv+"</td>",h="<td class=\"FantasyPlus sectionLeadingSpacer\"></td>",i="";var w="",x=jQuery(".playerTableBgRowHead.tableHead.playertableSectionHeader");if(t=x.find("th:last"),show_proj&&(t.attr({colspan:2,title:"Projected points for this week"}).text("PROJ PTS"),t.after("<th class=\"FantasyPlus\" colspan=\"3\">OWNERSHIP</th>"),t.after("<th class=\"FantasyPlus\" colspan=\"1\">OPRK</th>"),t.after(h),0<proj_head.find("a").length?proj_head.find("a").text("ESPN"):proj_head.text("ESPN"),i+=a+h,w+=u+h),(show_rank||show_ros)&&(p=jQuery(l),show_rank&&show_ros&&p.attr("colspan",4),show_proj?(f=jQuery(h).add(p),t.after(f)):(f=p.add(jQuery(h)),t.before(f)),show_rank&&(i+=n,w+=y+m),show_ros&&(i+=d,w+=P+F),i+=h,w+=h),show_proj?proj_head.after(i):(show_rank||show_ros)&&proj_head.before(i),show_depth){var k=x.next("tr").find("td.sectionLeadingSpacer:first").index(),b=x.find("th.playertableSectionHeaderFirst");b.attr({colspan:k+1,title:"Player information"});var D=player_table_header.find("td:contains(TEAM POS)"),T=D.first().index();D.after(o)}for(var R=0,S=[show_avg,show_med,show_current,show_spark],C=0;C<S.length;C++)!0===S[C]&&(R+=1);if(show_avg||show_med||show_current||show_spark){var A=x.find("th:contains(SEASON)");A.attr({colspan:4+R,title:"Season statistics"})}var B=player_table_header.find("td:contains(AVG)"),O=B.first().index();show_depth&&(O-=1),show_med&&B.after("<td class=\"playertableStat FantasyPlus FantasyPlusMedian FantasyPlusMedianHeader\" title=\"Injury/Suspension-adjusted median points for the season (via FantasyPlus)\">MED</td>"),show_avg&&B.after("<td class=\"playertableStat FantasyPlus FantasyPlusAvg FantasyPlusAvgHeader\" title=\"Injury/Suspension-adjusted average points for the season (via FantasyPlus)\">iAVG</td>");var j=player_table_header.find("td:contains(LAST)"),E=j.first().index();show_depth&&(E-=1),show_spark&&j.after(r),show_current&&j.after("<td class=\"playertableStat FantasyPlus FantasyPlusCurrent FantasyPlusCurrentHeader\" title=\"Points scored this week (via FantasyPlus)\">CURR</td>");var L=player_table_body.find("tr.playerTableBgRowSubhead td:contains(OPP)").first().index();if(show_depth&&(L-=1),player_table_rows.each(function(){var e=jQuery(this),t=e.find("td").eq(L).text(),a="** BYE **"===t?header_index-1:header_index,s="** BYE **"===t?O-1:O,n="** BYE **"===t?E-1:E,r=0;show_med&&(e.find("td").eq(s).after("<td class=\"playertableStat FantasyPlus FantasyPlusMedian FantasyPlusMedianData\">"+loadingDiv+"</td>"),r+=1),show_avg&&(e.find("td").eq(s).after("<td class=\"playertableStat FantasyPlus FantasyPlusAvg FantasyPlusAvgData\">"+loadingDiv+"</td>"),r+=1),show_current&&(e.find("td").eq(n).after("<td class=\"playertableStat FantasyPlus FantasyPlusCurrent FantasyPlusCurrentData\">"+loadingDiv+"</td>"),n+=1,r+=1),show_spark&&(e.find("td").eq(n).after(_),r+=1),show_proj?e.find("td").eq(a+r).after(w):(show_rank||show_ros)&&e.find("td").eq(a+r).before(w),show_depth&&e.find("td").eq(T).after(v)}),(show_proj||show_current)&&onClubhousePage){var M=player_table_body.find("tr.playerTableBgRowHead:last"),Y=M.prevAll(".playerTableBgRowSubhead:first");c=Y.clone();var I=M.prev(),N=I.attr("class").match(/playerTableBgRow(\d)/),G="0";N&&2===N.length&&(G=Math.abs(parseInt(N[1])-1));var H="playerTableBgRow"+G;c.removeClass(),c.addClass("FantasyPlus FantasyPlusTotals pncPlayerRow "+H),c.find("td").empty(),c.find("td:first").html("<b>TOTAL</b>");var U=c.find(".FantasyPlusProjectionsHeader"),J=c.find(".FantasyPlusCurrentHeader");c.find("td").removeClass(function(e,t){return(t.match(/(^|\s)FantasyPlus\S+Header/g)||[]).join(" ")}),U.addClass("FantasyPlusProjectionsTotal"),J.addClass("FantasyPlusCurrentTotal"),M.before(c)}}}else if("yahoo"===siteType){if(onMatchupPreviewPage)show_proj&&(a="<th style=\"width: 38px;\" class=\"Ta-end Va-top FantasyPlus FantasyPlusProjections FantasyPlusProjectionsHeader\" title=\"Consensus point projections from FantasyPros (via FantasyPlus)\"><div style=\"width: 40px;\">Proj (FP)</div></td>",u="<td style=\"width: 38px;\" class=\"Alt Ta-end F-shade Va-top FantasyPlus FantasyPlusProjections FantasyPlusProjectionsData\">"+loadingDiv+"</td>",g="<td style=\"width: 38px;\" class=\"Alt Ta-end F-shade Va-top FantasyPlus FantasyPlusProjections FantasyPlusProjectionsTotal\">-</td>",playerTable.each(function(){var e=u,t=jQuery(this),s=t.find("thead th"),n=s.length,r=s.filter(function(){return"Proj"===jQuery(this).text()}),l=jQuery(r[0]),d=jQuery(r[1]),o=l.index(),i=d.index();l.after(a),d.before(a);var p=t.find("tbody tr"),f=p.length;p.each(function(t){var a=jQuery(this);t+1===f&&(e=g);var s=a.find("td"),r=n-s.length;s.eq(o).after(e),s.eq(i-r).before(e)})}));else if(a="<th style=\"width: 40px; text-align: center;\" class=\"FantasyPlus FantasyPlusProjections FantasyPlusProjectionsHeader\" title=\"Consensus point projections from FantasyPros (via FantasyPlus)\">Proj (FP)</th>",n="<th style=\"width: 40px; text-align: center;\" class=\"FantasyPlus FantasyPlusRankings FantasyPlusRankingsHeader\" title=\"Projected position rank (lower is better) for *this week* from FantasyPros (via FantasyPlus)\">Rank (FP)</th>",u="<td class=\"Nowrap Ta-end FantasyPlus FantasyPlusProjections FantasyPlusProjectionsData\">"+loadingDiv+"</td>",y="<td class=\"Nowrap Ta-end FantasyPlus FantasyPlusRankings FantasyPlusRankingsData\">"+loadingDiv+"</td>",custom_cols=0,i="",show_proj&&(custom_cols++,i+=a),show_rank&&(custom_cols++,i+=n),0<custom_cols){player_table_header.each(function(){var e=jQuery(this).find("th").filter(function(){return /^\w/.test(jQuery(this).text())}).first(),t=parseInt(e.attr("colspan"));isNaN(t)||e.data("modified")||e.attr({colspan:t+custom_cols,"data-modified":!0})}),proj_head.after(i);var K=proj_head.first().text();player_table_rows.each(function(){var e=jQuery(this),t=e.find("td").eq(header_index-1),a=e.find("td").eq(header_index),s=a,n=null;"Proj Pts"===K?(s=t,n="stats"):"Fan Pts"===K?(s=a,n="proj"):"Rank"===K?(s=t,n="gdd"):"This Week"===K&&(s=a,n="rank");var r="Bye"===s.text(),l=""===s.text(),d="";if(r){var o="stats"===n?3:2;s.attr("colspan",o+custom_cols)}else show_proj&&(d+=u),show_rank&&(d+=y),l&&(s.attr("colspan",1),s.next().hasClass("Bdrstart")&&(d+="<td class=\"Ta-end Nowrap\"></td>","stats"===n?s.after("<td class=\"Ta-end Nowrap\"></td>"):"rank"===n&&s.after("<td class=\"Ta-end Nowrap\"></td><td class=\"Ta-end Nowrap\"></td>"))),a=0===e.find(".ysf-player-video-link").length&&"stats"===n?e.find("td").eq(header_index-1):e.find("td").eq(header_index),a.after(d);e.find("td:first").hasClass("Selected")&&e.find("td.FantasyPlus").addClass("Selected")})}}else if("fleaflicker"===siteType){a="<th style=\"width: 2%;\" class=\"leaf FantasyPlus FantasyPlusProjections FantasyPlusProjectionsHeader\" title=\"Consensus point projections from FantasyPros (via FantasyPlus)\">FPros</th>";h="<td class=\"FantasyPlus horizontal-spacer\"></td>";var q=function(e,t,a){a="undefined"==typeof a?"3%":a,e.each(function(){var e=jQuery(this),s=jQuery(t);e.hasClass("bottom")&&s.addClass("bottom"),e.hasClass("right")&&(e.removeClass("right"),s.addClass("right"));var n=e.next();n.length&&!n.hasClass("horizontal-spacer")&&n.css("width",a),e.after(s)})},W=function(t,a){if(a&&a.length&&e(t)&&0<=t){var s,n=jQuery(a[0]).closest("table").find("thead tr.first"),r=0;return n.find("td, th").each(function(){r<=t&&(s=jQuery(this),t=t-this.colSpan+1,r++)}),s}return!1},V=function(e,t,a){t="undefined"!=typeof t&&t,a="undefined"!=typeof a&&a;var s=new RegExp(e);if(t)var n=new RegExp(t);return player_table_header.find("th").filter(function(){var e=jQuery(this);if(s.test(e.text())){if(a||!t)return!0;var r=getIdxSpan(e),l=W(r,e);return n.test(l.text())}return!1})},z=function(e){var t=[],a=-1,s=getIdxSpan(e),n=!1,r=e.parent("tr").next("tr").find("td, th");return r.each(function(){var e=jQuery(this);if(n){if(e.hasClass("horizontal-spacer"))return!1;t.push(e)}else a+=this.colSpan,a>=s&&(t.push(e),n=!0)}),t},Q=function(e,t){if(t="undefined"!=typeof t&&parseInt(t),e&&e.length)if("number"!=typeof t){var a=z(e),s=a.length;0<s&&e.attr("colspan",s)}else{var n=e[0].colSpan;e.attr("colspan",n+t)}};if(onMatchupPreviewPage){if(u="<td class=\"text-right FantasyPlus FantasyPlusProjections FantasyPlusProjectionsData\">"+loadingDiv+"</td>",g="<td class=\"text-right FantasyPlus FantasyPlusProjections FantasyPlusProjectionsTotal\">--</td>",show_proj){proj_head.each(function(){var e=jQuery(this),t=getIdxSpan(e),a=W(t,e);Q(a,1)});var $=player_table_header.find("th").filter(function(){return"Proj"===jQuery(this).text()||"Projected"===jQuery(this).text()});q($,a,"6%");var X=playerTable.find("tr.scoreboard").closest("table"),Z=X.find("thead tr th").filter(function(){return"Projected"===jQuery(this).text()});if(Z.length){var ee=X.find("tbody tr:last td:last");Q(ee,1)}}playerTable.each(function(){var e=jQuery(this),t=e.find("th").filter(function(){return"Proj"===jQuery(this).text()||"Projected"===jQuery(this).text()}),a=t.index();if(-1<a){var s=!1,n=e.find("tbody").find(player_table_row_selector);n.each(function(){var e=jQuery(this),t=e.find("td, th"),n=t.eq(a),r=u;e.hasClass("divider")?s?r="<td class=\"FantasyPlus\">&nbsp;</td>":(r=g,n.html("--"),n.addClass("FantasyPlusFleaTotal"),s=!0):e.hasClass("scoreboard")?r=g:e.hasClass("repeated")?r="<th class=\"FantasyPlus vertical-spacer bottom\">&nbsp;</th>":"Optimum"===t.first().text()&&(r="<td class=\"FantasyPlus\">&nbsp;</td>"),r=jQuery(r),n.hasClass("bottom")&&r.addClass("bottom"),n.hasClass("right")&&(n.removeClass("right"),r.addClass("right")),show_proj&&n.after(r)})}})}else{r="<th style=\"width: 4%;\" class=\"leaf FantasyPlus FantasyPlusSpark FantasyPlusSparkHeader\" title=\"Graph of fantasy points over previous weeks (via FantasyPlus)\">Trend</th>",l="<th colspan=\"2\" class=\"top left right FantasyPlus FantasyPlusRankingsTop FantasyPlusRankingsTopHeader\" title=\"Projected position rank (lower is better) with 95% confidence interval from FantasyPros (via FantasyPlus)\">Proj Rank (\xB1Range)</th>",n="<th colspan=\"2\" style=\"text-align: center;\" class=\"leaf left FantasyPlus FantasyPlusRankings FantasyPlusRankingsHeader\" title=\"Projected position rank (lower is better) for *this week* from FantasyPros (via FantasyPlus)\">This Week</th>",d="<th colspan=\"2\" style=\"text-align: center;\" class=\"leaf right FantasyPlus FantasyPlusRos FantasyPlusRosHeader\" title=\"Projected position rank (lower is better) for *the rest of the season* from FantasyPros (via FantasyPlus)\">Remaining</th>",o="<th style=\"width: 4%;\" class=\"leaf FantasyPlus FantasyPlusDepth FantasyPlusDepthHeader\" title=\"Depth chart information (via FantasyPlus)\">Depth</th>",u="<td class=\"FantasyPlus FantasyPlusProjections FantasyPlusProjectionsData\">"+loadingDiv+"</td>",_="<td class=\"FantasyPlus FantasyPlusSpark FantasyPlusSparkData\">"+loadingDiv+"</td>",y="<td style=\"width: 2%;\" class=\"left FantasyPlus FantasyPlusRankings FantasyPlusRankingsData\">"+loadingDiv+"</td>",m="<td style=\"width: 2%;\" class=\"right FantasyPlus FantasyPlusRankings FantasyPlusRankingsStdevData\"></td>",P="<td style=\"width: 2%;\" class=\"FantasyPlus FantasyPlusRos FantasyPlusRosData\">"+loadingDiv+"</td>",F="<td style=\"width: 2%;\" class=\"right FantasyPlus FantasyPlusRos FantasyPlusRosStdevData\"></td>",v="<td class=\"FantasyPlus FantasyPlusDepth FantasyPlusDepthData\">"+loadingDiv+"</td>";var te=function(t,a,s){e(t)&&0<=t&&(s="undefined"!=typeof s&&s,player_table_rows.each(function(){var e=jQuery(this),n=e.find("td, th"),r=n.eq(t),l=jQuery(a);r.hasClass("right")&&!r.hasClass("FantasyPlus")&&(r.removeClass("right"),l.addClass("right")),(r.hasClass("bottom")||e.hasClass("last"))&&l.addClass("bottom"),s&&(l=l.add(jQuery(h))),e.hasClass("repeated")&&(r.hasClass("leaf")?l=null:l="<th class=\"FantasyPlus vertical-spacer bottom\">&nbsp;</th>"),r.after(l)}))},ae=V("^Rank$",!1,!0);ae.css("width","3%");var se=V("^Last [0-9]+$|^Total$|^Avg$","^Fantasy$");se.css("width","4%");var ne=V("^Season$");if(ne.css("width","5%"),show_depth){var re=player_table_header.find("th").filter(function(){return"Name"===jQuery(this).text()}),le=getIdxSpan(re),de=W(le,re);q(re,o),Q(de),te(le,v)}var oe=getIdxSpan(proj_head),ie=W(oe,proj_head);if(ie&&ie.length||(show_proj=!1,show_rank=!1,show_ros=!1),show_proj&&(q(proj_head,a),Q(ie),te(oe,u)),show_rank||show_ros){p=jQuery(l),f=jQuery("<th class=\"FantasyPlus horizontal-spacer\"></th>").add(p),ie.after(f),show_rank&&show_ros&&Q(p,2);var pe,fe=getIdxSpan(p)-1;if(show_rank){var ce=jQuery(n),ue=!1;show_ros||(ce.addClass("right"),ce=ce.add(jQuery("<th class=\"FantasyPlus horizontal-spacer\"></th>")),ue=!0),pe=p.parent().next().find("th"),pe.eq(fe).after(ce),te(fe,y),te(fe+1,m,ue)}if(show_ros){var ye=jQuery(d),he=jQuery(P);show_rank?fe+=1:(ye.addClass("left"),he.addClass("left")),ye=ye.add(jQuery("<th class=\"FantasyPlus horizontal-spacer\"></th>")),pe=p.parent().next().find("th"),pe.eq(fe).after(ye),show_rank&&(fe+=1),te(fe,he.prop("outerHTML")),te(fe+1,F,!0)}}if(show_spark){var ge=playerTable.find("tr th").filter(function(){return jQuery(this).text().match(/Season|Avg/)}),_e=getIdxSpan(ge),me=W(_e,ge);q(ge,r),Q(me),te(_e,_)}if(onClubhousePage){var Pe=player_table_body.find("tr[id^=row].last:first");c=Pe.clone(),Pe.find("td").removeClass("bottom"),c.removeAttr("id"),c.addClass("divider strong FantasyPlus");var Fe=c.find("td");Fe.each(function(e){var t=jQuery(this);t.addClass("bottom"),0===e?(t.addClass("FantasyPlus"),t.html("<span class=\"player\">Total</span>")):(t.empty(),t.removeClass(function(e,t){return(t.match(/(^|\s)FantasyPlus\S+/g)||[]).join("")}),t.addClass("FantasyPlus"),!t.hasClass("horizontal-spacer")&&t.html("&nbsp;"))});var ve=getIdxSpan(proj_head),we=Fe.eq(ve);we.html("\u2014"),we.addClass("FantasyPlusFleaTotal"),show_proj&&(we=we.next(),we.html("\u2014"),we.addClass("FantasyPlusProjections FantasyPlusProjectionsTotal")),we.next().html("\u2014"),we.next().addClass("FantasyPlusActualTotal"),Pe.after(c)}}}}}function parseLeagueSettings(e,t){var a=Math.min,s=Math.max,n=jQuery(e);league_settings={},league_settings.siteType=t;var r,l;if("espn"===t)r=function(e){return parseFloat(n.find("td:contains('"+e+"')").next().first().text())},league_settings.pass_yds=r("Passing Yards (PY)")||r("(PY5)")/5||r("(PY10)")/10||r("(PY20)")/20||r("(PY25)")/25||r("(PY50)")/50||r("(PY100)")/100||0,league_settings.pass_tds=r("TD Pass (PTD)")||0,league_settings.pass_ints=r("Interceptions Thrown (INT)")||0,league_settings.pass_cmp=r("Each Pass Completed (PC)")||r("(PC5)")/5||r("(PC10)")/10||0,league_settings.pass_icmp=r("Each Incomplete Pass (INC)")||r("(IP5)")/5||r("(IP10)")/10||0,league_settings.pass_att=r("Each Pass Attempted (PA)")||0,league_settings.pass_300_bonus=r("300-399 yard passing game (P300)")||0,league_settings.pass_400_bonus=r("400+ yard passing game (P400)")||0,league_settings.rush_yds=r("Rushing Yards (RY)")||r("(RY5)")/5||r("Every 10 rushing yards (RY10)")/10||r("(RY20)")/20||r("(RY25)")/25||r("(RY50)")/50||r("(RY100)")/100||0,league_settings.rush_att=r("Rushing Attempts (RA)")||r("(RA5)")/5||r("(RA10)")/10||0,league_settings.rush_tds=r("TD Rush (RTD)")||0,league_settings.rush_100_bonus=r("100-199 yard rushing game (RY100)")||0,league_settings.rush_200_bonus=r("200+ yard rushing game (RY200)")||0,league_settings.rec_yds=r("Receiving Yards (REY)")||r("Every 5 receiving yards (REY5)")/5||r("(REY10)")/10||r("(REY20)")/20||r("(REY25)")/25||r("(REY50)")/50||r("(REY50)")/100||0,league_settings.rec_att=r("Each reception (REC)")||r("(REC5)")/5||r("(REC10)")/10||0,league_settings.rec_tds=r("TD Reception (RETD)")||0,league_settings.rec_100_bonus=r("100-199 yard receiving game (REY100)")||0,league_settings.rec_200_bonus=r("200+ yard receiving game (REY200)")||0,league_settings.xpt=r("Each PAT Made (PAT)")||0,league_settings.fga=(r("Total FG Attempted (FGA)")||0)+.6*(r("FG Attempted (0-39 yards) (FGA9)")||0)+.3*(r("FG Attempted (40-49 yards) (FGA40)")||0)+.1*(r("FG Attempted (50+ yards) (FGA50)")||0),league_settings.fg=(r("Total FG Made (FG)")||0)+.6*(r("FG Made (0-39 yards) (FG0)")||0)+.3*(r("FG Made (40-49 yards) (FG40)")||0)+.1*(r("FG Made (50+ yards) (FG50)")||0),league_settings.fgm=(r("Total FG Missed (FGM)")||0)+.6*(r("FG Missed (0-39 yards) (FGM0)")||0)+.3*(r("FG Missed (40-49 yards) (FGM40)")||0)+.1*(r("FG Missed (50+ yards) (FGM50)")||0),league_settings.fumbles=r("Total Fumbles Lost (FUML)")||0,league_settings.ff=r("Each Fumble Forced (FF)")||0,league_settings.tka=r("Assisted Tackles (TKA)")||0,league_settings.tks=r("Solo Tackles (TKS)")||0,league_settings.pd=r("Passes Defensed (PD)")||0,league_settings.int=r("Each Interception (INT)")||0,league_settings.deftd=r("Interception Return TD (INTTD)")||0,league_settings.fr=r("Each Fumble Recovered (FR)")||0,league_settings.sf=r("Each Safety (SF)")||0,league_settings.sk=r("Each Sack (SK)")||2*r("1/2 Sack (HALFSK)")||0,league_settings.pa=r("Points Allowed (PA)")||0,league_settings.pa0=r("0 points allowed (PA0)")||0,league_settings.pa1=r("1-6 points allowed (PA1)")||0,league_settings.pa7=r("7-13 points allowed (PA7)")||0,league_settings.pa14=r("14-17 points allowed (PA14)")||0,league_settings.pa18=r("18-21 points allowed (PA18)")||0,league_settings.pa22=r("22-27 points allowed (PA22)")||0,league_settings.pa28=r("28-34 points allowed (PA28)")||0,league_settings.pa35=r("35-45 points allowed (PA35)")||0,league_settings.pa46=r("46+ points allowed (PA46)")||0,league_settings.ya=r("Yards Allowed (YA)")||0,league_settings.ya100=r("Less than 100 total yards allowed (YA100)")||0,league_settings.ya199=r("100-199 total yards allowed (YA199)")||0,league_settings.ya299=r("200-299 total yards allowed (YA299)")||0,league_settings.ya349=r("300-349 total yards allowed (YA349)")||0,league_settings.ya399=r("350-399 total yards allowed (YA399)")||0,league_settings.ya449=r("400-449 total yards allowed (YA449)")||0,league_settings.ya499=r("450-499 total yards allowed (YA499)")||0,league_settings.ya549=r("500-549 total yards allowed (YA549)")||0,league_settings.ya550=r("550+ total yards allowed (YA550)")||0;else if("yahoo"===t){l=jQuery("#settings-stat-mod-table tbody td",n),r=function(e){var t=[],a=l.filter(function(){return this.childNodes[0].nodeValue===e});if(a&&0<a.length){var s=a.next().first().text(),n=s.split(";"),r={};jQuery.each(n,function(e,a){a=a.trim();var s;if(-1<a.indexOf("yards per point"))s=1/parseFloat(a.split(" ")[0]),t.push(s);else if(-1<a.indexOf("points at ")){var n=a.split(" "),l=parseFloat(n[0]),d=parseFloat(n[3]);r[d]=l}else s=parseFloat(a),t.push(s)}),t.push(r)}return t};var d=r("Passing Yards");league_settings.pass_yds=d[0]||0,league_settings.pass_bonus={};var o=d[1];for(var i in o)o.hasOwnProperty(i)&&(league_settings.pass_bonus[i]=o[i]);league_settings.pass_tds=r("Passing Touchdowns")[0]||0,league_settings.pass_ints=r("Interceptions")[0]||0,league_settings.pass_cmp=r("Completions")[0]||0,league_settings.pass_icmp=r("Incomplete Passes")[0]||0,league_settings.pass_att=r("Passing Attempts")[0]||0,league_settings.pass_firstdown=r("Passing 1st Downs")[0]||0;var p=r("Rushing Yards");league_settings.rush_yds=p[0]||0,league_settings.rush_bonus={};var f=p[1];for(var u in f)f.hasOwnProperty(u)&&(league_settings.rush_bonus[u]=f[u]);league_settings.rush_att=r("Rushing Attempts")[0]||0,league_settings.rush_tds=r("Rushing Touchdowns")[0]||0,league_settings.rush_firstdown=r("Rushing 1st Downs")[0]||0;var y=r("Receiving Yards");league_settings.rec_yds=y[0]||0,league_settings.rec_bonus={};var h=y[1];for(var g in h)h.hasOwnProperty(g)&&(league_settings.rec_bonus[g]=h[g]);league_settings.rec_att=r("Receptions")[0]||0,league_settings.rec_tds=r("Receiving Touchdowns")[0]||0,league_settings.rec_firstdown=r("Receiving 1st Downs")[0]||0,league_settings.xpt=r("Point After Attempt Made")[0]||0,league_settings.fga=0,league_settings.fg=.6*((r("Field Goals 0-19 Yards")[0]||0)+(r("Field Goals 20-29 Yards")[0]||0)+(r("Field Goals 30-39 Yards")[0]||0))/3+.3*(r("Field Goals 40-49 Yards")[0]||0)+.1*(r("Field Goals 50+ Yards")[0]||0),league_settings.fgm=.6*((r("Field Goals Missed 0-19 Yards")[0]||0)+(r("Field Goals Missed 20-29 Yards")[0]||0)+(r("Field Goals Missed 30-39 Yards")[0]||0))/3+.3*(r("Field Goals Missed 40-49 Yards")[0]||0)+.1*(r("Field Goals Missed 50+ Yards")[0]||0),league_settings.fumbles=r("Fumbles Lost")[0]||r("Fumbles")[0]||0,league_settings.ff=r("Fumble Force")[0]||0,league_settings.tka=r("Tackle Assist")[0]||0,league_settings.tks=r("Tackle Solo")[0]||0,league_settings.pd=r("Pass Defended")[0]||0,league_settings.int=r("Interception")[0]||0,league_settings.deftd=r("Touchdown")[0]||r("Defensive Touchdown")[0]||0,league_settings.fr=r("Fumble Recovery")[0]||0,league_settings.sk=r("Sack")[0]||0,league_settings.sf=r("Safety")[0]||0,league_settings.pa=0,league_settings.pa0=r("Points Allowed 0 points")[0]||0,league_settings.pa1=r("Points Allowed 1-6 points")[0]||0,league_settings.pa7=r("Points Allowed 7-13 points")[0]||0,league_settings.pa14=r("Points Allowed 14-20 points")[0]||0,league_settings.pa21=r("Points Allowed 21-27 points")[0]||0,league_settings.pa28=r("Points Allowed 28-34 points")[0]||0,league_settings.pa35=r("Points Allowed 35+ points")[0]||0,league_settings.ya=0,league_settings.ya100=r("Defensive Yards Allowed 0-99")[0]||0,league_settings.ya199=r("Defensive Yards Allowed 100-199")[0]||0,league_settings.ya299=r("Defensive Yards Allowed 200-299")[0]||0,league_settings.ya399=r("Defensive Yards Allowed 300-399")[0]||0,league_settings.ya499=r("Defensive Yards Allowed 400-499")[0]||0,league_settings.ya500=r("Defensive Yards Allowed 500+")[0]||0}else if("fleaflicker"===t){l=jQuery("#body-center-main > table",n);for(var _,m=l.find("tr td.table-heading").closest("tr"),P=[17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65],F=[0,5,27,68,62,77,78,62,69,57,94,65,71,84,81,71,94,60,93,77,76,89,65,78,56,71,76,80,70,63,63,75,67,57,54,55,58,30,19,6,6,5,1,0,2,0,0,1,0],v=0,w=0;w<F.length;w++)v+=F[w];var x=P[0],k=P[P.length-1];r=function(t,n){n="undefined"!=typeof n&&n;var e,r=[],d=m.find("td.table-heading:contains('"+_+"')").closest("tr");e=0<d.parent("thead").length?l.find("tbody tr:first").nextUntil(m,"tr").addBack():d.nextUntil(m,"tr");var o=new RegExp("^"+t+"(?:(s|es))?(?: [(]Quantity[)])?$"),i=e.find("td.left strong").filter(function(){return o.test(jQuery(this).text())}).closest("td.left");if(i&&0<i.length&&jQuery.each(i,function(l,d){var o=jQuery(d),p=o.contents(),f=parseFloat(p[0].textContent),c=!1,u=p[1].textContent.trim();if(-1<u.indexOf(" for every")){c=!0;var y=1,h=o.find("span.for-every");0<h.length&&(y=parseFloat(h.text().trim())),f=parseFloat(f/y)}var g=o.find("strong:contains('(Quantity)')"),m=p.filter("strong:first"),w=p.index(m),b=p.slice(w+1),D="",T=!1,R=!1,S=p.get(w-1).textContent.trim(),C=c&&(/yards? covered/.test(u)||/yards? covered/.test(S));"Kicking"!==_&&C&&(T=!0,R=!0),b.length&&(D=b[0].textContent.trim(),"Kicking"===_&&/Field Goals\? (Made|Missed)/.test(t)?!/^\(/.test(D)&&g.length&&(T=!0):/^\(/.test(D)?C&&(T=!0,R=!0):T=!0);var A=36.36,B=1;if(T===n){var O,E;if(!1===T){if("Kicking"!==_)r.push(f);else if(!C&&(!b.length||/^\(/.test(D)))r.push(f);else{O=b.filter("span.text-muted.low").text().trim();var L=x;O&&(O=parseFloat(O),L=a(s(O,x),k)),E=b.filter("span.text-muted.high").text().trim();var M=k;if(E&&(E=parseFloat(E),M=s(a(E,k),x)),O||E){var Y=P.indexOf(L),I=P.indexOf(M),N=P.slice(Y,I+1),G=F.slice(Y,I+1);if(C){for(var H=F.slice(I+1),U=0;U<H.length;U++)G[G.length-1]+=H[U];for(var J=0,K=0;K<N.length;K++)J+=N[K]*G[K];for(var q=0,W=0;W<G.length;W++)q+=G[W];A=parseFloat(J/q),E&&(A=a(A,E)),O&&(A-=O)}else A=1;B=0;for(var V=0;V<G.length;V++)B+=parseFloat(G[V]/v)}f*=A*B,r.push(f)}}else if(!R&&(!(-1<t.indexOf(" TD"))||g.length)){var z={};z.pts=f,z.is_per=c,O=b.filter("span.text-muted.low").text().trim(),O&&(O=parseFloat(O)),E=b.filter("span.text-muted.high").text().trim(),E&&(E=parseFloat(E)),""!==O&&""===E&&D&&/is exactly/.test(D)&&(E=O),z.low=O,z.high=E,r.push(z)}}}),!1===n){for(var p=0,c=0;c<r.length;c++)p+=r[c];r=p}else 0===r.length&&(r=null);return r},_="Passing",league_settings.pass_yds=r("Passing Yard")||0,league_settings.pass_yds_bonus=r("Passing Yard",!0),league_settings.pass_tds=r("Passing TD")||0,league_settings.pass_tds_bonus=r("Passing TD",!0),league_settings.pass_ints=r("Interception")||0,league_settings.pass_ints_bonus=r("Interception",!0),league_settings.pass_cmp=r("Passing Completion")||0,league_settings.pass_cmp_bonus=r("Passing Completion",!0),league_settings.pass_icmp=r("Incomplete Pass")||0,league_settings.pass_icmp_bonus=r("Incomplete Pass",!0),league_settings.pass_att=r("Passing Attempt")||0,league_settings.pass_att_bonus=r("Passing Attempt",!0),_="Rushing",league_settings.rush_yds=r("Rushing Yard")||0,league_settings.rush_yds_bonus=r("Rushing Yard",!0),league_settings.rush_tds=r("Rushing TD")||0,league_settings.rush_tds_bonus=r("Rushing TD",!0),league_settings.rush_att=r("Rushing Attempt")||0,league_settings.rush_att_bonus=r("Rushing Attempt",!0),_="Receiving",league_settings.rec_yds=r("Receiving Yard")||0,league_settings.rec_yds_bonus=r("Receiving Yard",!0),league_settings.rec_tds=r("Receiving TD")||0,league_settings.rec_tds_bonus=r("Receiving TD",!0),league_settings.rec_att=r("Catch")||0,league_settings.rec_att_bonus=r("Catch",!0),_="Kicking",league_settings.xpt=r("XP")||0,league_settings.xpt_bonus=r("XP",!0),league_settings.fga=r("Field Goal Attempt")||0,league_settings.fga_bonus=r("Field Goal Attempt",!0),league_settings.fg=r("Field Goals? Made")||0,league_settings.fg_bonus=r("Field Goals? Made",!0),league_settings.fgm=r("Field Goals? Missed")||0,league_settings.fgm_bonus=r("Field Goals? Missed",!0),_="Misc",league_settings.fumbles=r("Fumbles? Lost")||r("Fumble")||0,league_settings.fumbles_bonus=r("Fumbles? Lost",!0)||r("Fumble",!0),_="Defense",league_settings.tka=r("Assisted Tackle")||r("Total Tackle")||0,league_settings.tka_bonus=r("Assisted Tackle",!0)||r("Total Tackle",!0),league_settings.tks=r("Solo Tackle")||r("Total Tackle")||0,league_settings.tks_bonus=r("Solo Tackle",!0)||r("Total Tackle",!0),league_settings.pd=r("Pass(?:es)? Defended")||0,league_settings.pd_bonus=r("Pass(?:es)? Defended",!0),league_settings.ff=r("Fumbles? Forced")||0,league_settings.ff_bonus=r("Fumbles? Forced",!0),league_settings.fr=r("Fumbles? Recovered")||0,league_settings.fr_bonus=r("Fumbles? Recovered",!0),league_settings.sk=r("Sack")||0,league_settings.sk_bonus=r("Sack",!0),league_settings.sf=r("Safety")||0,league_settings.sf_bonus=r("Safety",!0),league_settings.int=r("Interception")||0,league_settings.int_bonus=r("Interception",!0),league_settings.deftd=r("Defensive TD")||r("INT Return TD")||r("Fumble Return TD")||0,league_settings.deftd_bonus=r("Defensive TD",!0)||r("INT Return TD",!0)||r("Fumble Return TD",!0),league_settings.ya=r("Net Yards? Allowed")||0,league_settings.ya_bonus=r("Net Yards? Allowed",!0),league_settings.pa=r("Points? Allowed")||r("Offensive . Special Teams Points? Allowed")||r("Offensive Points? Allowed [(]FG, Pass TD, Rush TD[)]")||0,league_settings.pa_bonus=r("Points? Allowed",!0)||r("Offensive . Special Teams Points? Allowed",!0)||r("Offensive Points? Allowed [(]FG, Pass TD, Rush TD[)]",!0)}return updated_league=current_time,dlog.log(league_settings),league_settings}function ajaxCbPos(e){jQuery.ajax(e).done(function(e){var t=this.custom_data.cb,a=this.custom_data.pos;e=cleanHTML(e),t(a,e.trim())}).fail(function(){var e=this.custom_data.cb,t=this.custom_data.pos,a=this.custom_data.source_site;idp_fetch_fail=!0,chrome.runtime.sendMessage({request:"fetch_fail",value:a}),e(t,"error")})}function fetchPositionData(e,t,a){var s,n="",r="offense";if("rank"===t||"ros"===t){s="",("rb"===e||"wr"===e||"te"===e)&&(.5===league_settings.rec_att?s="half-point-ppr-":1===league_settings.rec_att&&(s="ppr-"));var l="";"ros"===t&&(l="ros-"),n="https://www.fantasypros.com/nfl/rankings/"+l+s+e+".php"}else-1<off_positions_proj.indexOf(e)?n="https://www.fantasypros.com/nfl/projections/"+e+".php?week="+current_week:(r="idp",n="https://www.fantasysharks.com/apps/bert/forecasts/projections.php?csv=1&Position="+e+"&Segment="+(627+current_week));var d={url:n,timeout:ajax_timeout,custom_data:{cb:a,source_site:n,pos:e}};if("idp"===r)ajaxCbPos(d);else{var o=experts[t]||{},i=o.selection||[];if("proj"===t&&1===i.length)ajaxCbPos(d);else if("proj"===t){d.method="get",d.data={scoring:"STD"},d.traditional=!0,ajaxCbPos(d)}else jQuery.ajax(d).done(function(e){var a=this.custom_data.cb,n=this.custom_data.pos,r=this.custom_data.source_site;e=cleanHTML(e);var l={"expert[]":[]},d=l["expert[]"];l.scoring="half-point-ppr-"===s?"HALF":"ppr-"===s?"PPR":"STD";var o=experts[t]||{},i=o.selection||[],p=o.num||{},f=p.top||10,c=p.updated||7,u=jQuery(e).find("#edit-experts #experts");if(u.length){var y=u.find("tbody tr"),h=u.find("thead tr"),g=h.find("th:first").index(),_=h.find("th.accuracy.overall:contains(In-Season)").index(),m=h.find("th.accuracy.position:contains(In-Season)").index(),P=h.find("th:contains(Date)").index();if(-1===i.indexOf("all")){var F=y.find("td").filter(function(){return"FantasyPros Staff"===jQuery(this).text()}).parents("tr").find("td:eq("+g+") input").val();jQuery.isNumeric(F)&&d.push(F);var v=-1<i.indexOf("updated"),w=-1<i.indexOf("overall"),x=-1<i.indexOf("position");if((w||x)&&f&&y.length>f){var k=-1;w?k=_:x&&(k=m),y.sort(function(e,t){var a=jQuery(t).find("td:eq("+k+")").text().replace("#","")||1/0,s=jQuery(e).find("td:eq("+k+")").text().replace("#","")||1/0;return s-a}),y=y.slice(0,f)}if(v&&c){var D=current_month+1,b=y.filter(function(){var e=jQuery(this).find("td:eq("+P+")").text(),t=current_year;D<e.split("/")[0]&&(t-=1);var a=new Date(e+" "+t);if((current_date-a)/1e3/60/60/24<c+1)return this});1<b.length?y=b:(y.sort(function(e,t){var a=jQuery(t).find("td:eq("+P+")").text(),s=jQuery(e).find("td:eq("+P+")").text(),n=current_year;D<a.split("/")[0]&&(n-=1);var r=new Date(a+" "+n),l=current_year;D<s.split("/")[0]&&(l-=1);var d=new Date(s+" "+l);return r-d}),y=y.slice(0,2))}}y.each(function(){var e=jQuery(this),t=e.find("td").eq(g).find("input").val();d.push(t)})}dlog.log(d),delete l["expert[]"];ajaxCbPos({url:r,method:"get",data:l,timeout:ajax_timeout,custom_data:{cb:a,source_site:r,pos:n}})}).fail(function(){var t=this.custom_data.cb,a=this.custom_data.source_site;fetch_fail=!0,chrome.runtime.sendMessage({request:"fetch_fail",value:a}),t(e,"error")})}}function parsesiteCSV(e){var t,a,s,n=[],r=!1;for(t=a=s=0;s<e.length;s++){var l=e[s],d=e[s+1];if(n[t]=n[t]||[],n[t][a]=n[t][a]||"",","===l&&"undefined"==typeof d&&(a++,n[t][a]=""),"\""===l&&r&&"\""===d){n[t][a]+=l,++s;continue}if("\""===l){r=!r;continue}if(","===l&&!r){++a;continue}if("\n"===l&&!r){++t,a=0;continue}n[t][a]+=l}return n}function convertFProsToCSV(e,t,a){var s=jQuery(e);s.find("thead tr:has(td)").remove(),s.find("tbody tr:not([class^=\"mpb-player\"])").remove();var n=jQuery("table#data, table#rank-data",s).first(),r=n.find("thead th:contains(\"Player\")"),l=r.clone();l.text("Team"),l.insertAfter(r);var d=n.find("tbody tr");d.each(function(e,a){var s=jQuery(a),n=s.find("td.player-label"),r=n.find("a[href^=\"/nfl\"]").first().find("span.full-name").text().trim(),l="";l="proj"===t?n.contents().filter(function(){return 3===this.nodeType}).text().trim():n.find("small:first").text().trim(),l||(l="FA");var d=jQuery("<td>"+l+"</td>");n.text(r),d.insertAfter(n)});var o;return"rank"===t?-1<idp_positions.indexOf(a)?o=fpros_rank_idp_headers:o=fpros_rank_headers:"ros"===t?-1<idp_positions.indexOf(a)?o=fpros_ros_idp_headers:o=fpros_ros_headers:"proj"==t&&(o=fpros_proj_headers[a]),n.table2CSV({delivery:"value",header:o})}function getYahooIds(){storage_translation_data={},jQuery.getJSON(chrome.extension.getURL("data/yahoo_ids.json")).done(function(e){storage_translation_data=e,dlog.log("yahoo IDs done"),yahooIdsDone.resolve(),updated_translation=current_time;var t={};t[storageTranslationKey]=storage_translation_data,t[storageTranslationUpdateKey]=updated_translation,chrome.storage.local.set(t)}).fail(function(e,t,a){var s=t+", "+a;dlog.log("Could not fetch yahoo ID data"),dlog.log(s),chrome.runtime.sendMessage({request:"fetch_fail",value:s})})}function getPosProjections(){function e(e,t){t=t.replace(/<\/?(html|body)>/g,"");var s,n;if("error"!==t){-1<off_positions_proj.indexOf(e)?(s=e.toUpperCase(),t=convertFProsToCSV(t,"proj",s)):s=idp_conversion[e],n=parsesiteCSV(t);for(var r=n[0],l=0;l<r.length;l++)r[l]=r[l].trim();var d=r.indexOf("Team"),o=r.indexOf("Player");if(-1<d&&-1<o)for(var p=1;p<n.length;p++){var f=n[p],c=s;if(f.length<d+1){dlog.log("Error fetching projections");continue}var u=f[d].trim();team_name_conversion.hasOwnProperty(u)&&(u=team_name_conversion[u]);var y=f[o].trim();if("dst"===e)"espn"===siteType?y=y.split(" ").pop()+" D/ST":"yahoo"===siteType?y=team_abbrevs[y]:"fleaflicker"==siteType&&(y=y.split(" ").pop()),y=y.trim(),c="D/ST",u="-";else if(-1<def_positions_proj.indexOf(e)){y=y.split(",")[1]+" "+y.split(",")[0],y=y.trim();var g=fixPlayerName(y,c,u,"proj");g?y=g[0]:player_name_fix.hasOwnProperty(y)&&(y=player_name_fix[y]),player_position_fix_sharks.hasOwnProperty(y)&&(c=player_position_fix_sharks[y]),y=y.trim()}y=y.toUpperCase();var _=y+"|"+c+"|"+u;alldata.hasOwnProperty(_)||(alldata[_]={});for(var m=o+1;m<r.length;m++)alldata[_][r[m].trim()]=f[m].trim().replace(",","")}}--a,0===a&&(updated_times.proj=current_time,updated_types.proj=((experts.proj||{}).selection||"none").toString(),addProjections())}for(var t,a=all_positions_proj.length,s=0;s<all_positions_proj.length;s++)t=all_positions_proj[s],fetchPositionData(t,"proj",e)}function getPosRankings(){function e(e,t){var s,n;if("error"!==t){s=e.toUpperCase(),t=convertFProsToCSV(t,"rank",s),n=parsesiteCSV(t);for(var r=n[0],l=0;l<r.length;l++)r[l]=r[l].trim();var d=r.indexOf("Team"),o=r.indexOf("Player");if(-1<d&&-1<o)for(var p=1;p<n.length;p++){var f=n[p],c=s,u=f[d].trim();team_name_conversion.hasOwnProperty(u)&&(u=team_name_conversion[u]);var y=f[o].trim();"dst"===e&&("espn"===siteType?y=y.split(" ").pop()+" D/ST":"yahoo"===siteType?y=team_abbrevs[y]:"fleaflicker"==siteType&&(y=y.split(" ").pop()),c="D/ST",u="-"),y=y.trim().toUpperCase();var g=y+"|"+c+"|"+u;alldata.hasOwnProperty(g)||(alldata[g]={});for(var _=o+1;_<r.length;_++)alldata[g][r[_].trim()]=f[_].trim()}}if(--a,0===a){updated_times.rank=current_time;var m=experts.rank||{},P=m.num||{};updated_types.rank=(m.selection||"none").toString()+"-"+(P.top||0)+"-"+(P.updated||0),addRankings()}}for(var t,a=all_positions_rank.length,s=0;s<all_positions_rank.length;s++)t=all_positions_rank[s],fetchPositionData(t,"rank",e)}function getRosRankings(){function e(e,t){var s,n;if("error"!==t){s=e.toUpperCase(),t=convertFProsToCSV(t,"ros",s),n=parsesiteCSV(t);for(var r=n[0],l=0;l<r.length;l++)r[l]=r[l].trim();var d=r.indexOf("Team"),o=r.indexOf("Player");if(-1<d&&-1<o)for(var p=1;p<n.length;p++){var f=n[p],c=s,u=f[d].trim();team_name_conversion.hasOwnProperty(u)&&(u=team_name_conversion[u]);var y=f[o].trim();"dst"===e&&("espn"===siteType?y=y.split(" ").pop()+" D/ST":"yahoo"===siteType?y=team_abbrevs[y]:"fleaflicker"==siteType&&(y=y.split(" ").pop()),c="D/ST",u="-"),y=y.trim().toUpperCase();var g=y+"|"+c+"|"+u;alldata.hasOwnProperty(g)||(alldata[g]={});for(var _=o+1;_<r.length;_++)alldata[g][r[_].trim()+" Ros"]=f[_]?f[_].trim():""}}if(--a,0===a){updated_times.ros=current_time;var m=experts.ros||{},P=m.num||{};updated_types.ros=(m.selection||"none").toString()+"-"+(P.top||0)+"-"+(P.updated||0),addRos()}}for(var t,a=all_positions_rank.length,s=0;s<all_positions_rank.length;s++)t=all_positions_rank[s],fetchPositionData(t,"ros",e)}function getPlayerCheckName(e,a,s,t){var n=null;return"proj"===t?n=e.toUpperCase()+"|"+a+"|"+s:"depth"==t&&(n=e.toUpperCase()),n}function fixPlayerPosition(e,t,a){var s={};return"proj"===a?s=player_position_fix:"depth"==a&&(s=player_position_fix_depth),player_name_fix.hasOwnProperty(e)&&(e=player_name_fix[e]),s.hasOwnProperty(e)&&(t=s[e]),"string"==typeof t&&t.indexOf(",EDR")?t=t.replace(",EDR",""):t.constructor===Array&&(t=t.filter(function(e){return"EDR"!==e})),t}function fixPlayerName(e,t,s,r,l){l="undefined"==typeof l?alldata:l;var d=t;t.constructor!==Array&&(d=[t]);for(var o=0;o<d.length;o++){if(t=d[o],"proj"===r&&("DT"===t||"DE"===t?t="DL":("CB"===t||"S"===t)&&(t="DB")),l.hasOwnProperty(getPlayerCheckName(e,t,s,r)))return[e,t];if(player_name_fix.hasOwnProperty(e)){var i=player_name_fix[e];if(l.hasOwnProperty(getPlayerCheckName(i,t,s,r)))return dlog.log("fixed name: "+e+"; is now: "+i),[i,t]}else{var p,f,c,u,y,h,g=[e],_=e.split(" "),m=_[0],P=_.slice(1).join(" ");if(m===m.toUpperCase()){if(c=m.split("").join(".")+". "+P,l.hasOwnProperty(getPlayerCheckName(c,t,s,r)))return dlog.log("fixed name: "+e+"; is now: "+c),[c,t];g.push(c)}var F=/( V| IV| III| II| Jr\.| Sr\.)$/;p=g.length;for(var v=0;v<p;v++){f=g[v];var w=f.match(F);if(w){var x=w[1];if(u=f.slice(0,f.indexOf(x)),l.hasOwnProperty(getPlayerCheckName(u,t,s,r)))return dlog.log("fixed name: "+e+"; is now: "+u),[u,t];g.push(u)}}p=g.length;for(var k=0;k<p;k++){f=g[k];var b=f.split(" "),D=b[0],T=b.slice(1).join(" ");if(player_name_translations.hasOwnProperty(D)){if(y=player_name_translations[D]+" "+T,l.hasOwnProperty(getPlayerCheckName(y,t,s,r)))return dlog.log("fixed name: "+e+"; is now: "+y),[y,t];g.push(y)}}var R=[" V"," IV"," III"," II"," Jr."," Sr."];p=g.length;for(var S=0;S<p;S++){f=g[S];for(var C=0;C<R.length;C++){if(h=f+R[C],l.hasOwnProperty(getPlayerCheckName(h,t,s,r)))return dlog.log("fixed name: "+e+"; is now: "+h),[h,t];g.push(h)}}}}return!1}function parseDepth(e){var t={},a="",s=jQuery("div.article-content > table > tbody> tr > td.la > table tbody tr",e);s.each(function(e,s){var n=jQuery(s),r=n.find("b");0==e%2?(a=r.text(),t[a]={}):r.each(function(e,s){var n=jQuery(s),r=n.text().replace(":","");"NT"===r?r="DT":("OLB"===r||"ILB"===r||"MLB"===r)&&(r="LB"),t[a].hasOwnProperty(r)||(t[a][r]={});var l=!1,d=1,o=n.nextUntil("br");o.each(function(e,s){if(l)return void(l=!1);l=!1;var i=jQuery(s),p=i.text().trim(),f=p,c=jQuery(o[e+1]).text().trim();c&&/^\(/.test(c)&&(l=!0,p+=" "+c);var u=[];if(-1<p.indexOf("(")){var y=p.match(/\([\w/]+\)/g);if(y&&y.length)for(var h=0;h<y.length;h++)u.push(y[h].replace(/[()]/g,"").toUpperCase());f=p.slice(0,p.indexOf(" ("))}f=f.replace(/[�′]+/g,"'"),player_name_fix.hasOwnProperty(f)&&(f=player_name_fix[f]);var g=f.toUpperCase(),_=i.find("font").addBack("font").attr("color");if(f.length){if(t[a][r].hasOwnProperty(g))return;t[a][r][g]={name:f,num:d,status:u,type:_}}d+=1})})}),depth_data[current_season]["W"+current_week]=t,depth_data_current_week=depth_data[current_season]["W"+current_week],updated_depth=current_time,addDepth()}function getDepth(){jQuery.ajax({url:depth_url,timeout:ajax_timeout}).done(function(e){e=cleanHTML(e),parseDepth(e)}).fail(function(){depth_fail=!0,chrome.runtime.sendMessage({request:"fetch_fail",value:depth_url}),addDepth()})}function getPlayerData(){show_proj?getPosProjections():(projDone.resolve(),hasProjTotals?addProjTotals():totalsDone.resolve()),show_rank?getPosRankings():rankDone.resolve(),show_ros?getRosRankings():rosDone.resolve()}function getAllData(e){e="undefined"==typeof e?["proj","rank","ros"]:e,show_proj||show_rank||show_ros?isDataCurrent(e)?(dlog.log("Using cache for player data"),addPlayerData()):(alldata={},updated_times={},updated_types={},updatePlayerStorage(),getPlayerData()):(projDone.resolve(),hasProjTotals?addProjTotals():totalsDone.resolve(),rankDone.resolve(),rosDone.resolve()),show_avg||show_med||show_spark||show_current?(updateActivityStorage(),addAvg()):activityDone.resolve(),show_depth?isDataCurrent("depth")?(dlog.log("Using cache for depth data"),addDepth()):(dlog.log("resetting depth"),depth_data[current_season]["W"+current_week]={},depth_data_current_week=depth_data[current_season]["W"+current_week],updated_depth=0,updateDepthStorage(),getDepth()):depthDone.resolve()}function validPosition(e,t){var a=[t];return-1<t.indexOf("/")&&"D/ST"!==t?a=t.split("/"):"FLEX"===t?a=["RB","WR","TE"]:"OP"===t?a=["QB","RB","WR","TE"]:"DL"===t?a=["DE","EDR","DT"]:"DB"===t?a=["CB","S"]:"DP"==t&&(a=["DE","EDR","DT","LB","CB","S"]),-1<a.indexOf(e)}function optimizeLineup(){observer_disconned=!0,observer&&observer.disconnect(),setSelectors(!1);var e=[],t=jQuery(".FantasyPlusProjectionsData");t.each(function(){var t=jQuery(this),a=parseFloat(t.text()),s=t.parent("tr"),n=s.find(player_name_selector).attr("id");if("undefined"!=typeof n){var r=getPlayerCellText(s,t),l=_slicedToArray(r,2),d=l[0],o=l[1],i=getPlayerDataFromCell(d,o),p=i[1];e.push([n,p,a])}}),e.sort(function(e,t){var a=t[2]-e[2];return isFinite(a)?a:isFinite(e[2])?-1:1});var a=player_table_body.find(player_table_header_selector),s=a.first().nextUntil(a.last()).not(".playerTableBgRowHead, .FantasyPlus"),n=0,r=100,l=[];s.each(function(){var t=jQuery(this),a=t.find(player_cell_pos_selector).text().trim(),s=t.find(".pncButtonLocked");if(0===s.length){var n=e.filter(function(e){var t=e[1];if(Array.isArray(t)){var s=!1;return t.forEach(function(e){!0===validPosition(e,a)&&(s=!0)}),s}return validPosition(t,a)});if(0<n.length){var r=n[0],d=e.findIndex(function(e){return e[0]===r[0]});e[d]=[null,null,null];var o=player_table_body.find("#"+r[0]).parent("tr"),i=o.find(player_cell_pos_selector).text().trim();if(i!==a){var p=o.find(".pncButtonMove");if(p.length){l.push([p,t]);var f=t.find(".pncButtonMove");f.length&&l.push([f,null])}}}}});var d=[],o=player_table_body.find("tr.playerTableBgRowHead:last");l.forEach(function(e){var t=e[0],a=e[1],s=t.parents("tr").first().find(player_cell_pos_selector).text().trim();"Bench"!==s&&(setTimeout(function(){t.trigger("click");var e=o.nextAll(player_table_row_selector).not(".irRow").find(".pncButtonHere:visible").first(),s=e.parent("td").attr("id");a&&d.push([s,a]),e.trigger("click")},n),n+=r)}),0!==n&&setTimeout(function(){var e=0;d.forEach(function(t){var a=t[0],s=a.find(".pncButtonMove:visible").first(),n=t[1];setTimeout(function(){s.trigger("click");var e=player_table_body.find(n),t=e.find(".pncButtonHere:visible").first();t.trigger("click")},e),e+=r}),setTimeout(function(){refreshData()},e+r)},n+r)}function calcBonus(e,t){var a,s=Math.min,n=Math.max,r=0;if("yahoo"===siteType){a=[];var d=league_settings[e+"_bonus"];for(var o in d)d.hasOwnProperty(o)&&a.push(parseFloat(o));a=a.sort().reverse();for(var i=0;i<a.length;i++)parseFloat(a[i+1])&&parseFloat(a[i])?r+=d[a[i]]*(a[i]<=t[e+"_yds"]&&t[e+"_yds"]<a[i+1]):parseFloat(a[i])&&(r+=d[a[i]]*(t[e+"_yds"]>=a[i]))}else if("fleaflicker"===siteType&&(a=league_settings[e+"_bonus"],a&&a.length)){dlog.info(t);for(var p=0;p<a.length;p++){var f=a[p],c=f.pts,u=f.low,y=f.high,h=f.is_per,g="number"==typeof u,_="number"==typeof y,m=!1;if(h?m=!0:g&&_?m=u<=t&&y>=t:g?m=u<=t:_&&(m=y>=t),m){var P=0;if(h){var F=t;g&&_?(0>=u&&(u+=1),F=n(s(t-u+1,y-u+1),0)):g?F=n(t-u,0):_&&(F=n(s(t,y),0)),P=c*F}else P=c;r+=P}}}return r}function calculateProjections(e,t,a,s){var r=Math.round,l=Math.max;if("depth"===e)return[t,a,s];var d=t.toUpperCase();"DT"===a||"DE"===a?a="DL":("CB"===a||"S"===a)&&(a="DB"),a=fixPlayerPosition(t,a,"proj");var o;if("proj-default"===e)jQuery.isArray(a)&&(a=a[0]),"DT"===a||"DE"===a?a="DL":("CB"===a||"S"===a)&&(a="DB"),o=expected_player[a],isObj(o)||(o={});else{var i=d+"|"+a+"|"+s;if(o=alldata[i],"undefined"==typeof o){var p=fixPlayerName(t,a,s,"proj");if(p)t=p[0],a=p[1],d=t.toUpperCase(),i=d+"|"+a+"|"+s,o=alldata[i];else return dlog.log("Could not find player: "+i),"proj"===e?"--":["--","--"]}}if(dlog.info("player data: "),dlog.info(o),"proj"===e||"proj-default"===e){for(var f,c=0,u=["pass_yds","pass_tds","pass_ints","pass_att","pass_cmp","pass_icmp","pass_firstdown","rush_yds","rush_tds","rush_att","rush_firstdown","rec_yds","rec_att","rec_tds","rec_firstdown","xpt","fg","fga","fgm","fumbles"],y={sk:"def_sack",ff:"def_ff",int:"def_int",deftd:"def_td",fr:"def_fr",pa:"def_pa",ya:"def_tyda",sf:"def_safety"},h={sk:"Scks",ff:"FumFrc",tka:"Tack",tks:"Asst",pd:"PassDef",int:"Int",deftd:"DefTD",fr:"Fum"},g={pass:{QB:.349},rush:{QB:.304,RB:.205,WR:.317},rec:{RB:.353,WR:.627,TE:.567}},_=0;_<u.length;_++)if(f=u[_],dlog.info(f),league_settings.hasOwnProperty(f)){var m=league_settings[f];dlog.info(m);var P=0;"pass_icmp"===f?P=l((o.pass_att||0)-(o.pass_cmp||0),0):"fgm"===f?P=l((o.fga||0)-(o.fg||0),0):"pass_firstdown"===f?g.pass.hasOwnProperty(a)&&(P=g.pass[a]*o.pass_att):"rush_firstdown"===f?g.rush.hasOwnProperty(a)&&(P=g.rush[a]*o.rush_att):"rec_firstdown"===f?g.rec.hasOwnProperty(a)&&(P=g.rec[a]*o.rec_att):P=o[f]||0,dlog.info(P);var F=m*P;if(dlog.info(F),c+=F,"fleaflicker"===siteType){var v=calcBonus(f,P);dlog.info(v),c+=v}}var w={};for(var x in"D/ST"===a?w=y:-1<idp_positions.indexOf(a)&&(w=h),w)if(w.hasOwnProperty(x)&&league_settings.hasOwnProperty(x)){var k=w[x];dlog.info(x+", "+k);var b=league_settings[x];dlog.info(b);var D=o[k]||0;dlog.info(D);var T=b*D;if(dlog.info(T),c+=T,"fleaflicker"===siteType){var R=calcBonus(x,D);dlog.info(R),c+=R}}var S=0;return"espn"===league_settings.siteType?S=league_settings.pass_300_bonus*(300<=o.pass_yds&&400>o.pass_yds)+league_settings.pass_400_bonus*(400<=(o.pass_yds||0))+league_settings.rush_100_bonus*(100<=o.rush_yds&&200>o.rush_yds)+league_settings.rush_200_bonus*(200<=(o.rush_yds||0))+league_settings.rec_100_bonus*(100<=o.rec_yds&&200>o.rec_yds)+league_settings.rec_200_bonus*(200<=(o.rec_yds||0))+league_settings.pa0*(0===o.def_pa)+league_settings.pa1*(0<o.def_pa&&6>=o.def_pa)+league_settings.pa7*(6<o.def_pa&&13>=o.def_pa)+league_settings.pa14*(13<o.def_pa&&17>=o.def_pa)+league_settings.pa18*(17<o.def_pa&&21>=o.def_pa)+league_settings.pa22*(21<o.def_pa&&27>=o.def_pa)+league_settings.pa28*(27<o.def_pa&&34>=o.def_pa)+league_settings.pa35*(34<o.def_pa&&45>=o.def_pa)+league_settings.pa46*(45<o.def_pa)+league_settings.ya100*(0<=o.def_tyda&&100>o.def_tyda)+league_settings.ya199*(100<=o.def_tyda&&200>o.def_tyda)+league_settings.ya299*(200<=o.def_tyda&&300>o.def_tyda)+league_settings.ya349*(300<=o.def_tyda&&350>o.def_tyda)+league_settings.ya399*(350<=o.def_tyda&&400>o.def_tyda)+league_settings.ya449*(400<=o.def_tyda&&450>o.def_tyda)+league_settings.ya499*(450<=o.def_tyda&&500>o.def_tyda)+league_settings.ya549*(500<=o.def_tyda&&550>o.def_tyda)+league_settings.ya550*(550<=o.def_tyda):"yahoo"===league_settings.siteType&&(S=calcBonus("pass",o)+calcBonus("rush",o)+calcBonus("rec",o)+league_settings.pa0*(0===o.def_pa)+league_settings.pa1*(0<o.def_pa&&6>=o.def_pa)+league_settings.pa7*(6<o.def_pa&&13>=o.def_pa)+league_settings.pa14*(13<o.def_pa&&20>=o.def_pa)+league_settings.pa21*(20<o.def_pa&&27>=o.def_pa)+league_settings.pa28*(27<o.def_pa&&34>=o.def_pa)+league_settings.pa35*(34<o.def_pa)+league_settings.ya100*(0<=o.def_tyda&&100>o.def_tyda)+league_settings.ya199*(100<=o.def_tyda&&200>o.def_tyda)+league_settings.ya299*(200<=o.def_tyda&&300>o.def_tyda)+league_settings.ya399*(300<=o.def_tyda&&400>o.def_tyda)+league_settings.ya499*(400<=o.def_tyda&&500>o.def_tyda)+league_settings.ya500*(500<=o.def_tyda)),c+=S,dlog.info("returning score: "),dlog.info(t+","+c),isNaN(c)?(dlog.log("bad player score"),"--"):(r(10*c)/10).toFixed(1)}if("rank"===e){if(parseFloat(o["Avg Rank"])){var C=(r(10*o["Avg Rank"])/10).toFixed(1),A=(r(1.96*(10*o["Std Dev"]))/10).toFixed(1);return[C,A]}return["--","--"]}if("ros"===e){if(parseFloat(o["Avg Rank Ros"])){var B=(r(10*o["Avg Rank Ros"])/10).toFixed(1),O=(r(1.96*(10*o["Std Dev Ros"]))/10).toFixed(1);return[B,O]}return["--","--"]}}function getPlayerDataFromCell(e,t){var a,s="",n="",r="";if("espn"===siteType){if(-1<t.indexOf("D/ST"))s=e.find("a").text().trim(),r="-",n="D/ST";else{for(var l=t.split(","),d=0;d<l.length;d++)l[d]=l[d].trim();s=l[0];var o=l[1].split(/\s|\xa0/);if(r=o[0].toUpperCase(),"JAX"===r?r="JAC":"WSH"===r&&(r="WAS"),n=o[1],2<l.length){n=[n],a=l.slice(2);for(var i,p,f=0;f<a.length&&(i=a[f],!!i);f++)p=i.split(/\s|\xa0/),n.push(p[0])}}s=s.replace("*","")}else if("yahoo"===siteType){var c=e.find(".ysf-player-name"),u=c.find("span").first().text().trim().split(" - ");r=u[0].toUpperCase(),"JAX"===r&&(r="JAC"),n=u[1],-1<n.indexOf(",")?(a=n.split(","),n=[],a.forEach(function(e){n.push(e.trim())})):"DEF"===n&&(n="D/ST"),s=c.find("a").text().trim(),"D/ST"===n&&(s=r,r="-")}else if("fleaflicker"===siteType){if(s=e.find("div.player-name .player-text").text().trim(),r=e.find("div.player-info span.player-team").text().trim(),n=e.find("div.player-info span.position").text().trim(),"D/ST"===n){var y=s.split(/\s|\xa0/);s=y[y.length-1],r="-"}else-1<n.indexOf("/")&&(a=n.split("/"),n=[],a.forEach(function(e){n.push(e.trim())}));r in team_abbrev_fix_fleaflicker&&(r=team_abbrev_fix_fleaflicker[r]),s=s.replace("*","")}return[s,n,r]}function getPlayerCellText(e,t){var a=e.find(player_name_selector);"yahoo"===siteType&&onMatchupPreviewPage&&(a=t.nearest("td.player"));var s=a.text().trim();return a.find(".fantasy-finder")&&(a=a.clone(),a.find("#inline-availability-marker").remove(),s=a.text().trim().replace(/([\r\n])/g,"")),[a,s]}function getProjectionData(e,t,a){var s,n,r=getPlayerCellText(t,a),l=_slicedToArray(r,2);s=l[0],n=l[1];var d,o;if("adjavg"===e){var p;if(show_avg){var f=t.find("FantasyPlusAvgData");p=f.prev().text()}else if(show_med){var c=t.find("FantasyPlusMedianData");p=c.prev().text()}if(!n||"--"===p)insertAdjAvg(t,null,null,[],[]);else{var u=!1;if("espn"!==siteType)"fleaflicker"===siteType&&(d=s.find("div.player-name a.player-text").attr("href"),d&&(o=d.split("-").pop()));else if(o=s.find("a").attr("playerid"),show_current){var y=t.find(".gameStatusDiv").text().trim();y&&-1<y.indexOf("-")&&(" "===y[1]?u="done":(dlog.log("found live game: "+y),u="live"))}if(!o)insertAdjAvg(t,null,null,[],[]);else{goodVal(activity_data_current_season_site,o,"object")||(activity_data_current_season_site[o]={});var h=activity_data_current_season_site[o],g=o;h.hasOwnProperty("translation")&&(g=h.translation,dlog.log("found translation data for: "+o+", is: "+g),delete h.games_played,delete h.games_played_updated,delete h[league_id],!goodVal(activity_data_current_season_site,g,"object")&&(dlog.log("did not find rookie player data from translation"),activity_data_current_season_site[g]={}),h=activity_data_current_season_site[g]),goodVal(h,"games_played","array")||(h.games_played=[]);var _=h.games_played;goodVal(h,"games_played_updated","number")||(h.games_played_updated=0);var m=h.games_played_updated;goodVal(h,league_id,"object")||(h[league_id]={});var P=h[league_id];goodVal(P,"weekly_points","array")||(P.weekly_points=[]);var F=P.weekly_points;P.hasOwnProperty("pts_avg")||(P.pts_avg=null);var v=P.pts_avg;P.hasOwnProperty("pts_med")||(P.pts_med=null);var w=P.pts_med;P.hasOwnProperty("last_updated")||(P.last_updated=0);var x=P.last_updated;if(isActivityDataCurrent(g,x,"league",u)&&isActivityDataCurrent(g,m,"games"))dlog.info("Using cache for player activity: "+g),insertAdjAvg(t,v,w,_,F);else if("espn"===siteType){var k={leagueId:league_id,playerId:o,playerIdType:"playerId",seasonId:current_season_avg,xhr:"1"};jQuery.ajax({url:"//games.espn.com/ffl/format/playerpop/overview",timeout:ajax_timeout,method:"get",data:k,custom_data:{curr_row:t,player_cell_text:n,id:g,old_id:o}}).fail(function(){var e=this.custom_data.old_id,t=this.custom_data.curr_row;dlog.log("failed to get player pop: "+e),insertAdjAvg(t,null,null,[],[])}).done(function(e){var t=this.custom_data,a=t.id,s=t.old_id,n=t.curr_row,r=t.player_cell_text;if(!e)dlog.log("No data in pop: "+s),insertAdjAvg(n,null,null,[],[]);else{e=cleanHTML(e);var l=jQuery(e),d=activity_data_current_season_site[a],o=d[league_id];"undefined"==typeof o&&(o={});var p=jQuery("div#tabView0 div#moreStatsView0",l),f=p.find("div.pc:not(#pcBorder)"),c=f.find("a[href*=\"playerId\"], a[href*=\"proId\"]"),u=null;c.length&&(u=c.attr("href").match(/(playerId=|proId\/)(\d+)/)[2]),null!==u&&u!==a&&(dlog.log("found rookie: "+u+", "+a),d.translation=u,a=u,activity_data_current_season_site[a]={},d=activity_data_current_season_site[a],d.games_played=[],d.games_played_updated=0,d[league_id]={},o=d[league_id],o.weekly_points=[],o.pts_avg=null,o.pts_med=null,o.last_updated=0);var y=p.find("div#pcBorder table tbody"),h=y.find("tr.pcStatHead"),g=h.find("td:contains(\"OPP\")").first().index()+1,_=h.find("td:contains(\"PTS\")").first().index()+1,m=y.find("tr:not(.pcStatHead)"),P=m.find("td:nth-child("+g+")"),F=m.find("td:nth-child("+_+")"),v=P.filter(function(){return /BYE/.test(jQuery(this).text())}),w=null;1===v.length&&(w=parseFloat(v.prev().text().trim()));for(var x,k=jQuery.map(F,function(e){return e.innerText}),b=0;b<k.length;b++)x=jQuery.isNumeric(w)&&b==w-1,"undefined"==typeof d.games_played&&(d.games_played=[]),x?d.games_played[b]="BYE":r.match(/(D\/ST|TQB|HC)$/)&&jQuery.isNumeric(k[b])?d.games_played[b]=1:"undefined"==typeof d.games_played[b]?d.games_played[b]=null:"BYE"===d.games_played[b]&&(d.games_played[b]=null),k[b]="-"===k[b]?null:parseFloat(k[b]);if(dlog.info("Player Activity pts"),dlog.info(k),o.last_updated=current_time,o.weekly_points=k,"undefined"==typeof o.weekly_points&&(o.weekly_points=[]),r.match(/(D\/ST|TQB|HC)$/))dlog.log("inserting avg for dsts, etc. for: "+a),d.games_played_updated=current_time,calcAdjAvg(n,a,d.games_played,o.weekly_points);else if(isActivityDataCurrent(a,d.games_played_updated,"games"))dlog.info("using cache for games played for: "+a),calcAdjAvg(n,a,d.games_played,o.weekly_points);else{var D={playerId:a,season:current_season_avg_week,xhr:1};jQuery.ajax({url:"//m.espn.com/nfl/playergamelog",timeout:ajax_timeout,data:D,method:"get",custom_data:{curr_row:n,id:a}}).fail(function(){var e=this.custom_data,t=e.id,a=e.curr_row,s=activity_data_current_season_site[t][league_id].weekly_points;dlog.log("failed to get player card: "+t),insertAdjAvg(a,null,null,[],s)}).done(function(e){var t=this.custom_data,a=t.id,s=t.curr_row,n=activity_data_current_season_site[a],r=n[league_id];if("undefined"==typeof r&&(r={}),"undefined"==typeof r.weekly_points&&(r.weekly_points=[]),!e)dlog.log("No data in player card: "+a),insertAdjAvg(s,null,null,[],r.weekly_points);else{e=cleanHTML(e);var l=jQuery(e),d=jQuery("tr td:contains(\"POSTSEASON\")",l).parents("tr"),o=jQuery("tr td:contains(\"REGULAR SEASON\")",l).parents("tr").nextUntil(d).filter(function(){return 1<jQuery(this).find("td").length});o.each(function(e,t){if("BYE"!==n.games_played[e]){var a=jQuery(t),s=a.text();-1<s.indexOf("DID NOT PLAY")?n.games_played[e]=0:-1===s.indexOf("BYE")&&(n.games_played[e]=1)}});for(var i=0;i<n.games_played.length;i++)null===n.games_played[i]&&i<current_week_avg-1&&(n.games_played[i]=0),1!==n.games_played[i]&&(r.weekly_points[i]=null);n.games_played_updated=current_time,calcAdjAvg(s,a,n.games_played,r.weekly_points)}})}}})}else"fleaflicker"===siteType&&jQuery.ajax({url:d,method:"get",timeout:ajax_timeout,custom_data:{curr_row:t,p_href:d,pid:o}}).fail(function(){var e=this.custom_data,t=e.p_href,a=e.curr_row;dlog.log("Could not get player info: "+t),insertAdjAvg(a,null,null,[],[])}).done(function(e){var t=this.custom_data,a=t.p_href,s=t.curr_row,n=t.pid;if(!e)dlog.log("No data in player info: "+a),insertAdjAvg(s,null,null,[],[]);else{e=cleanHTML(e);for(var r=jQuery(e),l=activity_data_current_season_site[n],d=l[league_id],o=jQuery("table#table_0",r),p=o.find("tbody").find(player_table_row_selector).not(".divider"),f=p.find("div.pro-opp-matchup").filter(function(){return"BYE"===jQuery(this).text().trim()}),c=f.parents("tr").index(),u=jQuery.map(p,function(e){return jQuery(e).find("td:last").text()}),y=0;y<u.length;y++)y===c?(u[y]=null,l.games_played[y]="BYE"):"\u2014"===u[y]?(u[y]=null,l.games_played[y]=0):""===u[y]?(u[y]=null,l.games_played[y]=null):(u[y]=parseFloat(u[y]),l.games_played[y]=1);l.games_played_updated=current_time,d.last_updated=current_time,d.weekly_points=u,insertAdjAvg(s,null,null,l.games_played,d.weekly_points)}})}}}else{if(!n||"(Empty)"===n)return"fleaflicker"===siteType&&onMatchupPreviewPage?(total_player_ids--,0>=total_player_ids&&fetchFleaflickerIds.resolve(),popCell(a,"",e)):"rank"===e||"ros"===e?popCell(a,["--","--"],e):popCell(a,"--",e);if(n.match(/(TQB|HC|P)$/))return"rank"===e||"ros"===e?popCell(a,["--","--"],e):popCell(a,"--",e);var b,D,T,R=getPlayerDataFromCell(s,n),S=R[0],C=R[1],A=R[2];if("espn"===siteType)return b=calculateProjections(e,S,C,A),popCell(a,b,e);if("yahoo"===siteType){if(onMatchupPreviewPage||onFreeAgencyPage){if(d=s.find(".ysf-player-name").find("a").attr("href"),o=d.split("/").pop(),T=storage_translation_data.hasOwnProperty("ID_"+o),dlog.info("id is "+o+", seen is "+T),D=alldata.hasOwnProperty(S.toUpperCase()+"|"+C+"|"+A),"D/ST"===C||T||D)return T&&(S=storage_translation_data["ID_"+o]),b=calculateProjections(e,S,C,A),popCell(a,b,e);dlog.log("Could not find player in yahoo database: "+d+", "+S)}else return b=calculateProjections(e,S,C,A),popCell(a,b,e);}else if("fleaflicker"===siteType){if("depth"===e)if(C.constructor===Array){var B=[];C.forEach(function(e){"DL"===e?B.push("DE","DT"):"DB"===e?B.push("CB","S"):B.push(e)}),C=B}else"DL"===C?C=["DE","DT"]:"DB"===C&&(C=["CB","S"]);if(onMatchupPreviewPage){d=s.find("div.player-name a.player-text").attr("href");var O=d.split("/").pop(),j=O.split("-");o=j.pop();for(var E=[],L=0;L<j.length;L++)E.push(j[L].toUpperCase());var M=E.join(" ");if(T=storage_translation_data.hasOwnProperty("ID_"+o),D=alldata.hasOwnProperty(M+"|"+C+"|"+A),"D/ST"===C||T||D)return D?S=M:T&&(S=storage_translation_data["ID_"+o]),total_player_ids--,0>=total_player_ids&&fetchFleaflickerIds.resolve(),b=calculateProjections(e,S,C,A),popCell(a,b,e);jQuery.ajax({url:d,method:"get",timeout:ajax_timeout,custom_data:{p_href:d,pid:o,pos_name:C,team_name:A,datatype:e,cell:a}}).done(function(e){e=cleanHTML(e);var t=this.custom_data,a=t.pid,s=t.pos_name,r=t.team_name,l=t.datatype,d=t.cell,o=jQuery(e),i=o.find("#left-container > div.panel > div.panel-heading").text();b=calculateProjections(l,i,s,r),popCell(d,b,l);var n={};storage_translation_data["ID_"+a]=i,n[storageTranslationKey]=storage_translation_data,chrome.storage.local.set(n)}).fail(function(){var e=this.custom_data,t=e.p_href,a=e.datatype,s=e.cell;popCell(s,"--",a),chrome.runtime.sendMessage({request:"fetch_fail",value:t})}).always(function(){total_player_ids--,0>=total_player_ids&&fetchFleaflickerIds.resolve()})}else return b=calculateProjections(e,S,C,A),popCell(a,b,e)}return null}}function calcAdjAvg(e,t,a,s){var n=Math.round,r=0,l=0,d=null,o=null,i=s.slice(0,current_week_avg-1),p=[];dlog.info("Past points data"),dlog.info(i),dlog.info(a);for(var f=0;f<i.length;f++)if(1===a[f]){var c=parseFloat(i[f])||0;p.push(c),r+=c,l++}if(0<l){var u=parseFloat(r/l);d=(n(10*u)/10).toFixed(1);var y=p.sort(function(e,t){return e-t}),h=y.length/2,_=0==h%1?(y[h-1]+y[h])/2:y[Math.floor(h)];o=(n(10*_)/10).toFixed(1)}"undefined"==typeof activity_data_current_season_site[t][league_id]&&(activity_data_current_season_site[t][league_id]={}),activity_data_current_season_site[t][league_id].pts_avg=d,activity_data_current_season_site[t][league_id].pts_med=o,insertAdjAvg(e,d,o,a,s)}function insertAdjAvg(e,t,a,s,n){var r,l,d=Math.min,o=Math.max;if(show_avg&&(l=e.find(".FantasyPlusAvgData"),r=parseFloat(l.prev().text()),jQuery.isNumeric(t)?t>r?l.html("<span style=\"color:green\">"+t+"</span>"):l.text(t):l.text("--")),show_med&&(l=e.find(".FantasyPlusMedianData"),parseFloat(r)&&(r=parseFloat(t)),jQuery.isNumeric(a)?a>r?l.html("<span style=\"color:green\">"+a+"</span>"):a<r?l.html("<span style=\"color:red\">"+a+"</span>"):l.text(a):l.text("--")),show_current){var i=e.find(".FantasyPlusCurrentData"),p="--";n&&0<n.length?(current_season===current_season_avg_week&&jQuery.isNumeric(n[current_week-1])&&(p=n[current_week-1]),i.text(p)):i.text(p)}if(show_spark){var f=e.find(".FantasyPlusSparkData");if(n&&0<n.length){var c=e.find(player_name_selector),u=c.text().trim(),y=[];y=u.match(/TQB$/)?["-","QB","-"]:u.match(/HC$/)?["-","HC","-"]:u.match(/P$/)?["-","P","-"]:getPlayerDataFromCell(c,u);var h=y[0],g=y[1],_=y[2],m=calculateProjections("proj-default",h,g,_);dlog.info("we expect for pos: "+g+", to get: "+m),jQuery.isNumeric(m)&&(m=+m);var P=m*(4/3),F=m*(2/3),v=P+":",w=F+":"+(P+""),x=":"+(F+""),k={null:"#999"};0===m?(k[v]="#5C5D5E",k[w]="#5C5D5E",k[x]="#5C5D5E"):(k[v]="#336600",k[w]="#FF6600",k[x]="#CC0000");var D=o(0,d(17,current_week_avg)-6),b=n.slice(D,d(o(0,current_week_avg-1),17));if(b&&1<b.length){var T={disableHiddenCheck:!0,width:"35px",height:"20px",chartRangeMin:0,tooltipSkipNull:!1,tooltipFormatter:function(e,t,a){var n,r=a.x,l=a.y,d=s[r+D];return n="BYE"===d?"Bye":0===d?"Out":Math.round(10*l)/10,"W"+(r+D+1)+": "+n},type:"line",fillColor:!1,lineColor:"gray",valueSpots:k,minSpotColor:!1,maxSpotColor:!1,spotColor:!1,spotRadius:2};"fleaflicker"===siteType&&(T.height="25px",T.width="40px",T.tooltipClassname="fp-jqstooltip"),f.sparkline(b,T)}else f.text("--")}else f.text("--")}total_players--,0===total_players&&(dlog.log("avg done"),activityDone.resolve())}function reDefer(){(-1<header_index||"fleaflicker"===siteType&&hasProjectionTable)&&(projDone=jQuery.Deferred(),rankDone=jQuery.Deferred(),rosDone=jQuery.Deferred(),activityDone=jQuery.Deferred(),depthDone=jQuery.Deferred(),totalsDone=jQuery.Deferred(),"yahoo"===siteType&&(onMatchupPreviewPage||onFreeAgencyPage)?yahooIdsDone=jQuery.Deferred():"fleaflicker"==siteType&&onMatchupPreviewPage&&(fetchFleaflickerIds=jQuery.Deferred()))}function addPlayerData(){-1<header_index||"fleaflicker"===siteType&&hasProjectionTable?(show_proj?addProjections():(projDone.resolve(),hasProjTotals?addProjTotals():totalsDone.resolve()),show_rank?addRankings():rankDone.resolve(),show_ros?addRos():rosDone.resolve()):(dlog.log("no header"),projDone.resolve(),rankDone.resolve(),rosDone.resolve(),totalsDone.resolve())}function addAllData(){-1<header_index||"fleaflicker"===siteType&&hasProjectionTable?(addPlayerData(),show_avg||show_med||show_spark||show_current?addAvg():activityDone.resolve(),show_depth?addDepth():depthDone.resolve()):(dlog.log("no header"),projDone.resolve(),rankDone.resolve(),rosDone.resolve(),activityDone.resolve(),depthDone.resolve(),totalsDone.resolve())}function isCurrentWeek(){if("espn"===siteType)return!0;if("fleaflicker"===siteType)return is_current_week;if("yahoo"===siteType){if(page_menu){var e;if(onMatchupPreviewPage){var t=page_menu.contents().filter(function(){return 3===this.nodeType}).text(),a=t.indexOf(":");e=t.substr(0,a).split(" ").reverse()[0]}else e=page_menu.find("#selectlist_nav span").text().replace(/\D/g,"");return!isNaN(e)&&e===current_week}return!0}return!1}jQuery.fn.nearest=function(e){var t,a=jQuery(this[0]),s=a.index(),n=a.parent().find(e),r=!1;return n.each(function(){var e=jQuery(this),a=e.index(),n=Math.abs(s-a);(!r||n<r)&&(r=n,t=e)}),t};function popCell(e,t,a){if("depth"===a)return insertDepth(e,t);if("rank"===a||"ros"===a){var s=t[0],n=t[1];return e.text(s),("espn"===siteType||"fleaflicker"===siteType)&&("--"===s?e.next().text(n):e.next().html("<span style=\"font-size: 80%;\">\xB1</span>"+n)),null}return e.text(t)}function addProjections(){var e;if(e="yahoo"===siteType&&onFreeAgencyPage?is_FA_current:isCurrentWeek(),e){var t=player_table_body.find(".FantasyPlusProjectionsData");"fleaflicker"===siteType&&(total_player_ids=t.length),t.each(function(){var e=jQuery(this),t=e.parent(),a=t.find("td:contains(\"** BYE **\")"),s=0<a.length;"espn"===siteType&&onMatchupPreviewPage&&a.html("<span style=\"color:#999999\">BYE</span>"),s?popCell(e,"--"):getProjectionData("proj",t,e)}),dlog.log("proj done"),projDone.resolve(),hasProjTotals?addProjTotals():(dlog.log("totals done"),totalsDone.resolve())}else dlog.log("not current week"),player_table_body.find(".FantasyPlusProjectionsData").each(function(){var e=jQuery(this),t="-";"fleaflicker"===siteType&&(t="\u2014"),e.text(t)}),dlog.log("proj done"),projDone.resolve(),dlog.log("totals done"),totalsDone.resolve()}function addProjTotals(){var e,a=Math.round;if("espn"===siteType){var t,s;if(!(show_proj||show_current))dlog.log("totals done"),totalsDone.resolve();else if(onClubhousePage){var n=jQuery.Deferred(),r=jQuery.Deferred();jQuery.when(n,r).done(function(){dlog.log("totals done"),totalsDone.resolve()});var l=function(l){var d="proj"===l,o="curr"===l;if(d||o){var i,p=player_table_header.filter(function(){return"STARTERS"===jQuery(this).prev().find("th.playertableSectionHeaderFirst").text()});d?(i=".FantasyPlusProjections",e=t=0):o&&(i=".FantasyPlusCurrent",s=0);for(var f=!0;f;)if(p=p.next(),p.hasClass("pncPlayerRow")&&!p.hasClass("emptyRow")&&!p.hasClass("FantasyPlusTotals")){var c=p.find(i+"Data");if(d){var u=parseFloat(c.text()),y=parseFloat(c.prev().text());y&&(e+=y),u&&(t+=u)}else if(o){var h=parseFloat(c.text());h&&(s+=h)}}else f=!1;var g=playerTable.find(i+"Total");if(d){var _=a(100*parseFloat(t))/100;0==_&&(_="--"),g.html(_);var m=a(100*parseFloat(e))/100;0==m&&(m="--"),g.prev().html(m),n.resolve()}else if(o){var P=a(100*parseFloat(s))/100;0==P&&(P="--"),g.html(P),r.resolve()}}};show_proj?l("proj"):n.resolve(),show_current?jQuery.when(activityDone).done(function(){l("curr")}):r.resolve()}else if(onMatchupPreviewPage)if(!show_proj)dlog.log("totals done"),totalsDone.resolve();else{var d=jQuery(".playerTableTable");d.each(function(){var e=jQuery(this),t=e.find(".FantasyPlusProjectionsData");if(0<t.length){var s=0;t.each(function(){var e=parseFloat(jQuery(this).text());e&&(s+=e)});var n=a(s);e.next().prepend("<div title=\"Total projected points (via FantasyPlus)\" class=\"danglerBox totalScore\">"+n+"</div>")}}),dlog.log("totals done"),totalsDone.resolve()}}else if("yahoo"===siteType){if(!show_proj)dlog.log("totals done"),totalsDone.resolve();else{var o=0;if(onClubhousePage){var p=player_table_body.find("tr:not(\".bench\") .FantasyPlusProjectionsData");if(0<p.length){p.each(function(){var e=parseFloat(jQuery(this).text());e&&(o+=e)});var i=a(100*o)/100,f=parseFloat(pts_total.first().text());if(!isNaN(f)){var c;f<i?c="green":f>i&&(c="red"),c&&(c=" style=\"color: "+c+"\""),pts_total.append("<span title=\"Total projected points (via FantasyPlus)\" class=\"FantasyPlus\""+c+"> ["+i+"]</span>")}}dlog.log("totals done"),totalsDone.resolve()}else onMatchupPreviewPage&&jQuery.when(yahooIdsDone).done(function(){var e=pts_total.parent().clone();e.addClass("FantasyPlus"),e.children().text(""),e.find("th").text("FP Proj");var t=e.find("td"),s=jQuery(playerTable.first()),n=jQuery(".FantasyPlusProjectionsTotal"),r=s.find(player_table_header_selector),l=r.find("th.FantasyPlusProjectionsHeader");l.each(function(e){o=0;var r=jQuery(this),l=r.index(),d=s.find("tbody tr"),i=jQuery(t[e]);if(p=d.find("td:nth-child("+(l+1)+")"),0<p.length){p.each(function(){var e=parseFloat(jQuery(this).text());e&&(o+=e)});var f=a(100*o)/100,c=parseFloat(jQuery(pts_total[e]).text());if(!isNaN(c)){var u;c<f?(u="green",i.addClass("F-positive")):c>f&&(u="red",i.addClass("F-negative")),u&&(u=" style=\"color: "+u+"\"");var y=jQuery(n[e]);y.html("<div title=\"Total projected points (via FantasyPlus)\" class=\"FantasyPlus\""+u+"> ["+f+"]</div>"),i.text(f)}else i.text("-")}else i.text("-")}),pts_total.parent().after(e),dlog.log("totals done"),totalsDone.resolve()})}}else if(!("fleaflicker"===siteType))dlog.log("totals done"),totalsDone.resolve();else if(onClubhousePage){var u,y;e=u=y=0;var h=player_table_body.find("tr td.FantasyPlusProjectionsTotal"),g=getIdxSpan(h),_=player_table_body.find("tr td.FantasyPlusFleaTotal"),m=getIdxSpan(_),P=player_table_body.find("tr td.FantasyPlusActualTotal"),F=getIdxSpan(P),v=player_table_rows.first().nextUntil(".divider").addBack();if(v.each(function(){var t=jQuery(this),a=0;if(show_proj){var s=t.find("td").eq(g);a=parseFloat(s.text()),a&&(e+=a)}var n=t.find("td").eq(m),r=parseFloat(n.text());r&&(u+=r);var l=t.find("td").eq(F),d=parseFloat(l.text());d&&(y+=d)}),show_proj){var w=a(10*e)/10;h.html(w)}var x=a(10*u)/10;_.html(x);var k=a(10*y)/10;P.html(k),dlog.log("totals done"),totalsDone.resolve()}else onMatchupPreviewPage&&(show_proj||fetchFleaflickerIds.resolve(),jQuery.when(fetchFleaflickerIds).done(function(){var e=base_table.find("table tr.scoreboard").closest("table"),t=playerTable.not(e);t.each(function(s){var t=jQuery(this),n=t.find("tbody"),r=0,l=0,d=n.find("tr td.FantasyPlusProjectionsTotal"),o=getIdxSpan(d),i=n.find("tr td.FantasyPlusFleaTotal"),p=getIdxSpan(i),f=n.find(player_table_row_selector).first().nextUntil(".divider").addBack();if(f.each(function(){var e=jQuery(this),t=0;if(show_proj){var a=e.find("td").eq(o);t=parseFloat(a.text()),t&&(r+=t)}var s=e.find("td").eq(p),n=parseFloat(s.text());n&&(l+=n)}),show_proj){var c=a(10*r)/10;d.html(c)}var u=a(10*l)/10;if(i.html(u),show_proj){var y=e.find(".FantasyPlusProjectionsTotal").eq(s);if(y.length){var h=a(100*r)/100;y.html(h)}}}),dlog.log("totals done"),totalsDone.resolve()}))}function addRankings(){var e;e="yahoo"===siteType&&onFreeAgencyPage?is_FA_current:isCurrentWeek(),player_table_body.find(".FantasyPlusRankingsData").each(function(){var t=jQuery(this);if(e){var a=t.parent(),s=a.find("td:contains(\"** BYE **\")"),n=0<s.length,r="--";n?(dlog.log("bye week"),t.text(r),"espn"===siteType&&t.next().text(r)):getProjectionData("rank",a,t)}else{var l="-";"fleaflicker"===siteType&&(l="\u2014"),t.text(l)}}),dlog.log("rank done"),rankDone.resolve()}function addRos(){var e;e="yahoo"===siteType&&onFreeAgencyPage?is_FA_current:isCurrentWeek(),player_table_body.find(".FantasyPlusRosData").each(function(){var t=jQuery(this);if(e){var a=t.parent();getProjectionData("ros",a,t)}else{var s="-";"fleaflicker"===siteType&&(s="\u2014"),t.text(s)}}),dlog.log("ros done"),rosDone.resolve()}function addAvg(){total_players=player_table_rows.length,player_table_rows.each(function(){var e=jQuery(this);getProjectionData("adjavg",e,"")}),resetLeagueYear()}function addDepth(){isObj(depth_data_current_week)||(dlog.log("Current week depth not set"),depth_fail=!0,depth_data_current_week={});var e=player_table_body.find(".FantasyPlusDepthData");total_players_depth=e.length,e.each(function(){var e=jQuery(this),t=e.parent();getProjectionData("depth",t,e)}),resetLeagueYear()}function insertDepth(e,t){if(t.constructor!==Array||3>t.length)e.text("--");else{var a=t[0],s=t[1],n=t[2],r=a.toUpperCase();s=fixPlayerPosition(a,s,"depth");var l="--";if("D/ST"===s)e.text("--");else if("FA"===n)e.text("--");else{n=Object.keys(team_abbrevs).filter(function(e){return team_abbrevs[e]===n})[0];var d={};depth_data_current_week.hasOwnProperty(n)&&(d=depth_data_current_week[n]);var o,i,f={};if(s.constructor===Array)for(var c=0;c<s.length;c++){var u=s[c],y={};if(d.hasOwnProperty(u))if(y=d[u],y.hasOwnProperty(r)){f=y,s=u,o=f[r],l=s+o.num;break}else if(i=fixPlayerName(a,u,n,"depth",y),i){a=i[0],s=i[1],r=a.toUpperCase(),f=y,o=f[r],o.true_name=a,l=s+o.num;break}}else if(d.hasOwnProperty(s))if(f=d[s],f.hasOwnProperty(r))o=f[r],l=s+o.num;else if(i=fixPlayerName(a,s,n,"depth",f),i)a=i[0],s=i[1],r=a.toUpperCase(),o=f[r],o.true_name=a,l=s+o.num;else if("RB"===s){var h={};d.hasOwnProperty("FB")&&(h=d.FB,h.hasOwnProperty(r)?(s="FB",f=h,o=f[r],l=s+o.num):(i=fixPlayerName(a,"FB",n,"depth",h),i&&(a=i[0],s=i[1],r=a.toUpperCase(),f=h,o=f[r],o.true_name=a,l=s+o.num)))}"--"===l&&dlog.log("Could not get depth for player: "+t[0]),e.text(l);var g=Object.keys(f).sort(function(e,t){return f[e].num-f[t].num});if(g.length){for(var _="",m=0;m<g.length;m++){var P=g[m],F=f[P],v=depth_type_map[F.type],w=F.num,x=F.status,k=x.join("|"),b=F.name,D=b;F.hasOwnProperty("true_name")&&(D=F.true_name);var T="<tr>";D.toUpperCase()===a.toUpperCase()&&(T="<tr style=\"background-color: lightblue\">"),_+=T+"<td style=\"width: 40px;\">"+s+w+":</td><td style=\"width: 140px;\">"+b+"</td><td style=\"width: 90px;\">"+v+"</td><td style=\"width: 80px;\">"+k+"</td></tr>"}var R=jQuery("<div><table><tbody></tbody></table></div>");R.find("tbody").append(_),e.css({cursor:"pointer"}),e.tooltipster({content:R,contentCloning:!1,delay:100,debug:!0,interactive:!0,theme:"tooltipster-light",side:"right"})}else dlog.log("No team data for pos: "+s),dlog.log(d)}}total_players_depth--,0===total_players_depth&&(dlog.log("depth done"),depthDone.resolve())}function refreshData(e){if(dlog.log("rerunning"),observer_disconned=!0,observer&&observer.disconnect(),jQuery(".FantasyPlus").remove(),setSelectors(!1),reDefer(),addColumns(),!0===e){updated_times={},updated_types={},updated_depth=0,isObj(activity_data)||(activity_data={}),activity_data.hasOwnProperty(current_season)||(activity_data[current_season]={});var t=activity_data[current_season];t[siteType]={},activity_data_current_season_site=t[siteType],("yahoo"===siteType&&(onMatchupPreviewPage||onFreeAgencyPage)||"fleaflicker"===siteType&&onMatchupPreviewPage)&&(storage_translation_data={},"yahoo"===siteType&&(updated_translation=0,getYahooIds())),dlog.log("Refreshing data, Current Time: "+current_time),jQuery.get(league_settings_url,function(e){e=cleanHTML(e);var t=parseLeagueSettings(e,siteType),a={};a[storageLeagueKey]=t,a[storageLeagueUpdateKey]=updated_league,chrome.storage.local.set(a,function(){doLeagueThings()})})}else addAllData()}function watchForChanges(){if(hasPlayerTable){dlog.log("init watch");var e={childList:!0,characterData:!0,subtree:!0},t=base_table_selector;"fleaflicker"===siteType&&(t="div#body",onFreeAgencyPage&&(e.characterData=!1,e.subtree=!1));var a=document.querySelector(t);if(null===a)return void dlog.log("Not attaching observer");observer=new MutationObserver(function(s){var n=!0;if(observer_disconned=!1,0<s.length){if("yahoo"===siteType){var r=s[0],l=r.target;if(l){var d=l.id,o=l.className;("selectlist_nav"===d||"flyout-title"===o)&&(n=!1)}}else if("fleaflicker"===siteType)if(n=!1,onMatchupPreviewPage)n=!0;else for(var i=0;i<s.length;i++){var p=s[i],f=p.addedNodes;if(f&&f.length)for(var c=0;c<f.length;c++){var u=f[c],y=u.parentElement;y&&"div"===y.localName&&"body"===y.id&&(dlog.log("accepted"),n=!0)}}n?refreshData():dlog.log("rejected")}observer_disconned&&(dlog.log("disconned, reattaching"),jQuery.when(projDone,rankDone,rosDone,activityDone,depthDone,totalsDone).done(function(){dlog.log("all done"),dlog.log("watching for changes after finishing"),a=document.querySelector(t),observer.observe(a,e)}))}),dlog.log("watching for changes"),observer.observe(a,e)}}chrome.runtime.onMessage.addListener(function(e,t,a){var s=e.request;"refresh_data"===s&&(refreshData(!0),a("ok"))});