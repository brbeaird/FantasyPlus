"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var a=[],s=!0,r=!1,n=void 0;try{for(var o,l=e[Symbol.iterator]();!(s=(o=l.next()).done)&&(a.push(o.value),!t||a.length!==t);s=!0);}catch(e){r=!0,n=e}finally{try{!s&&l.return&&l.return()}finally{if(r)throw n}}return a}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};chrome.runtime.sendMessage({request:"valid_site"});var debug_mode=0;function dlog(e,t){t=void 0===t?0:t}function isObj(e){return jQuery.isPlainObject(e)&&!jQuery.isEmptyObject(e)}function goodVal(e,t,a){return e.hasOwnProperty(t)&&jQuery.type(e[t])===a}jQuery.noConflict();var domParse=new DOMParser;function cleanHTML(e){var t=domParse.parseFromString(e,"text/html");return t.querySelectorAll("head, img, svg, link, style").forEach(function(e){e.remove()}),t.documentElement.innerHTML}var storageUserSettingsKey="fp_user_settings";function clearStoredData(){chrome.storage.local.get(null,function(e){jQuery.each(e,function(e,t){e!==storageUserSettingsKey&&chrome.storage.local.remove(e)})})}var alldata,league_settings,custom_cols,observer,observer_disconned,league_id,league_settings_url,storage_translation_data,activity_data,activity_data_current_season_site,siteType,onMatchupPreviewPage,onClubhousePage,onFreeAgencyPage,onGeneralProjPage,storageLeagueKey,storageLeagueUpdateKey,storagePlayerKey,storageUpdateKey,storageUpdateTypeKey,storageTranslationKey,storageTranslationUpdateKey,playerTable,player_table_selector,player_table_body,player_table_body_selector,player_table_header,player_table_header_selector,player_table_rows,player_table_row_selector,proj_head,player_table_header_proj_selector,header_index,player_name_selector,base_table_selector,base_table,page_menu_selector,page_menu,pts_total_selector,pts_total,ld_selector,hasProjTotals,hasPlayerTable,hasProjectionTable,depth_data,depth_data_current_week,res_num=2;chrome.storage.local.get("fp_data_reset",function(e){(!e||!isObj(e)||e<res_num)&&(clearStoredData(),chrome.storage.local.set({fp_data_reset:res_num}))});var seasonstart,fetch_fail=!1,idp_fetch_fail=!1,depth_fail=!1,total_players=0,total_players_depth=0,user_settings={},updated_times={},updated_types={},updated_league=0,updated_depth=0,ajax_timeout=5e3,show_proj=!0,show_rank=!0,show_ros=!0,show_depth=!0,show_spark=!0,show_avg=!0,show_med=!0,show_current=!0,check_minutes=30,check_minutes_avg=1440,check_minutes_avg_done=20,check_minutes_avg_live=1,check_minutes_depth=120,experts={proj:{selection:["all"]},rank:{selection:["all"],num:{top:10,updated:1}},ros:{selection:["all"],num:{top:5,updated:7}}},remove_ads=!0,fix_css=!0,season_start_map={2014:[8,2],2015:[8,8],2016:[8,6],2017:[8,5],2018:[8,4]},expected_player={QB:{pass_yds:254.3,pass_tds:1.6,pass_ints:.83,pass_att:35.25,pass_cmp:22.18,rush_yds:13.82,rush_tds:.12,rush_att:3.35,fumbles:.18},RB:{rush_yds:45.53,rush_tds:.28,rush_att:10.95,rec_yds:16.07,rec_att:1.97,rec_tds:.07,fumbles:.07},WR:{rec_yds:49.83,rec_att:3.78,rec_tds:.31,fumbles:.03},TE:{rec_yds:31.61,rec_att:2.87,rec_tds:.26,fumbles:.02},"D/ST":{def_sack:2.33,def_ff:.86,def_int:.86,def_td:.21,def_fr:.6,def_pa:22.82,def_tyda:352.67,def_safety:.02},K:{xpt:2.16,fg:1.65,fga:1.95},LB:{Scks:.26,FumFrc:.08,Tack:4.11,Asst:1.78,PassDef:.22,Int:.04,DefTD:.01,Fum:.04},DL:{Scks:.32,FumFrc:.06,Tack:2.14,Asst:.95,PassDef:.1,Int:.01,DefTD:0,Fum:.03},DB:{Scks:.03,FumFrc:.05,Tack:3.84,Asst:.92,PassDef:.58,Int:.12,DefTD:.02,Fum:.03}},current_date=new Date,current_time=current_date.getTime(),current_month=current_date.getMonth(),current_year=current_date.getFullYear(),current_season=current_year,current_season_avg=current_year,current_season_avg_week=current_year;(current_month<5||!season_start_map[current_year]&&season_start_map[current_year-1])&&(current_season-=1);try{seasonstart=new Date(current_season,season_start_map[current_season][0],season_start_map[current_season][1],4)}catch(e){throw"FantasyPlus: Season "+current_season+" does not exist in records"}var seasonstart_avg=seasonstart,seasonstart_avg_week=seasonstart,oneweekbefore=new Date(seasonstart.getTime());oneweekbefore.setDate(oneweekbefore.getDate()-7),current_date<oneweekbefore&&(current_season_avg-=1,seasonstart_avg=new Date(current_season_avg,season_start_map[current_season_avg][0],season_start_map[current_season_avg][1],4)),current_date<seasonstart&&(current_season_avg_week-=1,seasonstart_avg_week=new Date(current_season_avg_week,season_start_map[current_season_avg_week][0],season_start_map[current_season_avg_week][1],4));var current_week=Math.max(Math.ceil((current_date-seasonstart)/864e5/7),1),current_week_avg=Math.max(Math.ceil((current_date-seasonstart_avg_week)/864e5/7),1),team_abbrevs={"Seattle Seahawks":"SEA","Carolina Panthers":"CAR","Arizona Cardinals":"ARI","Denver Broncos":"DEN","Los Angeles Rams":"LAR","Houston Texans":"HOU","Kansas City Chiefs":"KC","Cincinnati Bengals":"CIN","New England Patriots":"NE","Minnesota Vikings":"MIN","New York Jets":"NYJ","Philadelphia Eagles":"PHI","Green Bay Packers":"GB","Buffalo Bills":"BUF","Pittsburgh Steelers":"PIT","Baltimore Ravens":"BAL","Oakland Raiders":"OAK","Jacksonville Jaguars":"JAC","Miami Dolphins":"MIA","Detroit Lions":"DET","Tennessee Titans":"TEN","Cleveland Browns":"CLE","San Francisco 49ers":"SF","New York Giants":"NYG","Chicago Bears":"CHI","Tampa Bay Buccaneers":"TB","Washington Redskins":"WAS","Atlanta Falcons":"ATL","Los Angeles Chargers":"LAC","Indianapolis Colts":"IND","New Orleans Saints":"NO","Dallas Cowboys":"DAL"},player_name_fix={"Stevie Johnson":"Steve Johnson","Ha Ha Clinton-Dix":"Hasean Clinton-Dix","Corey Brown":"Philly Brown","Boobie Dixon":"Anthony Dixon","Wil Lutz":"Will Lutz","MarQuies Gray":"MarQueis Gray","Jerry Attaochu":"Jeremiah Attaochu","Kahlil Mack":"Khalil Mack","Justin March-Lillard":"Justin March","Odell Beckham":"Odell Beckham Jr.","A.J. McCarron":"AJ McCarron","A.J. Derby":"AJ Derby","E.J. Manuel":"EJ Manuel","Jurell Casey":"Jurrell Casey","Johnathan Hankins":"Jonathan Hankins","Malcolm Brown":"Malcom Brown","Dante Fowler":"Dante Fowler Jr.","Vic Beasley Jr.":"Vic Beasley","Nickell Robey":"Nickell Robey-Coleman","Terrod Ward":"Terron Ward","Steven Hauschka":"Stephen Hauschka","Stephen Hauschka":"Steven Hauschka","Adoree' Jackson":"Adoree Jackson","Daniel Sorensen":"Daniel Sorenson"},player_name_translations={Christopher:"Chris",Chris:"Christopher",Benjamin:"Benny",Benny:"Benjamin",Tim:"Timothy",Timothy:"Tim",Rob:"Robert",Robert:"Rob",Mike:"Michael",Michael:"Mike",Mitchell:"Mitch",Mitch:"Mitchell",John:"Johnathan",Johnathan:"John",Jon:"Jonathan",Jonathan:"Jon",Matt:"Matthew",Matthew:"Matt",Zach:"Zachary",Zachary:"Zach"},player_position_fix={"Ty Montgomery":"RB","Jadeveon Clowney":"LB","Derrick Morgan":"LB","Vic Beasley":"LB","Shea McClellin":"LB","Trent Murphy":"LB","Kevin Dodd":"LB","Lorenzo Alexander":"LB","Ryan Kerrigan":"LB","Preston Smith":"LB","Su'a Cravens":"DB","Jabaal Sheard":"DL","Frank Clark":"DL","Khalil Mack":"LB","Melvin Ingram":"DE"},player_position_fix_depth={"Derrick Morgan":"LB","Vic Beasley":"LB","Shea McClellin":"LB","Trent Murphy":"LB","Kevin Dodd":"LB","Su'a Cravens":"LB","Bruce Irvin":"LB","Ryan Kerrigan":"LB","Preston Smith":"LB","Tyrann Mathieu":"S","Lamarcus Joyner":"S","Jadeveon Clowney":"DE","Jabaal Sheard":"DE","Frank Clark":"DE","Emmanuel Ogbah":"DE","Dwight Freeney":"DE","Timmy Jernigan":"DE","Jaye Howard":"DE","Chris Baker":"DE","Kendall Langford":"DE","Adolphus Washington":"DE","Robert Nkemdiche":"DE","DaQuan Jones":"DE","Yannick Ngakoue":"DE","Melvin Ingram":"DE","Cameron Heyward":"DE","Aaron Donald":"DE","Akiem Hicks":"DE"},player_position_fix_sharks={"Su'a Cravens":"DB","Khalil Mack":"LB","Bruce Irvin":"DL"},team_abbrev_fix_fleaflicker={LA:"LAR"},off_positions_proj=["qb","rb","wr","te","k","dst"],def_positions_proj=["8","9","10"],all_positions_proj=off_positions_proj.concat(def_positions_proj),all_positions_rank=["qb","rb","wr","te","k","dst","dl","lb","db"],idp_positions=["DL","LB","DB"],idp_conversion={8:"DL",9:"LB",10:"DB"},team_name_conversion={ARZ:"ARI",GBP:"GB",KCC:"KC",NEP:"NE",NOR:"NO",RAM:"LA",SDC:"SD",SFO:"SF",TBB:"TB"},fpros_proj_headers={QB:["Player","Team","pass_att","pass_cmp","pass_yds","pass_tds","pass_ints","rush_att","rush_yds","rush_tds","fumbles","fpts"],RB:["Player","Team","rush_att","rush_yds","rush_tds","rec_att","rec_yds","rec_tds","fumbles","fpts"],WR:["Player","Team","rush_att","rush_yds","rush_tds","rec_att","rec_yds","rec_tds","fumbles","fpts"],TE:["Player","Team","rec_att","rec_yds","rec_tds","fumbles","fpts"],K:["Player","Team","fg","fga","xpt","fpts"],DST:["Player","Team","def_sack","def_int","def_fr","def_ff","def_td","def_assist","def_safety","def_pa","def_tyda","fpts"]},fpros_rank_headers=["Rank","WSIS","Player","Team","Matchup","Best Rank","Worst Rank","Avg Rank","Std Dev"],fpros_rank_idp_headers=["Rank","WSIS","Player","Team","Pos","Matchup","Best Rank","Worst Rank","Avg Rank","Std Dev"],fpros_ros_headers=["Rank","WSIS","Player","Team","Bye","Best Rank","Worst Rank","Avg Rank","Std Dev","ADP","vs. ADP"],fpros_ros_idp_headers=["Rank","WSIS","Player","Team","Pos","Bye","Best Rank","Worst Rank","Avg Rank","Std Dev"],depth_type_map={blue:"Starter",green:"Situational",red:"Fill-in",brown:"Fill-in",black:"Reserve"},depth_url="//subscribers.footballguys.com/apps/depthchart.php?type=all&lite=no&exclude_coaches=yes",loadingDiv='<div class="fp-spinner-cell"><div class="fp-spinner-container"><div class="fp-spinner fp-spinner-1"></div><div class="fp-spinner fp-spinner-2"></div><div class="fp-spinner fp-spinner-3"></div></div></div>',projDone=jQuery.Deferred(),rankDone=jQuery.Deferred(),rosDone=jQuery.Deferred(),activityDone=jQuery.Deferred(),depthDone=jQuery.Deferred(),totalsDone=jQuery.Deferred(),storageActivityKey="fp_player_activity_data",storageDepthKey="fp_depth_data",storageDepthUpdateKey="fp_last_updated_depth",storageKeys=[storageActivityKey,storageDepthKey,storageDepthUpdateKey],baseUrlESPN="games.espn.com",baseUrlYahoo="football.fantasysports.yahoo.com",baseUrlFleaflicker="fleaflicker.com";if(document.URL.match(new RegExp(baseUrlESPN))){siteType="espn",onMatchupPreviewPage=document.URL.match(/ffl\/matchuppreview/),onClubhousePage=document.URL.match(/ffl\/(clubhouse|dropplayers|rosterfix)/),onFreeAgencyPage=document.URL.match(/ffl\/(freeagency|watchlist)/),onGeneralProjPage=document.URL.match(/ffl\/tradereview/);var onLeaguePage=document.URL.match(/ffl\/leagueoffice/),onLeagueSettingsPage=document.URL.match(/ffl\/leaguesetup\/settings/);hasProjTotals=onMatchupPreviewPage||onClubhousePage,hasPlayerTable=onClubhousePage||onFreeAgencyPage||onGeneralProjPage,hasProjectionTable=!1,base_table_selector=".playerTableContainerDiv",player_table_selector="[id^=playertable_]",player_table_body_selector="tbody",player_table_header_selector="tr.playerTableBgRowSubhead",player_table_row_selector="tr.pncPlayerRow:not(.emptyRow)",player_table_header_proj_selector="td:contains(PROJ), td:contains(ESPN)",player_name_selector="td.playertablePlayerName",ld_selector="div.games-fullcol";var player_cell_pos_selector='td[id^="pncSlot_"]';onLeagueSettingsPage&&addLeagueSettings(),league_id=document.URL.match(/leagueId=(\d+)/)[1],league_settings_url="//games.espn.com/ffl/leaguesetup/sections/scoring?leagueId="+league_id,storageLeagueKey="fp_espn_league_data_"+league_id,storageLeagueUpdateKey="fp_espn_last_updated_league_"+league_id,storagePlayerKey="fp_espn_player_data_"+league_id,storageUpdateKey="fp_espn_last_updated_"+league_id,storageUpdateTypeKey="fp_espn_last_updated_type_"+league_id,storageKeys.push(storageLeagueKey,storageLeagueUpdateKey,storagePlayerKey,storageUpdateKey,storageUpdateTypeKey),getUserSettings()}else if(document.URL.match(new RegExp(baseUrlYahoo))){siteType="yahoo";var yahooIdsDone=jQuery.Deferred(),updated_translation=0,is_FA_current=!1;onMatchupPreviewPage=document.URL.match(/f1\/\d+\/matchup/),onClubhousePage=document.URL.match(/f1\/\d+\/\d+/),onFreeAgencyPage=document.URL.match(/f1\/\d+\/players/),hasPlayerTable=onClubhousePage||onFreeAgencyPage,hasProjectionTable=(hasProjTotals=onMatchupPreviewPage||onClubhousePage)||onFreeAgencyPage,base_table_selector="#team-roster",player_table_selector="table[id^=statTable]",player_table_body_selector="tbody",player_table_header_selector="thead tr",player_table_row_selector="tr:not(.empty-bench, empty-position)",player_name_selector="td.player",page_menu_selector="header div#full_stat_nav",pts_total_selector="span.proj-pts-week",onMatchupPreviewPage?(base_table_selector="#yspmaincontent",page_menu_selector="header span",pts_total_selector="section#matchup-header table tr:nth(1) td"):onFreeAgencyPage&&(base_table_selector="#players-table-wrapper",player_table_selector="table",pts_total_selector=page_menu_selector=""),league_id=document.URL.match(/football.fantasysports.yahoo.com\/f1\/(\d+)/)[1],league_settings_url="//football.fantasysports.yahoo.com/f1/"+league_id+"/settings",storageLeagueKey="fp_yahoo_league_data_"+league_id,storageLeagueUpdateKey="fp_yahoo_last_updated_league_"+league_id,storagePlayerKey="fp_yahoo_player_data_"+league_id,storageUpdateKey="fp_yahoo_last_updated_"+league_id,storageUpdateTypeKey="fp_yahoo_last_updated_type_"+league_id,storageTranslationKey="fp_yahoo_translation",storageTranslationUpdateKey="fp_yahoo_translation_updated",storageKeys.push(storageLeagueKey,storageLeagueUpdateKey,storagePlayerKey,storageUpdateKey,storageUpdateTypeKey,storageTranslationKey,storageTranslationUpdateKey),show_depth=show_ros=show_spark=show_current=show_med=show_avg=!1,getUserSettings()}else if(document.URL.match(new RegExp(baseUrlFleaflicker))){siteType="fleaflicker";var fetchFleaflickerIds=jQuery.Deferred(),total_player_ids=0,is_current_week=!0;onMatchupPreviewPage=document.URL.match(/nfl\/leagues\/(\d+)\/scores\/(\d+)/),onClubhousePage=document.URL.match(/nfl\/leagues\/(\d+)\/teams\/(\d+)(\?|$)/),onFreeAgencyPage=document.URL.match(/nfl\/leagues\/(\d+)\/players($|[^/])/),onGeneralProjPage=document.URL.match(/nfl\/leagues\/(\d+)\/teams\/(\d+)\/(watched)/),hasPlayerTable=onFreeAgencyPage||onMatchupPreviewPage,hasProjectionTable=(hasProjTotals=onMatchupPreviewPage||onClubhousePage)||onFreeAgencyPage||onGeneralProjPage,base_table_selector="#body-center-main",player_table_selector="table",player_table_body_selector="tbody",player_table_header_selector="thead tr",player_table_row_selector="tr:not(:has(td.vertical-spacer))",player_name_selector="div.player",league_id=document.URL.match(/nfl\/leagues\/(\d+)/)[1],league_settings_url="//www.fleaflicker.com/nfl/leagues/"+league_id+"/scoring",storageLeagueKey="fp_fleaflicker_league_data_"+league_id,storageLeagueUpdateKey="fp_fleaflicker_last_updated_league_"+league_id,storagePlayerKey="fp_fleaflicker_player_data_"+league_id,storageUpdateKey="fp_fleaflicker_last_updated_"+league_id,storageUpdateTypeKey="fp_fleaflicker_last_updated_type_"+league_id,storageTranslationKey="fp_fleaflicker_translation",storageKeys.push(storageLeagueKey,storageLeagueUpdateKey,storagePlayerKey,storageUpdateKey,storageUpdateTypeKey,storageTranslationKey),show_current=show_med=show_avg=!1,getUserSettings()}function fixPage(){if("espn"===siteType){if(remove_ads&&(jQuery(".games-footercol, .transitional-elements").remove(),jQuery(".games-innercol2").children("br").remove(),onClubhousePage?jQuery('iframe[src*="streak.espn.com"]').parent().remove():onLeaguePage&&jQuery('.games-rightcol-spacer, a[href*="pizzahut"], div.promotional-info, div.header-ad, div[class^="games-ad"]').remove()),fix_css)if(jQuery(".gamesmain.container").css("margin-bottom","10px"),onClubhousePage){jQuery(".games-bottomcol").css("margin",0);var e=jQuery(".games-dates-mod");"19px"===e.css("margin-top")&&e.css("margin-top","20px")}else onFreeAgencyPage&&jQuery("#backgroundContainer").css("width","auto")}else if("yahoo"===siteType)remove_ads&&(jQuery(".df-ad").remove(),jQuery("#fantasyhero").remove(),jQuery("#gamepromo").remove(),jQuery("#survival-oneclick-promo").remove(),jQuery("#fantasytrophypromo, #fantasyshoppromo").remove(),jQuery(".Ad").parent().remove());else if("fleaflicker"===siteType&&(remove_ads&&(jQuery('a[href^="/nfl/upgrade"]').remove(),jQuery("i.icon-edge-E").remove(),jQuery(".alert-banner-edge").remove()),fix_css&&(onFreeAgencyPage||onGeneralProjPage))){var t=jQuery("a"),a=t.filter(function(){return"Trade"===jQuery(this).text()});a.css({"background-image":"linear-gradient(to bottom,#a070ec 0%,#6c4186 100%)","border-color":"#51427d"}),a.hover(function(){jQuery(this).css("background-color","rgb(108, 65, 134)")});var s=t.filter(function(){return"Claim"===jQuery(this).text()});s.css({"background-image":"linear-gradient(to bottom,#fbbc4a 0%,#d68306 100%)","border-color":"#9c6315"}),s.hover(function(){jQuery(this).css("background-color","#d68306")})}}function getParams(e){var r={},t=e.indexOf("?");return-1<t&&e.substr(t+1).split("&").forEach(function(e){var t=e.split("="),a=t[0],s=t[1]&&decodeURIComponent(t[1]);a in r?r[a].push(s):r[a]=[s]}),r}function addLeagueSettings(){var e=jQuery(ld_selector),t=jQuery("#settings-content",e),B={Passing:{"TD Pass (PTD)":4,"2pt Passing Conversion (2PC)":2,"Interceptions Thrown (INT)":-2},Rushing:{"TD Rush (RTD)":6,"2pt Rushing Conversion (2PR)":2},Receiving:{"TD Reception (RETD)":6,"2pt Receiving Conversion (2PRE)":2},Miscellaneous:{"Kickoff Return TD (KRTD)":6,"Punt Return TD (PRTD)":6,"Fumble Recovered for TD (FTD)":6,"Total Fumbles Lost (FUML)":-2,"Interception Return TD (INTTD)":6,"Fumble Return TD (FRTD)":6,"Blocked Punt or FG return for TD (BLKKRTD)":6,"2pt Return (2PTRET)":2,"1pt Safety (1PSF)":1},Kicking:{"Each PAT Made (PAT)":1,"Total FG Missed (FGM)":-1,"FG Made (0-39 yards) (FG0)":3,"FG Made (40-49 yards) (FG40)":4,"FG Made (50+ yards) (FG50)":5},"Team Defense / Special Teams":{"Each Sack (SK)":1,"Interception Return TD (INTTD)":6,"Fumble Return TD (FRTD)":6,"Kickoff Return TD (KRTD)":6,"Punt Return TD (PRTD)":6,"Blocked Punt or FG return for TD (BLKKRTD)":6,"Blocked Punt, PAT or FG (BLKK)":2,"Each Interception (INT)":2,"Each Fumble Recovered (FR)":2,"Each Safety (SF)":2,"0 points allowed (PA0)":5,"1-6 points allowed (PA1)":4,"7-13 points allowed (PA7)":3,"14-17 points allowed (PA14)":1,"28-34 points allowed (PA28)":-1,"35-45 points allowed (PA35)":-3,"46+ points allowed (PA46)":-5,"Less than 100 total yards allowed (YA100)":5,"100-199 total yards allowed (YA199)":3,"200-299 total yards allowed (YA299)":2,"350-399 total yards allowed (YA399)":-1,"400-449 total yards allowed (YA449)":-3,"450-499 total yards allowed (YA499)":-5,"500-549 total yards allowed (YA549)":-6,"550+ total yards allowed (YA550)":-7,"2pt Return (2PTRET)":2,"1pt Safety (1PSF)":1}},E={Passing:{"Every 25 passing yards  (PY25)":1},Rushing:{"Every 10 rushing yards (RY10)":1},Receiving:{"Every 10 receiving yards (REY10)":1}},L={Passing:{"Passing Yards (PY)":.04},Rushing:{"Rushing Yards (RY)":.1},Receiving:{"Receiving Yards (REY)":.1}},Y=jQuery.extend(!0,{},B,E,L),m={"Quarterback (QB)":{num:1,max:4},"Running Back (RB)":{num:2,max:8},"Wide Receiver (WR)":{num:2,max:8},"Tight End (TE)":{num:1,max:3},"Flex (RB/WR/TE)":{num:1,max:null},"Team Defense/Special Teams (D/ST)":{num:1,max:3},"Place Kicker (K)":{num:1,max:3},"Bench (BE)":{num:7,max:null}};function I(e){var t=e.text(),a=parseFloat(t);return isNaN(a)&&(a=t),a}function K(e,t,a){e!==t&&(e<t?a.css({"background-color":"pink"}):(t<e||"No Limit"===e)&&a.css({"background-color":"lightgreen"}),"N/A"!==e&&a.attr("title","Default: "+t))}var U=[];function a(e){var t=e.find("tbody").find("tbody"),a=t.find("tr[class^=row]").find("td:first");for(var s in m)if(m.hasOwnProperty(s)){var r=m[s],n=t.find("td:contains('"+s+"')");if(n.length){var o=n.next(),l=o.next(),i=I(o),d=I(l);K(i,r.num,o),K(d,r.max,l),a.splice(a.index(n),1)}else U.push(s)}if(a.each(function(){jQuery(this).parent().css({"background-color":"lightblue"})}),0<U.length){var u=e.find("tbody").first().children("tr").last(),p="Even";-1!==u.attr("class").indexOf("Even")&&(p="Odd");for(var _=u.find("tr:nth(1)").find("td:first").width()||250,c=jQuery('<tr class="row'+p+'"><td class="dataSummary settingLabel">Missing Positions</td><td><table border="0" cellpadding="2" cellspacing="1" class="leagueSettingsTable tableBody"><tbody></tbody></table></td></tr>'),g=c.find("tbody"),f=U.length,y=0;y<f;y++){var h=U[y],v='<tr style="background-color: pink;"><td style="width: '+_+'px">'+h+"</td><td><strong>"+m[h].num+"</strong></td><td><strong>"+m[h].max+"</strong></td></tr>";g.append(v)}c.insertAfter(u)}P.resolve()}function N(e,t){return jQuery(e).parents("td").eq(0).prev().text()===t}var P=jQuery.Deferred(),s=t.find("div[name='roster']"),r=t.find("div[name='scoring']");if(jQuery.when(P).done(function(){var e,s;0<r.length&&function(e){var o=e.find("table.viewable").find("tbody").find("tbody"),l=o.find("td.statName"),i=[],t=function(a){if(B.hasOwnProperty(a)){var e=B[a];for(var t in e)if(e.hasOwnProperty(t)){var s=o.find("td:contains('"+t+"')").filter(function(e,t){return N(t,a)});if(s.length){var r=s.next();K(I(r),e[t],r),l.splice(l.index(s),1)}else{var n={typ:a,val:t};i.push(n)}}}};for(var a in B)t(a);var f=[],d=!1,s=function(a){if(E.hasOwnProperty(a)){var e=E[a];for(var t in e)if(e.hasOwnProperty(t)){var s=o.find("td:contains('"+t+"')").filter(function(e,t){return N(t,a)});if(s.length){d=!0;var r=s.next();K(I(r),e[t],r),l.splice(l.index(s),1)}else{var n={typ:a,val:t};f.push(n)}}}};for(var a in E)s(a);var y=[],u=!1,r=function(a){if(L.hasOwnProperty(a)){var e=L[a];for(var t in e)if(e.hasOwnProperty(t)){var s=o.find("td:contains('"+t+"')").filter(function(e,t){return N(t,a)});if(s.length){u=!0;var r=s.next();K(I(r),e[t],r),l.splice(l.index(s),1)}else{var n={typ:a,val:t};y.push(n)}}}};for(var a in L)r(a);for(var n=0;n<l.length;n++){var p,_=jQuery(l[n]).text(),c=!1;-1<_.search(/ards\s+\(PY\d+/)&&-1===_.indexOf("ards (PY25)")?(p={typ:"Passing",val:"Passing Yards (PY)"},c=!0):-1<_.search(/ards\s+\(RY\d+/)&&-1===_.indexOf("ards (RY10)")?(p={typ:"Rushing",val:"Rushing Yards (PY)"},c=!0):-1<_.search(/ards\s+\(REY\d+/)&&-1===_.indexOf("ards (REY10)")&&(p={typ:"Receiving",val:"Receiving Yards (REY)"},c=!0),c&&(d=!0,y.splice(p,1))}var g=e.find("tr").first().find("td").first();function h(e,t,a,s){var r=1;0<t.length&&(r=parseFloat(t));var n=a*r;return K(e,n,s),e===n}d&&u?(g.append(" (Mixture)"),y.splice(0,y.length),f.splice(0,f.length)):d?(g.append(" (Standard)"),y.splice(0,y.length)):u?(g.append(" (Fractional)"),f.splice(0,f.length)):g.append(" (None)"),l.each(function(){var e=jQuery(this),t=e.next().first(),a=I(t),s=e.text(),r=!1,n=s.search(/ards\s+\(PY/);if(-1!==n){r=!0;var o=L.Passing["Passing Yards (PY)"],l="",i=s.match(/\([A-Z]+(\d+)\)/);i.length&&(l=i[1]),h(a,l,o,t)&&(y.splice(y.indexOf(" (PY"),1),f.splice(f.indexOf(" (PY"),1))}if(-1!==(n=s.indexOf("ards (RY"))){r=!0;var d=L.Rushing["Rushing Yards (RY)"],u="",p=s.match(/\([A-Z]+(\d+)\)/);p.length&&(u=p[1]),h(a,u,d,t)&&(y.splice(y.indexOf(" (RY"),1),f.splice(f.indexOf(" (RY"),1))}if(-1!==(n=s.indexOf("ards (REY"))){r=!0;var _=L.Receiving["Receiving Yards (REY)"],c="",g=s.match(/\([A-Z]+(\d+)\)/);g.length&&(c=g[1]),h(a,c,_,t)&&(y.splice(y.indexOf(" (REY"),1),f.splice(f.indexOf(" (REY"),1))}r||(e.css({"background-color":"lightblue"}),t.css({"background-color":"lightblue"}))});for(var v=i.concat(f).concat(y),m=v.slice(),P=0;P<v.length;P++){var w=v[P],b=w.typ,j=[];if("Team Defense / Special Teams"===b?j=["Team Defense/Special Teams (D/ST)"]:"Passing"===b?j=["Quarterback (QB)","Team Quarterback (TQB)"]:"Kicking"===b&&(j=["Place Kicker (K)"]),0<j.length){for(var D=0,F=0;F<j.length;F++)-1<U.indexOf(j[F])&&(D+=1);D===j.length&&m.splice(m.indexOf(w),1)}}if(0<m.length){var k=e.find("table.viewable").find("tbody").first().children("tr").last(),T="Even";-1!==k.attr("class").indexOf("Even")&&(T="Odd");for(var x=jQuery('<tr class="row'+T+'"><td class="categoryName settingLabel">Missing Entries</td><td><table width="100%" cellspacing="0" cellpadding="0" border="0"><tbody></tbody></table></td></tr>'),R=x.find("tbody"),A=m.length,S=0;S<A;S++){var C=m[S],Q=C.typ,M=C.val,O='<tr><td class="statName" style="background-color: pink;">'+M+" ["+Q+'] </td><td class="statPoints" style="background-color: pink;">'+Y[Q][M]+"</td></tr>";R.append(O)}x.insertAfter(k)}}(r),e=document.querySelector(ld_selector),(s=new MutationObserver(function(e){if(0<e.length){var t=jQuery(ld_selector),a=t.find("input.submitSettings:visible");0===a.length&&(s.disconnect(),addLeagueSettings())}})).observe(e,{childList:!0,characterData:!0,subtree:!0})}),0===s.length)if(0<r.length){var n={xhr:1,edit:"false",leagueId:league_id};jQuery.get("//games.espn.com/ffl/leaguesetup/sections/roster",n,function(e){e=cleanHTML(e),a(s=jQuery(e))})}else P.resolve();else a(s)}function getUserSettings(){chrome.storage.local.get(storageUserSettingsKey,function(e){var t=e[storageUserSettingsKey];dlog("user settings:"),dlog(t),isObj(t)&&(user_settings=jQuery.extend(!0,{},t));var a={};isObj(user_settings.columns)?a=user_settings.columns:user_settings.columns={},show_proj=a.hasOwnProperty("proj")&&show_proj?a.proj:show_proj,show_rank=a.hasOwnProperty("rank")&&show_rank?a.rank:show_rank,show_ros=a.hasOwnProperty("ros")&&show_ros?a.ros:show_ros,show_depth=a.hasOwnProperty("depth")&&show_depth?a.depth:show_depth,show_spark=a.hasOwnProperty("spark")&&show_spark?a.spark:show_spark,show_avg=a.hasOwnProperty("avg")&&show_avg?a.avg:show_avg,show_med=a.hasOwnProperty("med")&&show_med?a.med:show_med,show_current=a.hasOwnProperty("current")&&show_current?a.current:show_current;var s={};isObj(user_settings.update_freq)?s=user_settings.update_freq:user_settings.update_freq={},jQuery.each(s,function(e,t){isObj(t)||(t={});var a=t.time,s=t.typ;if(a&&s){var r=a;"h"===s&&(r*=60),"player"===e&&(check_minutes=Math.max(r,1))}}),isObj(user_settings.experts)?experts=user_settings.experts:user_settings.experts={};var r={};isObj(user_settings.misc)?r=user_settings.misc:user_settings.misc={};var n=r.remove_ads,o=r.fix_css;void 0!==n&&(remove_ads=n),void 0!==o&&(fix_css=o),fixPage(),setSelectors()})}function setSelectors(e){if(base_table=jQuery(base_table_selector),page_menu_selector&&(page_menu=base_table.find(page_menu_selector)),pts_total_selector&&(pts_total=base_table.find(pts_total_selector)),playerTable="espn"===siteType&&onMatchupPreviewPage?jQuery(player_table_selector):base_table.find(player_table_selector),player_table_body=playerTable.find(player_table_body_selector),"espn"===siteType&&(playerTable=player_table_body),player_table_header=playerTable.find(player_table_header_selector),player_table_rows=player_table_body.find(player_table_row_selector),"espn"===siteType)proj_head=player_table_header.find(player_table_header_proj_selector),hasProjectionTable=0<proj_head.length;else if("yahoo"===siteType){if(show_proj=void 0===user_settings.columns.proj||user_settings.columns.proj,show_rank=void 0===user_settings.columns.rank||user_settings.columns.rank,onMatchupPreviewPage)player_table_header_proj_selector="th:contains(Proj)";else if(onFreeAgencyPage){is_FA_current=!1;var t=getParams(window.location.search),a=t.hasOwnProperty("stat1")?t.stat1[0]:"";if(/^S_P/.test(a)){if(player_table_header_proj_selector="th:contains(Fan Pts)",/^S_PW_/.test(a)){var s=parseInt(a.split("_").reverse()[0]);isNaN(s)||s!==current_week||(is_FA_current=!0)}}else show_rank=show_proj=!(player_table_header_proj_selector="th:contains(Nothing to see here)")}else{player_table_header_proj_selector="th:contains(Proj Pts)";var r=page_menu.find("div.navlist:first li.Selected:first a").attr("id");if("P"===r||"GDD"===r){var n="subnav_"+r,o=getParams(page_menu.find("div#statsubnav ul#"+n+" li.Selected:first a").attr("href")),l=o.hasOwnProperty("stat2")?o.stat2[0]:"";"P"===r&&"PW"===l?player_table_header_proj_selector="th:contains(Fan Pts)":"GDD"===r&&"D"===l&&(player_table_header_proj_selector="th:contains(Rank)")}else"K"===r&&(show_proj=!1,player_table_header_proj_selector="th:contains(This Week)")}proj_head=player_table_header.find(player_table_header_proj_selector)}else if("fleaflicker"===siteType){show_proj=void 0===user_settings.columns.proj||user_settings.columns.proj,show_rank=void 0===user_settings.columns.rank||user_settings.columns.rank,show_ros=void 0===user_settings.columns.ros||user_settings.columns.ros,show_spark=void 0===user_settings.columns.spark||user_settings.columns.spark,player_table_header_proj_selector="Proj";var i=getParams(window.location.search),d="statRange";onClubhousePage&&(d="week");var u=i.hasOwnProperty(d)?i[d][0]:"";u&&u!==current_week&&(is_current_week=!1);var p=i.hasOwnProperty("season")?i.season[0]:"";p&&p!==current_season&&(is_current_week=!1);var _=i.hasOwnProperty("statType")?i.statType[0]:"",c=i.hasOwnProperty("sortMode")?i.sortMode[0]:"";onFreeAgencyPage&&(_&&"7"===_?show_spark=!(player_table_header_proj_selector="FPts"):c&&"0"!==c&&(player_table_header_proj_selector="FPts")),is_current_week||(hasProjectionTable=!1),proj_head=player_table_header.find("th").filter(function(){return jQuery(this).text()===player_table_header_proj_selector}),"FPts"===player_table_header_proj_selector&&(proj_head=_&&"7"===_?proj_head.last():proj_head.first())}onMatchupPreviewPage&&(show_current=show_med=show_avg=show_spark=show_depth=show_ros=show_rank=!1);var g=proj_head.first();header_index=g.index(),g.prevAll("th, td").each(function(){header_index+=this.colSpan-1}),!1!==e&&runMain()}function isDataCurrent(e){function t(e){var t=check_minutes,a=0;if("league"===e)a=updated_league;else if("translation"===e)a=updated_translation;else if("depth"===e){if(!show_depth)return!0;t=check_minutes_depth,a=updated_depth}else{if("proj"===e&&!show_proj)return!0;if("rank"===e&&!show_rank)return!0;if("ros"===e&&!show_ros)return!0;if(isObj(updated_times)){a=updated_times[e];var s=e,r=experts[s]||{},n=(r.selection||"none").toString();if("rank"===s||"ros"===s){var o=r.num||{};n+="-"+(o.top||10)+"-"+(o.updated||7)}dlog(n),updated_types[s]!==n&&(dlog("Different update type for: "+s+", stored is: "+updated_types[s]+", want: "+n),a=0)}}var l=!1;return!1===(l=!!parseFloat(a)&&current_time-a<6e4*t)&&dlog(e+" is out of date: "+a),l}if(!e||!Array.isArray(e)&&"string"!=typeof e||e.length<=0)return!1;if(Array.isArray(e)){for(var a=!0,s=0;s<e.length;s++)!1===t(e[s])&&(a=!1);return a}return t(e)}function isActivityDataCurrent(e,t,a,s){var r,n=!0;if("league"===a)"live"===s?(dlog("using live",1),r=check_minutes_avg_live):"done"===s?(dlog("using done",1),r=check_minutes_avg_done):(dlog("using day",1),r=check_minutes_avg),n=current_time-t<6e4*r;else if("games"===a){var o=Math.max(Math.ceil((t-seasonstart_avg_week)/864e5/7),1);dlog("update week for player: "+e+": "+o,1),o!==current_week_avg&&(n=!1)}return!1===n&&dlog("Activity data out of date for player: "+e+", type is: "+a+", by: "+(current_time-t)/1e3,1),n}function runMain(){hasProjectionTable&&(addColumns(),chrome.storage.local.get(storageKeys,function(e){isObj(alldata=e[storagePlayerKey])?isObj(updated_times=e[storageUpdateKey])||(updated_times={}):(dlog("Could not find alldata"),alldata={},updated_times={}),dlog(updated_times,1),dlog(updated_types=e[storageUpdateTypeKey]),isObj(updated_types)||(updated_types={}),"yahoo"===siteType?onMatchupPreviewPage||onFreeAgencyPage?isObj(storage_translation_data=e[storageTranslationKey])?(updated_translation=e[storageTranslationUpdateKey],isDataCurrent("translation")?(dlog("Using cache for yahoo ID data"),dlog("yahoo IDs done"),yahooIdsDone.resolve()):(dlog("Yahoo ID data too old, Updated time: "+updated_translation+", Current Time: "+current_time),getYahooIds())):(dlog("Could not find yahoo ID data"),storage_translation_data={},updated_translation=0,getYahooIds()):(dlog("yahoo IDs done"),yahooIdsDone.resolve()):"fleaflicker"===siteType&&onMatchupPreviewPage&&(isObj(storage_translation_data=e[storageTranslationKey])||(storage_translation_data={})),isObj(depth_data=e[storageDepthKey])||(depth_data={}),depth_data.hasOwnProperty(current_season)||(depth_data[current_season]={}),depth_data[current_season].hasOwnProperty("W"+current_week)||(depth_data[current_season]["W"+current_week]={}),depth_data_current_week=depth_data[current_season]["W"+current_week],updated_depth=isObj(depth_data_current_week)?e[storageDepthUpdateKey]:0,dlog("depth data:",1),dlog(depth_data,1),dlog(updated_depth,1),isObj(activity_data=e[storageActivityKey])||(activity_data={}),activity_data.hasOwnProperty(current_season)||(activity_data[current_season]={});var t=activity_data[current_season];t.hasOwnProperty(siteType)||(t[siteType]={}),activity_data_current_season_site=t[siteType],league_settings=e[storageLeagueKey],updated_league=e[storageLeagueUpdateKey],isObj(league_settings)&&isDataCurrent("league")?(dlog("Using cache for league"),doLeagueThings()):(league_settings={},dlog("Fetching league data, Updated time: "+updated_league+", Current Time: "+current_time),jQuery.get(league_settings_url,function(e){var t=parseLeagueSettings(e=cleanHTML(e),siteType),a={};a[storageLeagueKey]=t,a[storageLeagueUpdateKey]=updated_league,chrome.storage.local.set(a,function(){doLeagueThings()})}))}))}function resetLeagueYear(){if("espn"===siteType&&(current_season!==current_season_avg||current_season!==current_season_avg_week)){var e={leagueId:league_id,seasonId:current_season,xhr:"1"};jQuery.get("//games.espn.com/ffl/freeagency",e)}}function updatePlayerStorage(){jQuery.when(projDone,rankDone,rosDone).done(function(){if(dlog("Attempting to set new player data"),dlog("fetch fail: "+fetch_fail),dlog("idp fetch fail: "+idp_fetch_fail),!fetch_fail&&!idp_fetch_fail){dlog("Setting new player data");var e={};e[storagePlayerKey]=alldata,e[storageUpdateKey]=updated_times,e[storageUpdateTypeKey]=updated_types,chrome.storage.local.set(e,function(){resetLeagueYear()})}})}function updateDepthStorage(){jQuery.when(depthDone).done(function(){if(dlog("Attempting to set new depth data"),dlog("depth fail: "+depth_fail),!depth_fail){dlog("Setting new depth data");var e={};e[storageDepthKey]=depth_data,e[storageDepthUpdateKey]=updated_depth,chrome.storage.local.set(e,function(){resetLeagueYear()})}})}function updateActivityStorage(){jQuery.when(activityDone).done(function(){dlog("Setting new activity data");var e={};e[storageActivityKey]=activity_data,chrome.storage.local.set(e,function(){resetLeagueYear()})})}function doLeagueThings(){onMatchupPreviewPage?(jQuery.when(projDone,totalsDone).done(function(){dlog("all done"),"fleaflicker"===siteType&&watchForChanges()}),"yahoo"===siteType?jQuery.when(yahooIdsDone).done(function(){getAllData("proj")}):getAllData("proj")):(jQuery.when(projDone,rankDone,rosDone,activityDone,depthDone,totalsDone).done(function(){dlog("all done"),watchForChanges()}),"yahoo"===siteType?jQuery.when(yahooIdsDone).done(function(){getAllData()}):getAllData())}function getIdxSpan(e,t){if(t=void 0!==t&&t,e&&e.length){var a=0;return jQuery(e[0]).prevAll("td, th").each(function(){a+=this.colSpan}),t&&(a+=e[0].colSpan),a}return!1}function addColumns(){var e,p,t,a,s,r,n,o,l,i,d,_,u,c,g,f,y,h,v,m;if(-1!==header_index||"fleaflicker"===siteType&&hasProjectionTable)if("espn"===siteType)if(p='<td class="playertableStat FantasyPlus FantasyPlusProjections FantasyPlusProjectionsHeader" title="Consensus point projections from FantasyPros (via FantasyPlus)">FPROS</td>',_='<td class="playertableStat FantasyPlus FantasyPlusProjections FantasyPlusProjectionsData">'+loadingDiv+"</td>",onMatchupPreviewPage)show_proj&&(proj_head.after(p),proj_head.text("ESPN"),(e=player_table_body.find(".playertableSectionHeader th:contains(STATS)")).each(function(){var e=jQuery(this).attr("colspan");jQuery(this).attr("colspan",e+1),jQuery(this).closest("table").find("tr.pncPlayerRow:not(.emptyRow)").each(function(){jQuery(this).find("td").last().after(_)})}));else{a='<td class="playertableStat FantasyPlus FantasyPlusSpark FantasyPlusSparkHeader" title="Graph of fantasy points over previous weeks (via FantasyPlus)">TREND</td>',s='<th class="FantasyPlus" colspan="2" title="Projected position rank (lower is better) with 95% confidence interval from FantasyPros (via FantasyPlus)">PROJ RANK (±RANGE)</th>',t='<td colspan="2" style="text-align: center" class="playertableStat FantasyPlus FantasyPlusRankings FantasyPlusRankingsHeader" title="Projected position rank (lower is better) for *this week* from FantasyPros (via FantasyPlus)">THIS WEEK</td>',r='<td colspan="2" style="text-align: center" class="playertableStat FantasyPlus FantasyPlusRos FantasyPlusRosHeader" title="Projected position rank (lower is better) for *the rest of the season* from FantasyPros (via FantasyPlus)">REMAINING</td>',n='<td class="playertableStat FantasyPlus FantasyPlusDepth FantasyPlusDepthHeader" title="Depth chart information (via FantasyPlus)">DEPTH</td>';var P='<td class="playertableStat FantasyPlus FantasyPlusAvg FantasyPlusAvgData">'+loadingDiv+"</td>",w='<td class="playertableStat FantasyPlus FantasyPlusMedian FantasyPlusMedianData">'+loadingDiv+"</td>",b='<td class="playertableStat FantasyPlus FantasyPlusCurrent FantasyPlusCurrentData">'+loadingDiv+"</td>";f='<td class="playertableStat FantasyPlus FantasyPlusSpark FantasyPlusSparkData">'+loadingDiv+"</td>",u='<td class="playertableStat FantasyPlus FantasyPlusRankings FantasyPlusRankingsData">'+loadingDiv+"</td>",y='<td class="playertableStat FantasyPlus FantasyPlusRankings FantasyPlusRankingsStdevData"></td>',h='<td class="playertableStat FantasyPlus FantasyPlusRos FantasyPlusRosData">'+loadingDiv+"</td>",v='<td class="playertableStat FantasyPlus FantasyPlusRos FantasyPlusRosStdevData"></td>',m='<td class="playertableStat FantasyPlus FantasyPlusDepth FantasyPlusDepthData">'+loadingDiv+"</td>",c='<td class="FantasyPlus sectionLeadingSpacer"></td>';var j=o="",D=jQuery(".playerTableBgRowHead.tableHead.playertableSectionHeader");if(e=D.find("th:last"),show_proj&&(e.attr({colspan:2,title:"Projected points for this week"}).text("PROJ PTS"),e.after('<th class="FantasyPlus" colspan="3">OWNERSHIP</th>'),e.after('<th class="FantasyPlus" colspan="1">OPRK</th>'),e.after(c),0<proj_head.find("a").length?proj_head.find("a").text("ESPN"):proj_head.text("ESPN"),o+=p+c,j+=_+c),(show_rank||show_ros)&&(l=jQuery(s),show_rank&&show_ros&&l.attr("colspan",4),show_proj?(i=jQuery(c).add(l),e.after(i)):(i=l.add(jQuery(c)),e.before(i)),show_rank&&(o+=t,j+=u+y),show_ros&&(o+=r,j+=h+v),o+=c,j+=c),show_proj?proj_head.after(o):(show_rank||show_ros)&&proj_head.before(o),show_depth){var F=D.next("tr").find("td.sectionLeadingSpacer:first").index();D.find("th.playertableSectionHeaderFirst").attr({colspan:F+1,title:"Player information"});var k=player_table_header.find("td:contains(TEAM POS)"),T=k.first().index();k.after(n)}for(var x=0,R=[show_avg,show_med,show_current,show_spark],A=0;A<R.length;A++)!0===R[A]&&(x+=1);if(show_avg||show_med||show_current||show_spark)D.find("th:contains(SEASON)").attr({colspan:4+x,title:"Season statistics"});var S=player_table_header.find("td:contains(AVG)"),C=S.first().index();show_depth&&(C-=1),show_med&&S.after('<td class="playertableStat FantasyPlus FantasyPlusMedian FantasyPlusMedianHeader" title="Injury/Suspension-adjusted median points for the season (via FantasyPlus)">MED</td>'),show_avg&&S.after('<td class="playertableStat FantasyPlus FantasyPlusAvg FantasyPlusAvgHeader" title="Injury/Suspension-adjusted average points for the season (via FantasyPlus)">iAVG</td>');var Q=player_table_header.find("td:contains(LAST)"),M=Q.first().index();show_depth&&(M-=1),show_spark&&Q.after(a),show_current&&Q.after('<td class="playertableStat FantasyPlus FantasyPlusCurrent FantasyPlusCurrentHeader" title="Points scored this week (via FantasyPlus)">CURR</td>');var O=player_table_body.find("tr.playerTableBgRowSubhead td:contains(OPP)").first().index();if(show_depth&&(O-=1),player_table_rows.each(function(){var e=jQuery(this),t=e.find("td").eq(O).text(),a="** BYE **"===t?header_index-1:header_index,s="** BYE **"===t?C-1:C,r="** BYE **"===t?M-1:M,n=0;show_med&&(e.find("td").eq(s).after(w),n+=1),show_avg&&(e.find("td").eq(s).after(P),n+=1),show_current&&(e.find("td").eq(r).after(b),r+=1,n+=1),show_spark&&(e.find("td").eq(r).after(f),n+=1),show_proj?e.find("td").eq(a+n).after(j):(show_rank||show_ros)&&e.find("td").eq(a+n).before(j),show_depth&&e.find("td").eq(T).after(m)}),(show_proj||show_current)&&onClubhousePage){var B=player_table_body.find("tr.playerTableBgRowHead:last");d=B.prevAll(".playerTableBgRowSubhead:first").clone();var E=B.prev().attr("class").match(/playerTableBgRow(\d)/),L="0";E&&2===E.length&&(L=Math.abs(parseInt(E[1])-1));var Y="playerTableBgRow"+L;d.removeClass(),d.addClass("FantasyPlus FantasyPlusTotals pncPlayerRow "+Y),d.find("td").empty(),d.find("td:first").html("<b>TOTAL</b>");var I=d.find(".FantasyPlusProjectionsHeader"),K=d.find(".FantasyPlusCurrentHeader");d.find("td").removeClass(function(e,t){return(t.match(/(^|\s)FantasyPlus\S+Header/g)||[]).join(" ")}),I.addClass("FantasyPlusProjectionsTotal"),K.addClass("FantasyPlusCurrentTotal"),B.before(d)}}else if("yahoo"===siteType){if(onMatchupPreviewPage)show_proj&&(p='<th style="width: 38px;" class="Ta-end Va-top FantasyPlus FantasyPlusProjections FantasyPlusProjectionsHeader" title="Consensus point projections from FantasyPros (via FantasyPlus)"><div style="width: 40px;">Proj (FP)</div></td>',_='<td style="width: 38px;" class="Alt Ta-end F-shade Va-top FantasyPlus FantasyPlusProjections FantasyPlusProjectionsData">'+loadingDiv+"</td>",g='<td style="width: 38px;" class="Alt Ta-end F-shade Va-top FantasyPlus FantasyPlusProjections FantasyPlusProjectionsTotal">-</td>',playerTable.each(function(){var r=_,e=jQuery(this),t=e.find("thead th"),n=t.length,a=t.filter(function(){return"Proj"===jQuery(this).text()}),s=jQuery(a[0]),o=jQuery(a[1]),l=s.index(),i=o.index();s.after(p),o.before(p);var d=e.find("tbody tr"),u=d.length;d.each(function(e){var t=jQuery(this);e+1===u&&(r=g);var a=t.find("td"),s=n-a.length;a.eq(l).after(r),a.eq(i-s).before(r)})}));else if(p='<th style="width: 40px; text-align: center;" class="FantasyPlus FantasyPlusProjections FantasyPlusProjectionsHeader" title="Consensus point projections from FantasyPros (via FantasyPlus)">Proj (FP)</th>',t='<th style="width: 40px; text-align: center;" class="FantasyPlus FantasyPlusRankings FantasyPlusRankingsHeader" title="Projected position rank (lower is better) for *this week* from FantasyPros (via FantasyPlus)">Rank (FP)</th>',_='<td class="Nowrap Ta-end FantasyPlus FantasyPlusProjections FantasyPlusProjectionsData">'+loadingDiv+"</td>",u='<td class="Nowrap Ta-end FantasyPlus FantasyPlusRankings FantasyPlusRankingsData">'+loadingDiv+"</td>",custom_cols=0,o="",show_proj&&(custom_cols++,o+=p),show_rank&&(custom_cols++,o+=t),0<custom_cols){player_table_header.each(function(){var e=jQuery(this).find("th").filter(function(){return/^\w/.test(jQuery(this).text())}).first(),t=parseInt(e.attr("colspan"));isNaN(t)||e.data("modified")||e.attr({colspan:t+custom_cols,"data-modified":!0})}),proj_head.after(o);var U=proj_head.first().text();player_table_rows.each(function(){var e=jQuery(this),t=e.find("td").eq(header_index-1),a=e.find("td").eq(header_index),s=a,r=null;"Proj Pts"===U?(s=t,r="stats"):"Fan Pts"===U?(s=a,r="proj"):"Rank"===U?(s=t,r="gdd"):"This Week"===U&&(s=a,r="rank");var n="Bye"===s.text(),o=""===s.text(),l="";if(n){var i="stats"===r?3:2;s.attr("colspan",i+custom_cols)}else show_proj&&(l+=_),show_rank&&(l+=u),o&&(s.attr("colspan",1),s.next().hasClass("Bdrstart")&&(l+='<td class="Ta-end Nowrap"></td>',"stats"===r?s.after('<td class="Ta-end Nowrap"></td>'):"rank"===r&&s.after('<td class="Ta-end Nowrap"></td><td class="Ta-end Nowrap"></td>'))),(a=0===e.find(".ysf-player-video-link").length&&"stats"===r?e.find("td").eq(header_index-1):e.find("td").eq(header_index)).after(l);e.find("td:first").hasClass("Selected")&&e.find("td.FantasyPlus").addClass("Selected")})}}else if("fleaflicker"===siteType){p='<th style="width: 2%;" class="leaf FantasyPlus FantasyPlusProjections FantasyPlusProjectionsHeader" title="Consensus point projections from FantasyPros (via FantasyPlus)">FPros</th>';var N='<th class="FantasyPlus horizontal-spacer"></th>';c='<td class="FantasyPlus horizontal-spacer"></td>';var G='<th class="FantasyPlus vertical-spacer bottom">&nbsp;</th>',H='<td class="FantasyPlus">&nbsp;</td>',J=function(e,s,r){r=void 0===r?"3%":r,e.each(function(){var e=jQuery(this),t=jQuery(s);e.hasClass("bottom")&&t.addClass("bottom"),e.hasClass("right")&&(e.removeClass("right"),t.addClass("right"));var a=e.next();a.length&&!a.hasClass("horizontal-spacer")&&a.css("width",r),e.after(t)})},q=function(e,t){if(t&&t.length&&Number.isInteger(e)&&0<=e){var a,s=jQuery(t[0]).closest("table").find("thead tr.first"),r=0;return s.find("td, th").each(function(){r<=e&&(a=jQuery(this),e=e-this.colSpan+1,r++)}),a}return!1},W=function(e,s,r){s=void 0!==s&&s,r=void 0!==r&&r;var n=new RegExp(e);if(s)var o=new RegExp(s);return player_table_header.find("th").filter(function(){var e=jQuery(this);if(n.test(e.text())){if(r||!s)return!0;var t=getIdxSpan(e),a=q(t,e);return o.test(a.text())}return!1})},V=function(e,t){if(t=void 0!==t&&parseInt(t),e&&e.length)if("number"!=typeof t){var a=(n=[],o=-1,l=getIdxSpan(r=e),i=!1,r.parent("tr").next("tr").find("td, th").each(function(){var e=jQuery(this);if(i){if(e.hasClass("horizontal-spacer"))return!1;n.push(e)}else o+=this.colSpan,l<=o&&(n.push(e),i=!0)}),n).length;0<a&&e.attr("colspan",a)}else{var s=e[0].colSpan;e.attr("colspan",s+t)}var r,n,o,l,i};if(onMatchupPreviewPage){if(_='<td class="text-right FantasyPlus FantasyPlusProjections FantasyPlusProjectionsData">'+loadingDiv+"</td>",g='<td class="text-right FantasyPlus FantasyPlusProjections FantasyPlusProjectionsTotal">--</td>',show_proj){proj_head.each(function(){var e=jQuery(this),t=getIdxSpan(e),a=q(t,e);V(a,1)}),J(player_table_header.find("th").filter(function(){return"Proj"===jQuery(this).text()||"Projected"===jQuery(this).text()}),p,"6%");var $=playerTable.find("tr.scoreboard").closest("table");if($.find("thead tr th").filter(function(){return"Projected"===jQuery(this).text()}).length){var z=$.find("tbody tr:last td:last");V(z,1)}}playerTable.each(function(){var e=jQuery(this),r=e.find("th").filter(function(){return"Proj"===jQuery(this).text()||"Projected"===jQuery(this).text()}).index();if(-1<r){var n=!1;e.find("tbody").find(player_table_row_selector).each(function(){var e=jQuery(this),t=e.find("td, th"),a=t.eq(r),s=_;e.hasClass("divider")?n?s=H:(s=g,a.html("--"),a.addClass("FantasyPlusFleaTotal"),n=!0):e.hasClass("scoreboard")?s=g:e.hasClass("repeated")?s=G:"Optimum"===t.first().text()&&(s=H),s=jQuery(s),a.hasClass("bottom")&&s.addClass("bottom"),a.hasClass("right")&&(a.removeClass("right"),s.addClass("right")),show_proj&&a.after(s)})}})}else{a='<th style="width: 4%;" class="leaf FantasyPlus FantasyPlusSpark FantasyPlusSparkHeader" title="Graph of fantasy points over previous weeks (via FantasyPlus)">Trend</th>',s='<th colspan="2" class="top left right FantasyPlus FantasyPlusRankingsTop FantasyPlusRankingsTopHeader" title="Projected position rank (lower is better) with 95% confidence interval from FantasyPros (via FantasyPlus)">Proj Rank (±Range)</th>',t='<th colspan="2" style="text-align: center;" class="leaf left FantasyPlus FantasyPlusRankings FantasyPlusRankingsHeader" title="Projected position rank (lower is better) for *this week* from FantasyPros (via FantasyPlus)">This Week</th>',r='<th colspan="2" style="text-align: center;" class="leaf right FantasyPlus FantasyPlusRos FantasyPlusRosHeader" title="Projected position rank (lower is better) for *the rest of the season* from FantasyPros (via FantasyPlus)">Remaining</th>',n='<th style="width: 4%;" class="leaf FantasyPlus FantasyPlusDepth FantasyPlusDepthHeader" title="Depth chart information (via FantasyPlus)">Depth</th>',_='<td class="FantasyPlus FantasyPlusProjections FantasyPlusProjectionsData">'+loadingDiv+"</td>",f='<td class="FantasyPlus FantasyPlusSpark FantasyPlusSparkData">'+loadingDiv+"</td>",u='<td style="width: 2%;" class="left FantasyPlus FantasyPlusRankings FantasyPlusRankingsData">'+loadingDiv+"</td>",y='<td style="width: 2%;" class="right FantasyPlus FantasyPlusRankings FantasyPlusRankingsStdevData"></td>',h='<td style="width: 2%;" class="FantasyPlus FantasyPlusRos FantasyPlusRosData">'+loadingDiv+"</td>",m='<td class="FantasyPlus FantasyPlusDepth FantasyPlusDepthData">'+loadingDiv+"</td>";var Z=function(s,r,n){Number.isInteger(s)&&0<=s&&(n=void 0!==n&&n,player_table_rows.each(function(){var e=jQuery(this),t=e.find("td, th").eq(s),a=jQuery(r);t.hasClass("right")&&!t.hasClass("FantasyPlus")&&(t.removeClass("right"),a.addClass("right")),(t.hasClass("bottom")||e.hasClass("last"))&&a.addClass("bottom"),n&&(a=a.add(jQuery(c))),e.hasClass("repeated")&&(a=t.hasClass("leaf")?null:G),t.after(a)}))};if(W("^Rank$",!(v='<td style="width: 2%;" class="right FantasyPlus FantasyPlusRos FantasyPlusRosStdevData"></td>'),!0).css("width","3%"),W("^Last [0-9]+$|^Total$|^Avg$","^Fantasy$").css("width","4%"),W("^Season$").css("width","5%"),show_depth){var X=player_table_header.find("th").filter(function(){return"Name"===jQuery(this).text()}),ee=getIdxSpan(X),te=q(ee,X);J(X,n),V(te),Z(ee,m)}var ae=getIdxSpan(proj_head),se=q(ae,proj_head);if(se&&se.length||(show_ros=show_rank=show_proj=!1),show_proj&&(J(proj_head,p),V(se),Z(ae,_)),show_rank||show_ros){l=jQuery(s),i=jQuery(N).add(l),se.after(i),show_rank&&show_ros&&V(l,2);var re=getIdxSpan(l)-1;if(show_rank){var ne=jQuery(t),oe=!1;show_ros||(ne.addClass("right"),ne=ne.add(jQuery(N)),oe=!0),l.parent().next().find("th").eq(re).after(ne),Z(re,u),Z(re+1,y,oe)}if(show_ros){var le=jQuery(r),ie=jQuery(h);show_rank?re+=1:(le.addClass("left"),ie.addClass("left")),le=le.add(jQuery(N)),l.parent().next().find("th").eq(re).after(le),show_rank&&(re+=1),Z(re,ie.prop("outerHTML")),Z(re+1,v,!0)}}if(show_spark){var de=playerTable.find("tr th").filter(function(){return jQuery(this).text().match(/Season|Avg/)}),ue=getIdxSpan(de),pe=q(ue,de);J(de,a),V(pe),Z(ue,f)}if(onClubhousePage){var _e=player_table_body.find("tr[id^=row].last:first");d=_e.clone(),_e.find("td").removeClass("bottom"),d.removeAttr("id"),d.addClass("divider strong FantasyPlus");var ce=d.find("td");ce.each(function(e){var t=jQuery(this);t.addClass("bottom"),0===e?(t.addClass("FantasyPlus"),t.html('<span class="player">Total</span>')):(t.empty(),t.removeClass(function(e,t){return(t.match(/(^|\s)FantasyPlus\S+/g)||[]).join("")}),t.addClass("FantasyPlus"),t.hasClass("horizontal-spacer")||t.html("&nbsp;"))});var ge=getIdxSpan(proj_head),fe=ce.eq(ge);fe.html("—"),fe.addClass("FantasyPlusFleaTotal"),show_proj&&((fe=fe.next()).html("—"),fe.addClass("FantasyPlusProjections FantasyPlusProjectionsTotal")),fe.next().html("—"),fe.next().addClass("FantasyPlusActualTotal"),_e.after(d)}}}}function parseLeagueSettings(e,t){var a,i,s=jQuery(e);if("espn"===((league_settings={}).siteType=t))a=function(e){return parseFloat(s.find("td:contains('"+e+"')").next().first().text())},league_settings.pass_yds=a("Passing Yards (PY)")||a("(PY5)")/5||a("(PY10)")/10||a("(PY20)")/20||a("(PY25)")/25||a("(PY50)")/50||a("(PY100)")/100||0,league_settings.pass_tds=a("TD Pass (PTD)")||0,league_settings.pass_ints=a("Interceptions Thrown (INT)")||0,league_settings.pass_cmp=a("Each Pass Completed (PC)")||a("(PC5)")/5||a("(PC10)")/10||0,league_settings.pass_icmp=a("Each Incomplete Pass (INC)")||a("(IP5)")/5||a("(IP10)")/10||0,league_settings.pass_att=a("Each Pass Attempted (PA)")||0,league_settings.pass_300_bonus=a("300-399 yard passing game (P300)")||0,league_settings.pass_400_bonus=a("400+ yard passing game (P400)")||0,league_settings.rush_yds=a("Rushing Yards (RY)")||a("(RY5)")/5||a("Every 10 rushing yards (RY10)")/10||a("(RY20)")/20||a("(RY25)")/25||a("(RY50)")/50||a("(RY100)")/100||0,league_settings.rush_att=a("Rushing Attempts (RA)")||a("(RA5)")/5||a("(RA10)")/10||0,league_settings.rush_tds=a("TD Rush (RTD)")||0,league_settings.rush_100_bonus=a("100-199 yard rushing game (RY100)")||0,league_settings.rush_200_bonus=a("200+ yard rushing game (RY200)")||0,league_settings.rec_yds=a("Receiving Yards (REY)")||a("Every 5 receiving yards (REY5)")/5||a("(REY10)")/10||a("(REY20)")/20||a("(REY25)")/25||a("(REY50)")/50||a("(REY50)")/100||0,league_settings.rec_att=a("Each reception (REC)")||a("(REC5)")/5||a("(REC10)")/10||0,league_settings.rec_tds=a("TD Reception (RETD)")||0,league_settings.rec_100_bonus=a("100-199 yard receiving game (REY100)")||0,league_settings.rec_200_bonus=a("200+ yard receiving game (REY200)")||0,league_settings.xpt=a("Each PAT Made (PAT)")||0,league_settings.fga=(a("Total FG Attempted (FGA)")||0)+.6*(a("FG Attempted (0-39 yards) (FGA9)")||0)+.3*(a("FG Attempted (40-49 yards) (FGA40)")||0)+.1*(a("FG Attempted (50+ yards) (FGA50)")||0),league_settings.fg=(a("Total FG Made (FG)")||0)+.6*(a("FG Made (0-39 yards) (FG0)")||0)+.3*(a("FG Made (40-49 yards) (FG40)")||0)+.1*(a("FG Made (50+ yards) (FG50)")||0),league_settings.fgm=(a("Total FG Missed (FGM)")||0)+.6*(a("FG Missed (0-39 yards) (FGM0)")||0)+.3*(a("FG Missed (40-49 yards) (FGM40)")||0)+.1*(a("FG Missed (50+ yards) (FGM50)")||0),league_settings.fumbles=a("Total Fumbles Lost (FUML)")||0,league_settings.ff=a("Each Fumble Forced (FF)")||0,league_settings.tka=a("Assisted Tackles (TKA)")||0,league_settings.tks=a("Solo Tackles (TKS)")||0,league_settings.pd=a("Passes Defensed (PD)")||0,league_settings.int=a("Each Interception (INT)")||0,league_settings.deftd=a("Interception Return TD (INTTD)")||0,league_settings.fr=a("Each Fumble Recovered (FR)")||0,league_settings.sf=a("Each Safety (SF)")||0,league_settings.sk=a("Each Sack (SK)")||2*a("1/2 Sack (HALFSK)")||0,league_settings.pa=a("Points Allowed (PA)")||0,league_settings.pa0=a("0 points allowed (PA0)")||0,league_settings.pa1=a("1-6 points allowed (PA1)")||0,league_settings.pa7=a("7-13 points allowed (PA7)")||0,league_settings.pa14=a("14-17 points allowed (PA14)")||0,league_settings.pa18=a("18-21 points allowed (PA18)")||0,league_settings.pa22=a("22-27 points allowed (PA22)")||0,league_settings.pa28=a("28-34 points allowed (PA28)")||0,league_settings.pa35=a("35-45 points allowed (PA35)")||0,league_settings.pa46=a("46+ points allowed (PA46)")||0,league_settings.ya=a("Yards Allowed (YA)")||0,league_settings.ya100=a("Less than 100 total yards allowed (YA100)")||0,league_settings.ya199=a("100-199 total yards allowed (YA199)")||0,league_settings.ya299=a("200-299 total yards allowed (YA299)")||0,league_settings.ya349=a("300-349 total yards allowed (YA349)")||0,league_settings.ya399=a("350-399 total yards allowed (YA399)")||0,league_settings.ya449=a("400-449 total yards allowed (YA449)")||0,league_settings.ya499=a("450-499 total yards allowed (YA499)")||0,league_settings.ya549=a("500-549 total yards allowed (YA549)")||0,league_settings.ya550=a("550+ total yards allowed (YA550)")||0;else if("yahoo"===t){i=jQuery("#settings-stat-mod-table tbody td",s);var r=(a=function(e){var o=[],t=i.filter(function(){return this.childNodes[0].nodeValue===e});if(t&&0<t.length){var a=t.next().first().text().split(";"),l={};jQuery.each(a,function(e,t){var a;if(-1<(t=t.trim()).indexOf("yards per point"))a=1/parseFloat(t.split(" ")[0]),o.push(a);else if(-1<t.indexOf("points at ")){var s=t.split(" "),r=parseFloat(s[0]),n=parseFloat(s[3]);l[n]=r}else a=parseFloat(t),o.push(a)}),o.push(l)}return o})("Passing Yards");league_settings.pass_yds=r[0]||0,league_settings.pass_bonus={};var n=r[1];for(var o in n)n.hasOwnProperty(o)&&(league_settings.pass_bonus[o]=n[o]);league_settings.pass_tds=a("Passing Touchdowns")[0]||0,league_settings.pass_ints=a("Interceptions")[0]||0,league_settings.pass_cmp=a("Completions")[0]||0,league_settings.pass_icmp=a("Incomplete Passes")[0]||0,league_settings.pass_att=a("Passing Attempts")[0]||0,league_settings.pass_firstdown=a("Passing 1st Downs")[0]||0;var l=a("Rushing Yards");league_settings.rush_yds=l[0]||0,league_settings.rush_bonus={};var d=l[1];for(var u in d)d.hasOwnProperty(u)&&(league_settings.rush_bonus[u]=d[u]);league_settings.rush_att=a("Rushing Attempts")[0]||0,league_settings.rush_tds=a("Rushing Touchdowns")[0]||0,league_settings.rush_firstdown=a("Rushing 1st Downs")[0]||0;var p=a("Receiving Yards");league_settings.rec_yds=p[0]||0,league_settings.rec_bonus={};var _=p[1];for(var c in _)_.hasOwnProperty(c)&&(league_settings.rec_bonus[c]=_[c]);league_settings.rec_att=a("Receptions")[0]||0,league_settings.rec_tds=a("Receiving Touchdowns")[0]||0,league_settings.rec_firstdown=a("Receiving 1st Downs")[0]||0,league_settings.xpt=a("Point After Attempt Made")[0]||0,league_settings.fga=0,league_settings.fg=.6*((a("Field Goals 0-19 Yards")[0]||0)+(a("Field Goals 20-29 Yards")[0]||0)+(a("Field Goals 30-39 Yards")[0]||0))/3+.3*(a("Field Goals 40-49 Yards")[0]||0)+.1*(a("Field Goals 50+ Yards")[0]||0),league_settings.fgm=.6*((a("Field Goals Missed 0-19 Yards")[0]||0)+(a("Field Goals Missed 20-29 Yards")[0]||0)+(a("Field Goals Missed 30-39 Yards")[0]||0))/3+.3*(a("Field Goals Missed 40-49 Yards")[0]||0)+.1*(a("Field Goals Missed 50+ Yards")[0]||0),league_settings.fumbles=a("Fumbles Lost")[0]||a("Fumbles")[0]||0,league_settings.ff=a("Fumble Force")[0]||0,league_settings.tka=a("Tackle Assist")[0]||0,league_settings.tks=a("Tackle Solo")[0]||0,league_settings.pd=a("Pass Defended")[0]||0,league_settings.int=a("Interception")[0]||0,league_settings.deftd=a("Touchdown")[0]||a("Defensive Touchdown")[0]||0,league_settings.fr=a("Fumble Recovery")[0]||0,league_settings.sk=a("Sack")[0]||0,league_settings.sf=a("Safety")[0]||0,league_settings.pa=0,league_settings.pa0=a("Points Allowed 0 points")[0]||0,league_settings.pa1=a("Points Allowed 1-6 points")[0]||0,league_settings.pa7=a("Points Allowed 7-13 points")[0]||0,league_settings.pa14=a("Points Allowed 14-20 points")[0]||0,league_settings.pa21=a("Points Allowed 21-27 points")[0]||0,league_settings.pa28=a("Points Allowed 28-34 points")[0]||0,league_settings.pa35=a("Points Allowed 35+ points")[0]||0,league_settings.ya=0,league_settings.ya100=a("Defensive Yards Allowed 0-99")[0]||0,league_settings.ya199=a("Defensive Yards Allowed 100-199")[0]||0,league_settings.ya299=a("Defensive Yards Allowed 200-299")[0]||0,league_settings.ya399=a("Defensive Yards Allowed 300-399")[0]||0,league_settings.ya499=a("Defensive Yards Allowed 400-499")[0]||0,league_settings.ya500=a("Defensive Yards Allowed 500+")[0]||0}else if("fleaflicker"===t){for(var Y,g=(i=jQuery("#body-center-main > table",s)).find("tr td.table-heading").closest("tr"),I=[17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65],K=[0,5,27,68,62,77,78,62,69,57,94,65,71,84,81,71,94,60,93,77,76,89,65,78,56,71,76,80,70,63,63,75,67,57,54,55,58,30,19,6,6,5,1,0,2,0,0,1,0],U=0,f=0;f<K.length;f++)U+=K[f];var N=I[0],G=I[I.length-1];a=function(B,E){E=void 0!==E&&E;var e,L=[],t=g.find("td.table-heading:contains('"+Y+"')").closest("tr");e=0<t.parent("thead").length?i.find("tbody tr:first").nextUntil(g,"tr").addBack():t.nextUntil(g,"tr");var a=new RegExp("^"+B+"(?:(s|es))?(?: [(]Quantity[)])?$"),s=e.find("td.left strong").filter(function(){return a.test(jQuery(this).text())}).closest("td.left");if(s&&0<s.length&&jQuery.each(s,function(e,t){var a=jQuery(t),s=a.contents(),r=parseFloat(s[0].textContent),n=!1,o=s[1].textContent.trim();if(-1<o.indexOf(" for every")){n=!0;var l=1,i=a.find("span.for-every");0<i.length&&(l=parseFloat(i.text().trim())),r=parseFloat(r/l)}var d=a.find("strong:contains('(Quantity)')"),u=s.filter("strong:first"),p=s.index(u),_=s.slice(p+1),c="",g=!1,f=!1,y=s.get(p-1).textContent.trim(),h=n&&(/yards? covered/.test(o)||/yards? covered/.test(y));"Kicking"!==Y&&h&&(f=g=!0),_.length&&(c=_[0].textContent.trim(),"Kicking"===Y&&/Field Goals\? (Made|Missed)/.test(B)?!/^\(/.test(c)&&d.length&&(g=!0):/^\(/.test(c)?h&&(f=g=!0):g=!0);var v,m,P=36.36,w=1;if(g===E)if(!1===g)if("Kicking"!==Y)L.push(r);else if(h||_.length&&!/^\(/.test(c)){v=_.filter("span.text-muted.low").text().trim();var b=N;v&&(v=parseFloat(v),b=Math.min(Math.max(v,N),G)),m=_.filter("span.text-muted.high").text().trim();var j=G;if(m&&(m=parseFloat(m),j=Math.max(Math.min(m,G),N)),v||m){var D=I.indexOf(b),F=I.indexOf(j),k=I.slice(D,F+1),T=K.slice(D,F+1);if(h){for(var x=K.slice(F+1),R=0;R<x.length;R++)T[T.length-1]+=x[R];for(var A=0,S=0;S<k.length;S++)A+=k[S]*T[S];for(var C=0,Q=0;Q<T.length;Q++)C+=T[Q];P=parseFloat(A/C),m&&(P=Math.min(P,m)),v&&(P-=v)}else P=1;for(var M=w=0;M<T.length;M++)w+=parseFloat(T[M]/U)}r*=P*w,L.push(r)}else L.push(r);else if(!f&&(!(-1<B.indexOf(" TD"))||d.length)){var O={};O.pts=r,O.is_per=n,(v=_.filter("span.text-muted.low").text().trim())&&(v=parseFloat(v)),(m=_.filter("span.text-muted.high").text().trim())&&(m=parseFloat(m)),""!==v&&""===m&&c&&/is exactly/.test(c)&&(m=v),O.low=v,O.high=m,L.push(O)}}),!1===E){for(var r=0,n=0;n<L.length;n++)r+=L[n];L=r}else 0===L.length&&(L=null);return L},Y="Passing",league_settings.pass_yds=a("Passing Yard")||0,league_settings.pass_yds_bonus=a("Passing Yard",!0),league_settings.pass_tds=a("Passing TD")||0,league_settings.pass_tds_bonus=a("Passing TD",!0),league_settings.pass_ints=a("Interception")||0,league_settings.pass_ints_bonus=a("Interception",!0),league_settings.pass_cmp=a("Passing Completion")||0,league_settings.pass_cmp_bonus=a("Passing Completion",!0),league_settings.pass_icmp=a("Incomplete Pass")||0,league_settings.pass_icmp_bonus=a("Incomplete Pass",!0),league_settings.pass_att=a("Passing Attempt")||0,league_settings.pass_att_bonus=a("Passing Attempt",!0),Y="Rushing",league_settings.rush_yds=a("Rushing Yard")||0,league_settings.rush_yds_bonus=a("Rushing Yard",!0),league_settings.rush_tds=a("Rushing TD")||0,league_settings.rush_tds_bonus=a("Rushing TD",!0),league_settings.rush_att=a("Rushing Attempt")||0,league_settings.rush_att_bonus=a("Rushing Attempt",!0),Y="Receiving",league_settings.rec_yds=a("Receiving Yard")||0,league_settings.rec_yds_bonus=a("Receiving Yard",!0),league_settings.rec_tds=a("Receiving TD")||0,league_settings.rec_tds_bonus=a("Receiving TD",!0),league_settings.rec_att=a("Catch")||0,league_settings.rec_att_bonus=a("Catch",!0),Y="Kicking",league_settings.xpt=a("XP")||0,league_settings.xpt_bonus=a("XP",!0),league_settings.fga=a("Field Goal Attempt")||0,league_settings.fga_bonus=a("Field Goal Attempt",!0),league_settings.fg=a("Field Goals? Made")||0,league_settings.fg_bonus=a("Field Goals? Made",!0),league_settings.fgm=a("Field Goals? Missed")||0,league_settings.fgm_bonus=a("Field Goals? Missed",!0),Y="Misc",league_settings.fumbles=a("Fumbles? Lost")||a("Fumble")||0,league_settings.fumbles_bonus=a("Fumbles? Lost",!0)||a("Fumble",!0),Y="Defense",league_settings.tka=a("Assisted Tackle")||a("Total Tackle")||0,league_settings.tka_bonus=a("Assisted Tackle",!0)||a("Total Tackle",!0),league_settings.tks=a("Solo Tackle")||a("Total Tackle")||0,league_settings.tks_bonus=a("Solo Tackle",!0)||a("Total Tackle",!0),league_settings.pd=a("Pass(?:es)? Defended")||0,league_settings.pd_bonus=a("Pass(?:es)? Defended",!0),league_settings.ff=a("Fumbles? Forced")||0,league_settings.ff_bonus=a("Fumbles? Forced",!0),league_settings.fr=a("Fumbles? Recovered")||0,league_settings.fr_bonus=a("Fumbles? Recovered",!0),league_settings.sk=a("Sack")||0,league_settings.sk_bonus=a("Sack",!0),league_settings.sf=a("Safety")||0,league_settings.sf_bonus=a("Safety",!0),league_settings.int=a("Interception")||0,league_settings.int_bonus=a("Interception",!0),league_settings.deftd=a("Defensive TD")||a("INT Return TD")||a("Fumble Return TD")||0,league_settings.deftd_bonus=a("Defensive TD",!0)||a("INT Return TD",!0)||a("Fumble Return TD",!0),league_settings.ya=a("Net Yards? Allowed")||0,league_settings.ya_bonus=a("Net Yards? Allowed",!0),league_settings.pa=a("Points? Allowed")||a("Offensive . Special Teams Points? Allowed")||a("Offensive Points? Allowed [(]FG, Pass TD, Rush TD[)]")||0,league_settings.pa_bonus=a("Points? Allowed",!0)||a("Offensive . Special Teams Points? Allowed",!0)||a("Offensive Points? Allowed [(]FG, Pass TD, Rush TD[)]",!0)}return updated_league=current_time,dlog(league_settings),league_settings}function ajaxCbPos(e){jQuery.ajax(e).done(function(e){(0,this.custom_data.cb)(this.custom_data.pos,(e=cleanHTML(e)).trim())}).fail(function(){var e=this.custom_data.cb,t=this.custom_data.pos,a=this.custom_data.source_site;idp_fetch_fail=!0,chrome.runtime.sendMessage({request:"fetch_fail",value:a}),e(t,"error")})}function fetchPositionData(a,F,e){var k,t="",s="offense";if("rank"===F||"ros"===F){k="","rb"!==a&&"wr"!==a&&"te"!==a||(.5===league_settings.rec_att?k="half-point-ppr-":1===league_settings.rec_att&&(k="ppr-"));var r="";"ros"===F&&(r="ros-"),t="https://www.fantasypros.com/nfl/rankings/"+r+k+a+".php"}else-1<off_positions_proj.indexOf(a)?t="https://www.fantasypros.com/nfl/projections/"+a+".php?week="+current_week:(s="idp",t="https://www.fantasysharks.com/apps/bert/forecasts/projections.php?csv=1&Position="+a+"&Segment="+(627+current_week));var n={url:t,timeout:ajax_timeout,custom_data:{cb:e,source_site:t,pos:a}};if("idp"===s)ajaxCbPos(n);else{var o=(experts[F]||{}).selection||[];if("proj"===F&&1===o.length)ajaxCbPos(n);else if("proj"===F){n.method="get",n.data={scoring:"STD"},n.traditional=!0,ajaxCbPos(n)}else jQuery.ajax(n).done(function(e){var t=this.custom_data.cb,a=this.custom_data.pos,s=this.custom_data.source_site;e=cleanHTML(e);var r={"expert[]":[]},n=r["expert[]"];r.scoring="half-point-ppr-"===k?"HALF":"ppr-"===k?"PPR":"STD";var o=experts[F]||{},l=o.selection||[],i=o.num||{},d=i.top||10,u=i.updated||7,p=jQuery(e).find("#edit-experts #experts");if(p.length){var _=p.find("tbody tr"),c=p.find("thead tr"),g=c.find("th:first").index(),f=c.find("th.accuracy.overall:contains(In-Season)").index(),y=c.find("th.accuracy.position:contains(In-Season)").index(),h=c.find("th:contains(Date)").index();if(-1===l.indexOf("all")){var v=_.find("td").filter(function(){return"FantasyPros Staff"===jQuery(this).text()}).parents("tr").find("td:eq("+g+") input").val();jQuery.isNumeric(v)&&n.push(v);var m=-1<l.indexOf("updated"),P=-1<l.indexOf("overall"),w=-1<l.indexOf("position");if((P||w)&&d&&_.length>d){var b=-1;P?b=f:w&&(b=y),_.sort(function(e,t){var a=jQuery(t).find("td:eq("+b+")").text().replace("#","")||1/0;return(jQuery(e).find("td:eq("+b+")").text().replace("#","")||1/0)-a}),_=_.slice(0,d)}if(m&&u){var j=current_month+1,D=_.filter(function(){var e=jQuery(this).find("td:eq("+h+")").text(),t=current_year;j<e.split("/")[0]&&(t-=1);var a=new Date(e+" "+t);if((current_date-a)/1e3/60/60/24<u+1)return this});1<D.length?_=D:(_.sort(function(e,t){var a=jQuery(t).find("td:eq("+h+")").text(),s=jQuery(e).find("td:eq("+h+")").text(),r=current_year;j<a.split("/")[0]&&(r-=1);var n=new Date(a+" "+r),o=current_year;return j<s.split("/")[0]&&(o-=1),n-new Date(s+" "+o)}),_=_.slice(0,2))}}_.each(function(){var e=jQuery(this).find("td").eq(g).find("input").val();n.push(e)})}dlog(n),delete r["expert[]"],ajaxCbPos({url:s,method:"get",data:r,timeout:ajax_timeout,custom_data:{cb:t,source_site:s,pos:a}})}).fail(function(){var e=this.custom_data.cb,t=this.custom_data.source_site;fetch_fail=!0,chrome.runtime.sendMessage({request:"fetch_fail",value:t}),e(a,"error")})}}function parsesiteCSV(e){var t,a,s,r=[],n=!1;for(t=a=s=0;s<e.length;s++){var o=e[s],l=e[s+1];r[t]=r[t]||[],r[t][a]=r[t][a]||"",","===o&&void 0===l&&(a++,r[t][a]=""),'"'===o&&n&&'"'===l?(r[t][a]+=o,++s):'"'!==o?","!==o||n?"\n"!==o||n?r[t][a]+=o:(++t,a=0):++a:n=!n}return r}function convertFProsToCSV(e,o,t){var a=jQuery(e);a.find("thead tr:has(td)").remove(),a.find('tbody tr:not([class^="mpb-player"])').remove();var s,r=jQuery("table#data, table#rank-data",a).first(),n=r.find('thead th:contains("Player")'),l=n.clone();return l.text("Team"),l.insertAfter(n),r.find("tbody tr").each(function(e,t){var a=jQuery(t).find("td.player-label"),s=a.find('a[href^="/nfl"]').first().find("span.full-name").text().trim(),r="";(r="proj"===o?a.contents().filter(function(){return 3===this.nodeType}).text().trim():a.find("small:first").text().trim())||(r="FA");var n=jQuery("<td>"+r+"</td>");a.text(s),n.insertAfter(a)}),"rank"===o?s=-1<idp_positions.indexOf(t)?fpros_rank_idp_headers:fpros_rank_headers:"ros"===o?s=-1<idp_positions.indexOf(t)?fpros_ros_idp_headers:fpros_ros_headers:"proj"===o&&(s=fpros_proj_headers[t]),r.table2CSV({delivery:"value",header:s})}function getYahooIds(){storage_translation_data={},jQuery.getJSON(chrome.extension.getURL("data/yahoo_ids.json")).done(function(e){storage_translation_data=e,dlog("yahoo IDs done"),yahooIdsDone.resolve(),updated_translation=current_time;var t={};t[storageTranslationKey]=storage_translation_data,t[storageTranslationUpdateKey]=updated_translation,chrome.storage.local.set(t)}).fail(function(e,t,a){var s=t+", "+a;dlog("Could not fetch yahoo ID data"),dlog(s),chrome.runtime.sendMessage({request:"fetch_fail",value:s})})}function getPosProjections(){var y=all_positions_proj.length,h="proj";function e(e,t){var a,s;if("error"!==(t=t.replace(/<\/?(html|body)>/g,""))){-1<off_positions_proj.indexOf(e)?(a=e.toUpperCase(),t=convertFProsToCSV(t,h,a)):a=idp_conversion[e];for(var r=(s=parsesiteCSV(t))[0],n=0;n<r.length;n++)r[n]=r[n].trim();var o=r.indexOf("Team"),l=r.indexOf("Player");if(-1<o&&-1<l)for(var i=1;i<s.length;i++){var d=s[i],u=a;if(d.length<o+1)dlog("Error fetching projections");else{var p=d[o].trim();team_name_conversion.hasOwnProperty(p)&&(p=team_name_conversion[p]);var _=d[l].trim();if("dst"===e)"espn"===siteType?_=_.split(" ").pop()+" D/ST":"yahoo"===siteType?_=team_abbrevs[_]:"fleaflicker"===siteType&&(_=_.split(" ").pop()),_=_.trim(),u="D/ST",p="-";else if(-1<def_positions_proj.indexOf(e)){var c=fixPlayerName(_=(_=_.split(",")[1]+" "+_.split(",")[0]).trim(),u,p,"proj");c?_=c[0]:player_name_fix.hasOwnProperty(_)&&(_=player_name_fix[_]),player_position_fix_sharks.hasOwnProperty(_)&&(u=player_position_fix_sharks[_]),_=_.trim()}var g=(_=_.toUpperCase())+"|"+u+"|"+p;alldata.hasOwnProperty(g)||(alldata[g]={});for(var f=l+1;f<r.length;f++)alldata[g][r[f].trim()]=d[f].trim().replace(",","")}}}0===(y-=1)&&(updated_times.proj=current_time,updated_types.proj=((experts.proj||{}).selection||"none").toString(),addProjections())}for(var t=0;t<all_positions_proj.length;t++){fetchPositionData(all_positions_proj[t],h,e)}}function getPosRankings(){var h=all_positions_rank.length,v="rank";function e(e,t){var a,s;if("error"!==t){a=e.toUpperCase();for(var r=(s=parsesiteCSV(t=convertFProsToCSV(t,v,a)))[0],n=0;n<r.length;n++)r[n]=r[n].trim();var o=r.indexOf("Team"),l=r.indexOf("Player");if(-1<o&&-1<l)for(var i=1;i<s.length;i++){var d=s[i],u=a,p=d[o].trim();team_name_conversion.hasOwnProperty(p)&&(p=team_name_conversion[p]);var _=d[l].trim();"dst"===e&&("espn"===siteType?_=_.split(" ").pop()+" D/ST":"yahoo"===siteType?_=team_abbrevs[_]:"fleaflicker"===siteType&&(_=_.split(" ").pop()),u="D/ST",p="-");var c=(_=_.trim().toUpperCase())+"|"+u+"|"+p;alldata.hasOwnProperty(c)||(alldata[c]={});for(var g=l+1;g<r.length;g++)alldata[c][r[g].trim()]=d[g].trim()}}if(0===(h-=1)){updated_times.rank=current_time;var f=experts.rank||{},y=f.num||{};updated_types.rank=(f.selection||"none").toString()+"-"+(y.top||0)+"-"+(y.updated||0),addRankings()}}for(var t=0;t<all_positions_rank.length;t++){fetchPositionData(all_positions_rank[t],v,e)}}function getRosRankings(){var h=all_positions_rank.length,v="ros";function e(e,t){var a,s;if("error"!==t){a=e.toUpperCase();for(var r=(s=parsesiteCSV(t=convertFProsToCSV(t,v,a)))[0],n=0;n<r.length;n++)r[n]=r[n].trim();var o=r.indexOf("Team"),l=r.indexOf("Player");if(-1<o&&-1<l)for(var i=1;i<s.length;i++){var d=s[i],u=a,p=d[o].trim();team_name_conversion.hasOwnProperty(p)&&(p=team_name_conversion[p]);var _=d[l].trim();"dst"===e&&("espn"===siteType?_=_.split(" ").pop()+" D/ST":"yahoo"===siteType?_=team_abbrevs[_]:"fleaflicker"===siteType&&(_=_.split(" ").pop()),u="D/ST",p="-");var c=(_=_.trim().toUpperCase())+"|"+u+"|"+p;alldata.hasOwnProperty(c)||(alldata[c]={});for(var g=l+1;g<r.length;g++)d[g]?alldata[c][r[g].trim()+" Ros"]=d[g].trim():alldata[c][r[g].trim()+" Ros"]=""}}if(0===(h-=1)){updated_times.ros=current_time;var f=experts.ros||{},y=f.num||{};updated_types.ros=(f.selection||"none").toString()+"-"+(y.top||0)+"-"+(y.updated||0),addRos()}}for(var t=0;t<all_positions_rank.length;t++){fetchPositionData(all_positions_rank[t],v,e)}}function getPlayerCheckName(e,t,a,s){var r=null;return"proj"===s?r=e.toUpperCase()+"|"+t+"|"+a:"depth"===s&&(r=e.toUpperCase()),r}function fixPlayerPosition(e,t,a){var s={};return"proj"===a?s=player_position_fix:"depth"===a&&(s=player_position_fix_depth),player_name_fix.hasOwnProperty(e)&&(e=player_name_fix[e]),s.hasOwnProperty(e)&&(t=s[e]),"string"==typeof t&&t.indexOf(",EDR")?t=t.replace(",EDR",""):t.constructor===Array&&(t=t.filter(function(e){return"EDR"!==e})),t}function fixPlayerName(e,t,a,s,r){r=void 0===r?alldata:r;var n=t;t.constructor!==Array&&(n=[t]);for(var o=0;o<n.length;o++){if(t=n[o],"proj"===s&&("DT"===t||"DE"===t?t="DL":"CB"!==t&&"S"!==t||(t="DB")),r.hasOwnProperty(getPlayerCheckName(e,t,a,s)))return[e,t];if(player_name_fix.hasOwnProperty(e)){var l=player_name_fix[e];if(r.hasOwnProperty(getPlayerCheckName(l,t,a,s)))return dlog("fixed name: "+e+"; is now: "+l),[l,t]}else{var i,d,u,p,_,c,g=[e],f=e.split(" "),y=f[0],h=f.slice(1).join(" ");if(y===y.toUpperCase()){if(u=y.split("").join(".")+". "+h,r.hasOwnProperty(getPlayerCheckName(u,t,a,s)))return dlog("fixed name: "+e+"; is now: "+u),[u,t];g.push(u)}var v=/( V| IV| III| II| Jr\.| Sr\.)$/;i=g.length;for(var m=0;m<i;m++){var P=(d=g[m]).match(v);if(P){var w=P[1];if(p=d.slice(0,d.indexOf(w)),r.hasOwnProperty(getPlayerCheckName(p,t,a,s)))return dlog("fixed name: "+e+"; is now: "+p),[p,t];g.push(p)}}i=g.length;for(var b=0;b<i;b++){var j=(d=g[b]).split(" "),D=j[0],F=j.slice(1).join(" ");if(player_name_translations.hasOwnProperty(D)){if(_=player_name_translations[D]+" "+F,r.hasOwnProperty(getPlayerCheckName(_,t,a,s)))return dlog("fixed name: "+e+"; is now: "+_),[_,t];g.push(_)}}var k=[" V"," IV"," III"," II"," Jr."," Sr."];i=g.length;for(var T=0;T<i;T++){d=g[T];for(var x=0;x<k.length;x++){if(c=d+k[x],r.hasOwnProperty(getPlayerCheckName(c,t,a,s)))return dlog("fixed name: "+e+"; is now: "+c),[c,t];g.push(c)}}}}return!1}function parseDepth(e){var f={},y="";jQuery("div.article-content > table > tbody> tr > td.la > table tbody tr",e).each(function(e,t){var a=jQuery(t).find("b");e%2==0?(y=a.text(),f[y]={}):a.each(function(e,t){var a=jQuery(t),p=a.text().replace(":","");"NT"===p?p="DT":"OLB"!==p&&"ILB"!==p&&"MLB"!==p||(p="LB"),f[y].hasOwnProperty(p)||(f[y][p]={});var _=!1,c=1,g=a.nextUntil("br");g.each(function(e,t){if(_)_=!1;else{_=!1;var a=jQuery(t),s=a.text().trim(),r=s,n=jQuery(g[e+1]).text().trim();n&&/^\(/.test(n)&&(_=!0,s+=" "+n);var o=[];if(-1<s.indexOf("(")){var l=s.match(/\([\w/]+\)/g);if(l&&l.length)for(var i=0;i<l.length;i++)o.push(l[i].replace(/[()]/g,"").toUpperCase());r=s.slice(0,s.indexOf(" ("))}r=r.replace(/[�′]+/g,"'"),player_name_fix.hasOwnProperty(r)&&(r=player_name_fix[r]);var d=r.toUpperCase(),u=a.find("font").addBack("font").attr("color");if(r.length){if(f[y][p].hasOwnProperty(d))return;f[y][p][d]={name:r,num:c,status:o,type:u}}c+=1}})})}),depth_data[current_season]["W"+current_week]=f,depth_data_current_week=depth_data[current_season]["W"+current_week],updated_depth=current_time,addDepth()}function getDepth(){jQuery.ajax({url:depth_url,timeout:ajax_timeout}).done(function(e){parseDepth(e=cleanHTML(e))}).fail(function(){depth_fail=!0,chrome.runtime.sendMessage({request:"fetch_fail",value:depth_url}),addDepth()})}function getPlayerData(){show_proj?getPosProjections():(projDone.resolve(),hasProjTotals?addProjTotals():totalsDone.resolve()),show_rank?getPosRankings():rankDone.resolve(),show_ros?getRosRankings():rosDone.resolve()}function getAllData(e){e=void 0===e?["proj","rank","ros"]:e,show_proj||show_rank||show_ros?isDataCurrent(e)?(dlog("Using cache for player data"),addPlayerData()):(alldata={},updated_times={},updated_types={},updatePlayerStorage(),getPlayerData()):(projDone.resolve(),hasProjTotals?addProjTotals():totalsDone.resolve(),rankDone.resolve(),rosDone.resolve()),show_avg||show_med||show_spark||show_current?(updateActivityStorage(),addAvg()):activityDone.resolve(),show_depth?isDataCurrent("depth")?(dlog("Using cache for depth data"),addDepth()):(dlog("resetting depth"),depth_data[current_season]["W"+current_week]={},depth_data_current_week=depth_data[current_season]["W"+current_week],updated_depth=0,updateDepthStorage(),getDepth()):depthDone.resolve()}function validPosition(e,t){var a=[t];return-1<t.indexOf("/")&&"D/ST"!==t?a=t.split("/"):"FLEX"===t?a=["RB","WR","TE"]:"OP"===t?a=["QB","RB","WR","TE"]:"DL"===t?a=["DE","EDR","DT"]:"DB"===t?a=["CB","S"]:"DP"===t&&(a=["DE","EDR","DT","LB","CB","S"]),-1<a.indexOf(e)}function optimizeLineup(){observer_disconned=!0,observer&&observer.disconnect(),setSelectors(!1);var i=[];jQuery(".FantasyPlusProjectionsData").each(function(){var e=jQuery(this),t=parseFloat(e.text()),a=e.parent("tr"),s=a.find(player_name_selector).attr("id");if(void 0!==s){var r=getPlayerCellText(a,e),n=_slicedToArray(r,2),o=getPlayerDataFromCell(n[0],n[1])[1];i.push([s,o,t])}}),i.sort(function(e,t){var a=t[2]-e[2];return isFinite(a)?a:isFinite(e[2])?-1:1});var e=player_table_body.find(player_table_header_selector),t=e.first().nextUntil(e.last()).not(".playerTableBgRowHead, .FantasyPlus"),r=0,d=[];t.each(function(){var e=jQuery(this),s=e.find(player_cell_pos_selector).text().trim();if(0===e.find(".pncButtonLocked").length){var t=i.filter(function(e){var t=e[1];if(Array.isArray(t)){var a=!1;return t.forEach(function(e){!0===validPosition(e,s)&&(a=!0)}),a}return validPosition(t,s)});if(0<t.length){var a=t[0],r=i.findIndex(function(e){return e[0]===a[0]});i[r]=[null,null,null];var n=player_table_body.find("#"+a[0]).parent("tr");if(n.find(player_cell_pos_selector).text().trim()!==s){var o=n.find(".pncButtonMove");if(o.length){d.push([o,e]);var l=e.find(".pncButtonMove");l.length&&d.push([l,null])}}}}});var n=[],o=player_table_body.find("tr.playerTableBgRowHead:last");d.forEach(function(e){var a=e[0],s=e[1];"Bench"!==a.parents("tr").first().find(player_cell_pos_selector).text().trim()&&(setTimeout(function(){a.trigger("click");var e=o.nextAll(player_table_row_selector).not(".irRow").find(".pncButtonHere:visible").first(),t=e.parent("td").attr("id");s&&n.push([t,s]),e.trigger("click")},r),r+=100)}),0!==r&&setTimeout(function(){var s=0;n.forEach(function(e){var t=e[0].find(".pncButtonMove:visible").first(),a=e[1];setTimeout(function(){t.trigger("click"),player_table_body.find(a).find(".pncButtonHere:visible").first().trigger("click")},s),s+=100}),setTimeout(function(){refreshData()},s+100)},r+100)}function calcBonus(e,t){var a,s=0;if("yahoo"===siteType){a=[];var r=league_settings[e+"_bonus"];for(var n in r)r.hasOwnProperty(n)&&a.push(parseFloat(n));a=a.sort().reverse();for(var o=0;o<a.length;o++)parseFloat(a[o+1])&&parseFloat(a[o])?s+=r[a[o]]*(a[o]<=t[e+"_yds"]&&t[e+"_yds"]<a[o+1]):parseFloat(a[o])&&(s+=r[a[o]]*(t[e+"_yds"]>=a[o]))}else if("fleaflicker"===siteType&&(a=league_settings[e+"_bonus"])&&a.length){dlog(t,1);for(var l=0;l<a.length;l++){var i=a[l],d=i.pts,u=i.low,p=i.high,_=i.is_per,c="number"==typeof u,g="number"==typeof p,f=!1;if(_?f=!0:c&&g?f=u<=t&&t<=p:c?f=u<=t:g&&(f=t<=p),f){var y=0;if(_){var h=t;c&&g?(u<=0&&(u+=1),h=Math.max(Math.min(t-u+1,p-u+1),0)):c?h=Math.max(t-u,0):g&&(h=Math.max(Math.min(t,p),0)),y=d*h}else y=d;s+=y}}}return s}function calculateProjections(e,t,a,s){if("depth"===e)return[t,a,s];var r,n=t.toUpperCase();if("DT"===a||"DE"===a?a="DL":"CB"!==a&&"S"!==a||(a="DB"),a=fixPlayerPosition(t,a,"proj"),"proj-default"===e)jQuery.isArray(a)&&(a=a[0]),"DT"===a||"DE"===a?a="DL":"CB"!==a&&"S"!==a||(a="DB"),isObj(r=expected_player[a])||(r={});else{var o=n+"|"+a+"|"+s;if(void 0===(r=alldata[o])){var l=fixPlayerName(t,a,s,"proj");if(!l)return dlog("Could not find player: "+o),"proj"===e?"--":["--","--"];t=l[0],a=l[1],n=t.toUpperCase(),r=alldata[o=n+"|"+a+"|"+s]}}if(dlog("player data: ",1),dlog(r,1),"proj"===e||"proj-default"===e){for(var i=0,d=["pass_yds","pass_tds","pass_ints","pass_att","pass_cmp","pass_icmp","pass_firstdown","rush_yds","rush_tds","rush_att","rush_firstdown","rec_yds","rec_att","rec_tds","rec_firstdown","xpt","fg","fga","fgm","fumbles"],u={pass:{QB:.349},rush:{QB:.304,RB:.205,WR:.317},rec:{RB:.353,WR:.627,TE:.567}},p=0;p<d.length;p++){var _=d[p];if(dlog(_,1),league_settings.hasOwnProperty(_)){var c=league_settings[_];dlog(c,1);var g=0;"pass_icmp"===_?g=Math.max((r.pass_att||0)-(r.pass_cmp||0),0):"fgm"===_?g=Math.max((r.fga||0)-(r.fg||0),0):"pass_firstdown"===_?u.pass.hasOwnProperty(a)&&(g=u.pass[a]*r.pass_att):"rush_firstdown"===_?u.rush.hasOwnProperty(a)&&(g=u.rush[a]*r.rush_att):"rec_firstdown"===_?u.rec.hasOwnProperty(a)&&(g=u.rec[a]*r.rec_att):g=r[_]||0,dlog(g,1);var f=c*g;if(dlog(f,1),i+=f,"fleaflicker"===siteType){var y=calcBonus(_,g);dlog(y,1),i+=y}}}var h={};for(var v in"D/ST"===a?h={sk:"def_sack",ff:"def_ff",int:"def_int",deftd:"def_td",fr:"def_fr",pa:"def_pa",ya:"def_tyda",sf:"def_safety"}:-1<idp_positions.indexOf(a)&&(h={sk:"Scks",ff:"FumFrc",tka:"Tack",tks:"Asst",pd:"PassDef",int:"Int",deftd:"DefTD",fr:"Fum"}),h)if(h.hasOwnProperty(v)&&league_settings.hasOwnProperty(v)){var m=h[v];dlog(v+", "+m,1);var P=league_settings[v];dlog(P,1);var w=r[m]||0;dlog(w,1);var b=P*w;if(dlog(b,1),i+=b,"fleaflicker"===siteType){var j=calcBonus(v,w);dlog(j,1),i+=j}}var D=0;return"espn"===league_settings.siteType?D=league_settings.pass_300_bonus*(300<=r.pass_yds&&r.pass_yds<400)+league_settings.pass_400_bonus*(400<=(r.pass_yds||0))+league_settings.rush_100_bonus*(100<=r.rush_yds&&r.rush_yds<200)+league_settings.rush_200_bonus*(200<=(r.rush_yds||0))+league_settings.rec_100_bonus*(100<=r.rec_yds&&r.rec_yds<200)+league_settings.rec_200_bonus*(200<=(r.rec_yds||0))+league_settings.pa0*(0===r.def_pa)+league_settings.pa1*(0<r.def_pa&&r.def_pa<=6)+league_settings.pa7*(6<r.def_pa&&r.def_pa<=13)+league_settings.pa14*(13<r.def_pa&&r.def_pa<=17)+league_settings.pa18*(17<r.def_pa&&r.def_pa<=21)+league_settings.pa22*(21<r.def_pa&&r.def_pa<=27)+league_settings.pa28*(27<r.def_pa&&r.def_pa<=34)+league_settings.pa35*(34<r.def_pa&&r.def_pa<=45)+league_settings.pa46*(45<r.def_pa)+league_settings.ya100*(0<=r.def_tyda&&r.def_tyda<100)+league_settings.ya199*(100<=r.def_tyda&&r.def_tyda<200)+league_settings.ya299*(200<=r.def_tyda&&r.def_tyda<300)+league_settings.ya349*(300<=r.def_tyda&&r.def_tyda<350)+league_settings.ya399*(350<=r.def_tyda&&r.def_tyda<400)+league_settings.ya449*(400<=r.def_tyda&&r.def_tyda<450)+league_settings.ya499*(450<=r.def_tyda&&r.def_tyda<500)+league_settings.ya549*(500<=r.def_tyda&&r.def_tyda<550)+league_settings.ya550*(550<=r.def_tyda):"yahoo"===league_settings.siteType&&(D=calcBonus("pass",r)+calcBonus("rush",r)+calcBonus("rec",r)+league_settings.pa0*(0===r.def_pa)+league_settings.pa1*(0<r.def_pa&&r.def_pa<=6)+league_settings.pa7*(6<r.def_pa&&r.def_pa<=13)+league_settings.pa14*(13<r.def_pa&&r.def_pa<=20)+league_settings.pa21*(20<r.def_pa&&r.def_pa<=27)+league_settings.pa28*(27<r.def_pa&&r.def_pa<=34)+league_settings.pa35*(34<r.def_pa)+league_settings.ya100*(0<=r.def_tyda&&r.def_tyda<100)+league_settings.ya199*(100<=r.def_tyda&&r.def_tyda<200)+league_settings.ya299*(200<=r.def_tyda&&r.def_tyda<300)+league_settings.ya399*(300<=r.def_tyda&&r.def_tyda<400)+league_settings.ya499*(400<=r.def_tyda&&r.def_tyda<500)+league_settings.ya500*(500<=r.def_tyda)),i+=D,dlog("returning score: ",1),dlog(t+","+i,1),isNaN(i)?(dlog("bad player score"),"--"):(Math.round(10*i)/10).toFixed(1)}return"rank"===e?parseFloat(r["Avg Rank"])?[(Math.round(10*r["Avg Rank"])/10).toFixed(1),(Math.round(10*r["Std Dev"]*1.96)/10).toFixed(1)]:["--","--"]:"ros"===e?parseFloat(r["Avg Rank Ros"])?[(Math.round(10*r["Avg Rank Ros"])/10).toFixed(1),(Math.round(10*r["Std Dev Ros"]*1.96)/10).toFixed(1)]:["--","--"]:void 0}function getPlayerDataFromCell(e,t){var a,s="",r="",n="";if("espn"===siteType){if(-1<t.indexOf("D/ST"))s=e.find("a").text().trim(),n="-",r="D/ST";else{for(var o=t.split(","),l=0;l<o.length;l++)o[l]=o[l].trim();s=o[0];var i=o[1].split(/\s|\xa0/);if("JAX"===(n=i[0].toUpperCase())?n="JAC":"WSH"===n&&(n="WAS"),r=i[1],2<o.length){r=[r],a=o.slice(2);for(var d=0;d<a.length;d++){var u=a[d];if(!u)break;var p=u.split(/\s|\xa0/);r.push(p[0])}}}s=s.replace("*","")}else if("yahoo"===siteType){var _=e.find(".ysf-player-name"),c=_.find("span").first().text().trim().split(" - ");"JAX"===(n=c[0].toUpperCase())&&(n="JAC"),-1<(r=c[1]).indexOf(",")?(a=r.split(","),r=[],a.forEach(function(e){r.push(e.trim())})):"DEF"===r&&(r="D/ST"),s=_.find("a").text().trim(),"D/ST"===r&&(s=n,n="-")}else if("fleaflicker"===siteType){if(s=e.find("div.player-name .player-text").text().trim(),n=e.find("div.player-info span.player-team").text().trim(),"D/ST"===(r=e.find("div.player-info span.position").text().trim())){var g=s.split(/\s|\xa0/);s=g[g.length-1],n="-"}else-1<r.indexOf("/")&&(a=r.split("/"),r=[],a.forEach(function(e){r.push(e.trim())}));n in team_abbrev_fix_fleaflicker&&(n=team_abbrev_fix_fleaflicker[n]),s=s.replace("*","")}return[s,r,n]}function getPlayerCellText(e,t){var a=e.find(player_name_selector);"yahoo"===siteType&&onMatchupPreviewPage&&(a=t.nearest("td.player"));var s=a.text().trim();return a.find(".fantasy-finder")&&((a=a.clone()).find("#inline-availability-marker").remove(),s=a.text().trim().replace(/([\r\n])/g,"")),[a,s]}function getProjectionData(e,t,a){var s,r,n,o,l,i=getPlayerCellText(t,a),d=_slicedToArray(i,2);if(s=d[0],r=d[1],"adjavg"!==e){if(!r||"(Empty)"===r)return"fleaflicker"===siteType&&onMatchupPreviewPage?(--total_player_ids<=0&&fetchFleaflickerIds.resolve(),popCell(a,"",e)):popCell(a,"rank"===e||"ros"===e?["--","--"]:"--",e);if(r.match(/(TQB|HC|P)$/))return popCell(a,"rank"===e||"ros"===e?["--","--"]:"--",e);var u,p,_=getPlayerDataFromCell(s,r),c=_[0],g=_[1],f=_[2];if("espn"===siteType)return popCell(a,calculateProjections(e,c,g,f),e);if("yahoo"===siteType){if(!onMatchupPreviewPage&&!onFreeAgencyPage)return popCell(a,calculateProjections(e,c,g,f),e);if(dlog("id is "+(o=(n=s.find(".ysf-player-name").find("a").attr("href")).split("/").pop())+", seen is "+(p=storage_translation_data.hasOwnProperty("ID_"+o)),1),u=alldata.hasOwnProperty(c.toUpperCase()+"|"+g+"|"+f),"D/ST"===g||p||u)return p&&(c=storage_translation_data["ID_"+o]),popCell(a,calculateProjections(e,c,g,f),e);dlog("Could not find player in yahoo database: "+n+", "+c)}else if("fleaflicker"===siteType){if("depth"===e)if(g.constructor===Array){var y=[];g.forEach(function(e){"DL"===e?y.push("DE","DT"):"DB"===e?y.push("CB","S"):y.push(e)}),g=y}else"DL"===g?g=["DE","DT"]:"DB"===g&&(g=["CB","S"]);if(!onMatchupPreviewPage)return popCell(a,calculateProjections(e,c,g,f),e);var h=(n=s.find("div.player-name a.player-text").attr("href")).split("/").pop().split("-");o=h.pop();for(var v=[],m=0;m<h.length;m++)v.push(h[m].toUpperCase());var P=v.join(" ");if(p=storage_translation_data.hasOwnProperty("ID_"+o),u=alldata.hasOwnProperty(P+"|"+g+"|"+f),"D/ST"===g||p||u)return u?c=P:p&&(c=storage_translation_data["ID_"+o]),--total_player_ids<=0&&fetchFleaflickerIds.resolve(),popCell(a,calculateProjections(e,c,g,f),e);jQuery.ajax({url:n,method:"get",timeout:ajax_timeout,custom_data:{p_href:n,pid:o,pos_name:g,team_name:f,datatype:e,cell:a}}).done(function(e){e=cleanHTML(e);var t=this.custom_data,a=t.pid,s=t.pos_name,r=t.team_name,n=t.datatype,o=t.cell,l=jQuery(e).find("#left-container > div.panel > div.panel-heading").text();popCell(o,calculateProjections(n,l,s,r),n);var i={};storage_translation_data["ID_"+a]=l,i[storageTranslationKey]=storage_translation_data,chrome.storage.local.set(i)}).fail(function(){var e=this.custom_data,t=e.p_href,a=e.datatype;popCell(e.cell,"--",a),chrome.runtime.sendMessage({request:"fetch_fail",value:t})}).always(function(){--total_player_ids<=0&&fetchFleaflickerIds.resolve()})}return null}if(show_avg)l=t.find("FantasyPlusAvgData").prev().text();else if(show_med){l=t.find("FantasyPlusMedianData").prev().text()}if(r&&"--"!==l){var w=!1;if("espn"===siteType){if(o=s.find("a").attr("playerid"),show_current){var b=t.find(".gameStatusDiv").text().trim();b&&-1<b.indexOf("-")&&(" "!==b[1]?(dlog("found live game: "+b),w="live"):w="done")}}else"fleaflicker"===siteType&&(n=s.find("div.player-name a.player-text").attr("href"))&&(o=n.split("-").pop());if(o){goodVal(activity_data_current_season_site,o,"object")||(activity_data_current_season_site[o]={});var j=activity_data_current_season_site[o],D=o;j.hasOwnProperty("translation")&&(dlog("found translation data for: "+o+", is: "+(D=j.translation)),delete j.games_played,delete j.games_played_updated,delete j[league_id],goodVal(activity_data_current_season_site,D,"object")||(dlog("did not find rookie player data from translation"),activity_data_current_season_site[D]={}),j=activity_data_current_season_site[D]),goodVal(j,"games_played","array")||(j.games_played=[]);var F=j.games_played;goodVal(j,"games_played_updated","number")||(j.games_played_updated=0);var k=j.games_played_updated;goodVal(j,league_id,"object")||(j[league_id]={});var T=j[league_id];goodVal(T,"weekly_points","array")||(T.weekly_points=[]);var x=T.weekly_points;T.hasOwnProperty("pts_avg")||(T.pts_avg=null);var R=T.pts_avg;T.hasOwnProperty("pts_med")||(T.pts_med=null);var A=T.pts_med;if(T.hasOwnProperty("last_updated")||(T.last_updated=0),isActivityDataCurrent(D,T.last_updated,"league",w)&&isActivityDataCurrent(D,k,"games"))dlog("Using cache for player activity: "+D,1),insertAdjAvg(t,R,A,F,x);else if("espn"===siteType){var S={leagueId:league_id,playerId:o,playerIdType:"playerId",seasonId:current_season_avg,xhr:"1"};jQuery.ajax({url:"//games.espn.com/ffl/format/playerpop/overview",timeout:ajax_timeout,method:"get",data:S,custom_data:{curr_row:t,player_cell_text:r,id:D,old_id:o}}).fail(function(){var e=this.custom_data.old_id,t=this.custom_data.curr_row;dlog("failed to get player pop: "+e),insertAdjAvg(t,null,null,[],[])}).done(function(e){var t=this.custom_data,a=t.id,s=t.old_id,r=t.curr_row,n=t.player_cell_text;if(e){e=cleanHTML(e);var o=jQuery(e),l=activity_data_current_season_site[a],i=l[league_id];void 0===i&&(i={});var d=jQuery("div#tabView0 div#moreStatsView0",o),u=d.find("div.pc:not(#pcBorder)").find('a[href*="playerId"], a[href*="proId"]'),p=null;u.length&&(p=u.attr("href").match(/(playerId=|proId\/)(\d+)/)[2]),null!==p&&p!==a&&(dlog("found rookie: "+p+", "+a),l.translation=p,activity_data_current_season_site[a=p]={},(l=activity_data_current_season_site[a]).games_played=[],l.games_played_updated=0,l[league_id]={},(i=l[league_id]).weekly_points=[],i.pts_avg=null,i.pts_med=null,i.last_updated=0);var _=d.find("div#pcBorder table tbody"),c=_.find("tr.pcStatHead"),g=c.find('td:contains("OPP")').first().index()+1,f=c.find('td:contains("PTS")').first().index()+1,y=_.find("tr:not(.pcStatHead)"),h=y.find("td:nth-child("+g+")"),v=y.find("td:nth-child("+f+")"),m=h.filter(function(){return/BYE/.test(jQuery(this).text())}),P=null;1===m.length&&(P=parseFloat(m.prev().text().trim()));for(var w=jQuery.map(v,function(e,t){return e.innerText}),b=0;b<w.length;b++){var j=jQuery.isNumeric(P)&&b===P-1;void 0===l.games_played&&(l.games_played=[]),j?l.games_played[b]="BYE":n.match(/(D\/ST|TQB|HC)$/)&&jQuery.isNumeric(w[b])?l.games_played[b]=1:void 0===l.games_played[b]?l.games_played[b]=null:"BYE"===l.games_played[b]&&(l.games_played[b]=null),"-"===w[b]?w[b]=null:w[b]=parseFloat(w[b])}if(dlog("Player Activity pts",1),dlog(w,1),i.last_updated=current_time,i.weekly_points=w,void 0===i.weekly_points&&(i.weekly_points=[]),n.match(/(D\/ST|TQB|HC)$/))dlog("inserting avg for dsts, etc. for: "+a),l.games_played_updated=current_time,calcAdjAvg(r,a,l.games_played,i.weekly_points);else if(isActivityDataCurrent(a,l.games_played_updated,"games"))dlog("using cache for games played for: "+a,1),calcAdjAvg(r,a,l.games_played,i.weekly_points);else{var D={playerId:a,season:current_season_avg_week,xhr:1};jQuery.ajax({url:"//m.espn.com/nfl/playergamelog",timeout:ajax_timeout,data:D,method:"get",custom_data:{curr_row:r,id:a}}).fail(function(){var e=this.custom_data,t=e.id,a=e.curr_row,s=activity_data_current_season_site[t][league_id].weekly_points;dlog("failed to get player card: "+t),insertAdjAvg(a,null,null,[],s)}).done(function(e){var t=this.custom_data,a=t.id,s=t.curr_row,r=activity_data_current_season_site[a],n=r[league_id];if(void 0===n&&(n={}),void 0===n.weekly_points&&(n.weekly_points=[]),e){e=cleanHTML(e);var o=jQuery(e),l=jQuery('tr td:contains("POSTSEASON")',o).parents("tr");jQuery('tr td:contains("REGULAR SEASON")',o).parents("tr").nextUntil(l).filter(function(){return 1<jQuery(this).find("td").length}).each(function(e,t){if("BYE"!==r.games_played[e]){var a=jQuery(t).text();-1<a.indexOf("DID NOT PLAY")?r.games_played[e]=0:-1===a.indexOf("BYE")&&(r.games_played[e]=1)}});for(var i=0;i<r.games_played.length;i++)null===r.games_played[i]&&i<current_week_avg-1&&(r.games_played[i]=0),1!==r.games_played[i]&&(n.weekly_points[i]=null);r.games_played_updated=current_time,calcAdjAvg(s,a,r.games_played,n.weekly_points)}else dlog("No data in player card: "+a),insertAdjAvg(s,null,null,[],n.weekly_points)})}}else dlog("No data in pop: "+s),insertAdjAvg(r,null,null,[],[])})}else"fleaflicker"===siteType&&jQuery.ajax({url:n,method:"get",timeout:ajax_timeout,custom_data:{curr_row:t,p_href:n,pid:o}}).fail(function(){var e=this.custom_data,t=e.p_href,a=e.curr_row;dlog("Could not get player info: "+t),insertAdjAvg(a,null,null,[],[])}).done(function(e){var t=this.custom_data,a=t.p_href,s=t.curr_row,r=t.pid;if(e){e=cleanHTML(e);for(var n=jQuery(e),o=activity_data_current_season_site[r],l=o[league_id],i=jQuery("table#table_0",n).find("tbody").find(player_table_row_selector).not(".divider"),d=i.find("div.pro-opp-matchup").filter(function(){return"BYE"===jQuery(this).text().trim()}).parents("tr").index(),u=jQuery.map(i,function(e,t){return jQuery(e).find("td:last").text()}),p=0;p<u.length;p++)p===d?(u[p]=null,o.games_played[p]="BYE"):"—"===u[p]?(u[p]=null,o.games_played[p]=0):""===u[p]?(u[p]=null,o.games_played[p]=null):(u[p]=parseFloat(u[p]),o.games_played[p]=1);o.games_played_updated=current_time,l.last_updated=current_time,l.weekly_points=u,insertAdjAvg(s,null,null,o.games_played,l.weekly_points)}else dlog("No data in player info: "+a),insertAdjAvg(s,null,null,[],[])})}else insertAdjAvg(t,null,null,[],[])}else insertAdjAvg(t,null,null,[],[])}function calcAdjAvg(e,t,a,s){var r=0,n=0,o=null,l=null,i=s.slice(0,current_week_avg-1),d=[];dlog("Past points data",1),dlog(i,1),dlog(a,1);for(var u=0;u<i.length;u++)if(1===a[u]){var p=parseFloat(i[u])||0;d.push(p),r+=p,n++}if(0<n){var _=parseFloat(r/n);o=(Math.round(10*_)/10).toFixed(1);var c=d.sort(function(e,t){return e-t}),g=c.length/2,f=g%1==0?(c[g-1]+c[g])/2:c[Math.floor(g)];l=(Math.round(10*f)/10).toFixed(1)}void 0===activity_data_current_season_site[t][league_id]&&(activity_data_current_season_site[t][league_id]={}),insertAdjAvg(e,activity_data_current_season_site[t][league_id].pts_avg=o,activity_data_current_season_site[t][league_id].pts_med=l,a,s)}function insertAdjAvg(e,t,a,l,s){var r,n;if(show_avg&&(n=e.find(".FantasyPlusAvgData"),r=parseFloat(n.prev().text()),jQuery.isNumeric(t)?r<t?n.html('<span style="color:green">'+t+"</span>"):n.text(t):n.text("--")),show_med&&(n=e.find(".FantasyPlusMedianData"),parseFloat(r)&&(r=parseFloat(t)),jQuery.isNumeric(a)?r<a?n.html('<span style="color:green">'+a+"</span>"):a<r?n.html('<span style="color:red">'+a+"</span>"):n.text(a):n.text("--")),show_current){var o=e.find(".FantasyPlusCurrentData"),i="--";s&&0<s.length&&current_season===current_season_avg_week&&jQuery.isNumeric(s[current_week-1])&&(i=s[current_week-1]),o.text(i)}if(show_spark){var d=e.find(".FantasyPlusSparkData");if(s&&0<s.length){var u=e.find(player_name_selector),p=u.text().trim(),_=[],c=(_=p.match(/TQB$/)?["-","QB","-"]:p.match(/HC$/)?["-","HC","-"]:p.match(/P$/)?["-","P","-"]:getPlayerDataFromCell(u,p))[0],g=_[1],f=calculateProjections("proj-default",c,g,_[2]);dlog("we expect for pos: "+g+", to get: "+f,1),jQuery.isNumeric(f)&&(f=Number(f));var y=f*(4/3),h=f*(2/3),v=String(y)+":",m=String(h)+":"+String(y),P=":"+String(h),w={null:"#999"};0===f?(w[v]="#5C5D5E",w[m]="#5C5D5E",w[P]="#5C5D5E"):(w[v]="#336600",w[m]="#FF6600",w[P]="#CC0000");var b=Math.max(0,Math.min(17,current_week_avg)-6),j=s.slice(b,Math.min(Math.max(0,current_week_avg-1),17));if(j&&1<j.length){var D={disableHiddenCheck:!0,width:"35px",height:"20px",chartRangeMin:0,tooltipSkipNull:!1,tooltipFormatter:function(e,t,a){var s,r=a.x,n=a.y,o=l[r+b];return s="BYE"===o?"Bye":0===o?"Out":Math.round(10*n)/10,"W"+(r+b+1)+": "+s},type:"line",fillColor:!1,lineColor:"gray",valueSpots:w,minSpotColor:!1,maxSpotColor:!1,spotColor:!1,spotRadius:2};"fleaflicker"===siteType&&(D.height="25px",D.width="40px",D.tooltipClassname="fp-jqstooltip"),d.sparkline(j,D)}else d.text("--")}else d.text("--")}0===--total_players&&(dlog("avg done"),activityDone.resolve())}function reDefer(){(-1<header_index||"fleaflicker"===siteType&&hasProjectionTable)&&(projDone=jQuery.Deferred(),rankDone=jQuery.Deferred(),rosDone=jQuery.Deferred(),activityDone=jQuery.Deferred(),depthDone=jQuery.Deferred(),totalsDone=jQuery.Deferred(),"yahoo"===siteType&&(onMatchupPreviewPage||onFreeAgencyPage)?yahooIdsDone=jQuery.Deferred():"fleaflicker"===siteType&&onMatchupPreviewPage&&(fetchFleaflickerIds=jQuery.Deferred()))}function addPlayerData(){-1<header_index||"fleaflicker"===siteType&&hasProjectionTable?(show_proj?addProjections():(projDone.resolve(),hasProjTotals?addProjTotals():totalsDone.resolve()),show_rank?addRankings():rankDone.resolve(),show_ros?addRos():rosDone.resolve()):(dlog("no header"),projDone.resolve(),rankDone.resolve(),rosDone.resolve(),totalsDone.resolve())}function addAllData(){-1<header_index||"fleaflicker"===siteType&&hasProjectionTable?(addPlayerData(),show_avg||show_med||show_spark||show_current?addAvg():activityDone.resolve(),show_depth?addDepth():depthDone.resolve()):(dlog("no header"),projDone.resolve(),rankDone.resolve(),rosDone.resolve(),activityDone.resolve(),depthDone.resolve(),totalsDone.resolve())}function isCurrentWeek(){if("espn"===siteType)return!0;if("fleaflicker"===siteType)return is_current_week;if("yahoo"===siteType){if(page_menu){var e;if(onMatchupPreviewPage){var t=page_menu.contents().filter(function(){return 3===this.nodeType}).text(),a=t.indexOf(":");e=t.substr(0,a).split(" ").reverse()[0]}else e=page_menu.find("#selectlist_nav span").text().replace(/\D/g,"");return!isNaN(e)&&e===current_week}return!0}return!1}function popCell(e,t,a){if("depth"===a)return insertDepth(e,t);if("rank"===a||"ros"===a){var s=t[0],r=t[1];return e.text(s),"espn"!==siteType&&"fleaflicker"!==siteType||("--"===s?e.next().text(r):e.next().html('<span style="font-size: 80%;">±</span>'+r)),null}return e.text(t)}function addProjections(){if("yahoo"===siteType&&onFreeAgencyPage?is_FA_current:isCurrentWeek()){var e=player_table_body.find(".FantasyPlusProjectionsData");"fleaflicker"===siteType&&(total_player_ids=e.length),e.each(function(){var e=jQuery(this),t=e.parent(),a=t.find('td:contains("** BYE **")'),s=0<a.length;"espn"===siteType&&onMatchupPreviewPage&&a.html('<span style="color:#999999">BYE</span>'),s?popCell(e,"--"):getProjectionData("proj",t,e)}),dlog("proj done"),projDone.resolve(),hasProjTotals?addProjTotals():(dlog("totals done"),totalsDone.resolve())}else dlog("not current week"),player_table_body.find(".FantasyPlusProjectionsData").each(function(){var e=jQuery(this),t="-";"fleaflicker"===siteType&&(t="—"),e.text(t)}),dlog("proj done"),projDone.resolve(),dlog("totals done"),totalsDone.resolve()}function addProjTotals(){var g,f,y;if("espn"===siteType)if(show_proj||show_current){if(onClubhousePage){var h=jQuery.Deferred(),v=jQuery.Deferred();jQuery.when(h,v).done(function(){dlog("totals done"),totalsDone.resolve()});var e=function(e){var t="proj"===e,a="curr"===e;if(t||a){var s,r=player_table_header.filter(function(){return"STARTERS"===jQuery(this).prev().find("th.playertableSectionHeaderFirst").text()});t?(s=".FantasyPlusProjections",g=f=0):a&&(s=".FantasyPlusCurrent",y=0);for(var n=!0;n;)if(!(r=r.next()).hasClass("pncPlayerRow")||r.hasClass("emptyRow")||r.hasClass("FantasyPlusTotals"))n=!1;else{var o=r.find(s+"Data");if(t){var l=parseFloat(o.text()),i=parseFloat(o.prev().text());i&&(g+=i),l&&(f+=l)}else if(a){var d=parseFloat(o.text());d&&(y+=d)}}var u=playerTable.find(s+"Total");if(t){var p=Math.round(100*parseFloat(f))/100;0===p&&(p="--"),u.html(p);var _=Math.round(100*parseFloat(g))/100;0===_&&(_="--"),u.prev().html(_),h.resolve()}else if(a){var c=Math.round(100*parseFloat(y))/100;0===c&&(c="--"),u.html(c),v.resolve()}}};show_proj?e("proj"):h.resolve(),show_current?jQuery.when(activityDone).done(function(){e("curr")}):v.resolve()}else if(onMatchupPreviewPage){if(show_proj)jQuery(".playerTableTable").each(function(){var e=jQuery(this),t=e.find(".FantasyPlusProjectionsData");if(0<t.length){var a=0;t.each(function(){var e=parseFloat(jQuery(this).text());e&&(a+=e)});var s=Math.round(a);e.next().prepend('<div title="Total projected points (via FantasyPlus)" class="danglerBox totalScore">'+s+"</div>")}}),dlog("totals done"),totalsDone.resolve();else dlog("totals done"),totalsDone.resolve()}}else dlog("totals done"),totalsDone.resolve();else if("yahoo"===siteType)if(show_proj){var u=0;if(onClubhousePage){var p=player_table_body.find('tr:not(".bench") .FantasyPlusProjectionsData');if(0<p.length){p.each(function(){var e=parseFloat(jQuery(this).text());e&&(u+=e)});var t,a=Math.round(100*u)/100,s=parseFloat(pts_total.first().text());if(!isNaN(s))s<a?t="green":a<s&&(t="red"),t&&(t=' style="color: '+t+'"'),pts_total.append('<span title="Total projected points (via FantasyPlus)" class="FantasyPlus"'+t+"> ["+a+"]</span>")}dlog("totals done"),totalsDone.resolve()}else onMatchupPreviewPage&&jQuery.when(yahooIdsDone).done(function(){var e=pts_total.parent().clone();e.addClass("FantasyPlus"),e.children().text(""),e.find("th").text("FP Proj");var l=e.find("td"),i=jQuery(playerTable.first()),d=jQuery(".FantasyPlusProjectionsTotal");i.find(player_table_header_selector).find("th.FantasyPlusProjectionsHeader").each(function(e){u=0;var t=jQuery(this).index(),a=i.find("tbody tr"),s=jQuery(l[e]);if(0<(p=a.find("td:nth-child("+(t+1)+")")).length){p.each(function(){var e=parseFloat(jQuery(this).text());e&&(u+=e)});var r,n=Math.round(100*u)/100,o=parseFloat(jQuery(pts_total[e]).text());if(isNaN(o))s.text("-");else o<n?(r="green",s.addClass("F-positive")):n<o&&(r="red",s.addClass("F-negative")),r&&(r=' style="color: '+r+'"'),jQuery(d[e]).html('<div title="Total projected points (via FantasyPlus)" class="FantasyPlus"'+r+"> ["+n+"]</div>"),s.text(n)}else s.text("-")}),pts_total.parent().after(e),dlog("totals done"),totalsDone.resolve()})}else dlog("totals done"),totalsDone.resolve();else if("fleaflicker"===siteType)if(onClubhousePage){var l,i;g=l=i=0;var r=player_table_body.find("tr td.FantasyPlusProjectionsTotal"),d=getIdxSpan(r),n=player_table_body.find("tr td.FantasyPlusFleaTotal"),_=getIdxSpan(n),o=player_table_body.find("tr td.FantasyPlusActualTotal"),c=getIdxSpan(o);if(player_table_rows.first().nextUntil(".divider").addBack().each(function(){var e=jQuery(this),t=0;if(show_proj){var a=e.find("td").eq(d);(t=parseFloat(a.text()))&&(g+=t)}var s=e.find("td").eq(_),r=parseFloat(s.text());r&&(l+=r);var n=e.find("td").eq(c),o=parseFloat(n.text());o&&(i+=o)}),show_proj){var m=Math.round(10*g)/10;r.html(m)}var P=Math.round(10*l)/10;n.html(P);var w=Math.round(10*i)/10;o.html(w),dlog("totals done"),totalsDone.resolve()}else onMatchupPreviewPage&&(show_proj||fetchFleaflickerIds.resolve(),jQuery.when(fetchFleaflickerIds).done(function(){var _=base_table.find("table tr.scoreboard").closest("table");playerTable.not(_).each(function(e){var t=jQuery(this).find("tbody"),n=0,o=0,a=t.find("tr td.FantasyPlusProjectionsTotal"),l=getIdxSpan(a),s=t.find("tr td.FantasyPlusFleaTotal"),i=getIdxSpan(s);if(t.find(player_table_row_selector).first().nextUntil(".divider").addBack().each(function(){var e=jQuery(this),t=0;if(show_proj){var a=e.find("td").eq(l);(t=parseFloat(a.text()))&&(n+=t)}var s=e.find("td").eq(i),r=parseFloat(s.text());r&&(o+=r)}),show_proj){var r=Math.round(10*n)/10;a.html(r)}var d=Math.round(10*o)/10;if(s.html(d),show_proj){var u=_.find(".FantasyPlusProjectionsTotal").eq(e);if(u.length){var p=Math.round(100*n)/100;u.html(p)}}}),dlog("totals done"),totalsDone.resolve()}));else dlog("totals done"),totalsDone.resolve()}function addRankings(){var s;s="yahoo"===siteType&&onFreeAgencyPage?is_FA_current:isCurrentWeek(),player_table_body.find(".FantasyPlusRankingsData").each(function(){var e=jQuery(this);if(s){var t=e.parent();0<t.find('td:contains("** BYE **")').length?(dlog("bye week"),e.text("--"),"espn"===siteType&&e.next().text("--")):getProjectionData("rank",t,e)}else{var a="-";"fleaflicker"===siteType&&(a="—"),e.text(a)}}),dlog("rank done"),rankDone.resolve()}function addRos(){var a;a="yahoo"===siteType&&onFreeAgencyPage?is_FA_current:isCurrentWeek(),player_table_body.find(".FantasyPlusRosData").each(function(){var e=jQuery(this);if(a){getProjectionData("ros",e.parent(),e)}else{var t="-";"fleaflicker"===siteType&&(t="—"),e.text(t)}}),dlog("ros done"),rosDone.resolve()}function addAvg(){total_players=player_table_rows.length,player_table_rows.each(function(){getProjectionData("adjavg",jQuery(this),"")}),resetLeagueYear()}function addDepth(){isObj(depth_data_current_week)||(dlog("Current week depth not set"),depth_fail=!0,depth_data_current_week={});var e=player_table_body.find(".FantasyPlusDepthData");total_players_depth=e.length,e.each(function(){var e=jQuery(this);getProjectionData("depth",e.parent(),e)}),resetLeagueYear()}function insertDepth(e,t){if(t.constructor!==Array||t.length<3)e.text("--");else{var a=t[0],s=t[1],r=t[2],n=a.toUpperCase(),o="--";if("D/ST"===(s=fixPlayerPosition(a,s,"depth")))e.text("--");else if("FA"===r)e.text("--");else{r=Object.keys(team_abbrevs).filter(function(e){return team_abbrevs[e]===r})[0];var l={};depth_data_current_week.hasOwnProperty(r)&&(l=depth_data_current_week[r]);var i,d,u={};if(s.constructor===Array)for(var p=0;p<s.length;p++){var _=s[p],c={};if(l.hasOwnProperty(_)){if((c=l[_]).hasOwnProperty(n)){o=(s=_)+(i=(u=c)[n]).num;break}if(d=fixPlayerName(a,_,r,"depth",c)){a=d[0],s=d[1],n=a.toUpperCase(),(i=(u=c)[n]).true_name=a,o=s+i.num;break}}}else if(l.hasOwnProperty(s))if((u=l[s]).hasOwnProperty(n))o=s+(i=u[n]).num;else if(d=fixPlayerName(a,s,r,"depth",u))a=d[0],s=d[1],n=a.toUpperCase(),(i=u[n]).true_name=a,o=s+i.num;else if("RB"===s){var g={};l.hasOwnProperty("FB")&&((g=l.FB).hasOwnProperty(n)?o=(s="FB")+(i=(u=g)[n]).num:(d=fixPlayerName(a,"FB",r,"depth",g))&&(a=d[0],s=d[1],n=a.toUpperCase(),(i=(u=g)[n]).true_name=a,o=s+i.num))}"--"===o&&dlog("Could not get depth for player: "+t[0]),e.text(o);var f=Object.keys(u).sort(function(e,t){return u[e].num-u[t].num});if(f.length){for(var y="",h=0;h<f.length;h++){var v=f[h],m=u[v],P=depth_type_map[m.type],w=m.num,b=m.status.join("|"),j=m.name,D=j;m.hasOwnProperty("true_name")&&(D=m.true_name);var F="<tr>";D.toUpperCase()===a.toUpperCase()&&(F='<tr style="background-color: lightblue">'),y+=F+'<td style="width: 40px;">'+s+w+':</td><td style="width: 140px;">'+j+'</td><td style="width: 90px;">'+P+'</td><td style="width: 80px;">'+b+"</td></tr>"}var k=jQuery("<div><table><tbody></tbody></table></div>");k.find("tbody").append(y),e.css({cursor:"pointer"}),e.tooltipster({content:k,contentCloning:!1,delay:100,debug:!0,interactive:!0,theme:"tooltipster-light",side:"right"})}else dlog("No team data for pos: "+s),dlog(l)}}0===--total_players_depth&&(dlog("depth done"),depthDone.resolve())}function refreshData(e){if(dlog("rerunning"),observer_disconned=!0,observer&&observer.disconnect(),jQuery(".FantasyPlus").remove(),setSelectors(!1),reDefer(),addColumns(),!0===e){updated_times={},updated_types={},updated_depth=0,isObj(activity_data)||(activity_data={}),activity_data.hasOwnProperty(current_season)||(activity_data[current_season]={});var t=activity_data[current_season];t[siteType]={},activity_data_current_season_site=t[siteType],("yahoo"===siteType&&(onMatchupPreviewPage||onFreeAgencyPage)||"fleaflicker"===siteType&&onMatchupPreviewPage)&&(storage_translation_data={},"yahoo"===siteType&&(updated_translation=0,getYahooIds())),dlog("Refreshing data, Current Time: "+current_time),jQuery.get(league_settings_url,function(e){var t=parseLeagueSettings(e=cleanHTML(e),siteType),a={};a[storageLeagueKey]=t,a[storageLeagueUpdateKey]=updated_league,chrome.storage.local.set(a,function(){doLeagueThings()})})}else addAllData()}function watchForChanges(){if(hasPlayerTable){dlog("init watch");var d={childList:!0,characterData:!0,subtree:!0},u=base_table_selector;"fleaflicker"===siteType&&(u="div#body",onFreeAgencyPage&&(d.characterData=!1,d.subtree=!1));var p=document.querySelector(u);if(null===p)return void dlog("Not attaching observer");observer=new MutationObserver(function(e){var t=!0;if(observer_disconned=!1,0<e.length){if("yahoo"===siteType){var a=e[0].target;if(a){var s=a.id,r=a.className;"selectlist_nav"!==s&&"flyout-title"!==r||(t=!1)}}else if("fleaflicker"===siteType)if(t=!1,onMatchupPreviewPage)t=!0;else for(var n=0;n<e.length;n++){var o=e[n].addedNodes;if(o&&o.length)for(var l=0;l<o.length;l++){var i=o[l].parentElement;i&&"div"===i.localName&&"body"===i.id&&(dlog("accepted"),t=!0)}}t?refreshData():dlog("rejected")}observer_disconned&&(dlog("disconned, reattaching"),jQuery.when(projDone,rankDone,rosDone,activityDone,depthDone,totalsDone).done(function(){dlog("all done"),dlog("watching for changes after finishing"),p=document.querySelector(u),observer.observe(p,d)}))}),dlog("watching for changes"),observer.observe(p,d)}}jQuery.fn.nearest=function(e){var s,t=jQuery(this[0]),r=t.index(),a=t.parent().find(e),n=!1;return a.each(function(){var e=jQuery(this),t=e.index(),a=Math.abs(r-t);(!n||a<n)&&(n=a,s=e)}),s},chrome.runtime.onMessage.addListener(function(e,t,a){"refresh_data"===e.request&&(refreshData(!0),a("ok"))});