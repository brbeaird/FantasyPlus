"use strict";var user_settings={},columns={proj:!0,rank:!0,ros:!0,depth:!0,spark:!0,avg:!0,med:!0,current:!0},update_freq={player:{time:30,typ:"m"}},experts={proj:{selection:["all"]},rank:{selection:["all"],num:{top:10,updated:1}},ros:{selection:["all"],num:{top:5,updated:7}}},misc={remove_ads:!0,fix_css:!0},changes={};changes.columns=$.extend(!0,{},columns),changes.update_freq=$.extend(!0,{},update_freq),changes.experts=$.extend(!0,{},experts),changes.misc=$.extend(!0,{},misc);var has_change=!1;function check_recursive(e,t){for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];if($.isPlainObject(n))check_recursive(n,t);else if("set"===t)e[r]=!1;else if("check"===t)if(!0===n)has_change=!0;else if("error"===n){has_change="error";break}}}function is_changed(){check_recursive(changes,"check");var e=has_change;return has_change=!1,e}check_recursive(changes,"set"),$(function(){var l=$("#save");function v(){var e=is_changed();"error"===e?(l.attr("disabled","disabled"),l.text("Save (fix errors)")):!0===e?(l.removeAttr("disabled"),l.text("Save")):(l.attr("disabled","disabled"),l.text("Save (no changes)"))}l.text("Loading...");var u=$("#columns"),h=$('input[type="range"]'),d=$(".freq-typ"),f=$("#experts :input"),g=$("#misc");$('input[type="text"][id$=top]').tooltip({placement:"bottom",trigger:"manual",template:'<div class="tooltip tooltip-error" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"Must be an integer greater than 1"}),$('input[type="text"][id$=updated]').tooltip({placement:"bottom",trigger:"manual",template:'<div class="tooltip tooltip-error" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"Must be a positive integer"}),chrome.storage.local.get("fp_user_settings",function(e){if(l.text("Save (no changes)"),(!(user_settings=e.fp_user_settings)||Object.keys(user_settings).length<=0)&&(user_settings={}),user_settings.hasOwnProperty("columns")){var t=user_settings.columns;$.each(t,function(e,t){columns[e]=t})}if(user_settings.hasOwnProperty("update_freq")){var r=user_settings.update_freq;$.each(r,function(e,t){update_freq[e]=t})}if(user_settings.hasOwnProperty("experts")){var n=user_settings.experts;$.each(n,function(e,t){experts[e]=t})}if(user_settings.hasOwnProperty("misc")){var s=user_settings.misc;$.each(s,function(e,t){misc[e]=t})}var a;$.each(columns,function(e,t){$("#show"+e).prop("checked",t)}),u.on("click","input",function(){var e=$(this),t=e.attr("id").replace("show",""),r=e.prop("checked");changes.columns[t]=columns[t]!==r,v()}),h.rangeslider({polyfill:!1,onInit:function(){a=$(".rangeslider__handle",this.$range);var e=this.$range.siblings("input:first").data("name"),t=update_freq[e]||{};a[0].textContent=t.time||this.value}}).on("input",function(){var e="time",t=parseInt(this.value);a[0].textContent=t;var r=$(this).data("name"),n=update_freq[r]||{};changes.update_freq[r][e]=n[e]!==t,v()}),h.each(function(){var e=$(this),t=e.data("name"),r=(update_freq[t]||{}).time||e.val();e.val(r).trigger("change")}),d.each(function(){var e=$(this),t=e.data("name"),r=update_freq[t]||{};e.val(r.typ)}),d.on("change",function(){var e=$(this),t=e.data("name"),r=e.val(),n=update_freq[t]||{};changes.update_freq[t].typ=n.typ!==r,v()}),$.each(experts,function(r,e){var t=e.selection;if(-1<t.indexOf("all"))$("#experts-"+r+"-selection-all").trigger("click");else for(var n=0;n<t.length;n++){var s=t[n].toLowerCase();$("#experts-"+r+"-selection-"+s).trigger("click")}if("rank"===r||"ros"===r){var a=e.num;$.each(a,function(e,t){$("#experts-"+r+"-num-"+e).val(t)})}}),f.on("change",function(){var t,e="experts",r=$(this),n=r.attr("id").split("-"),s=n[1],a=n[2],i=n[3],c=experts[s][a],o=!1,p=r.siblings(".tooltip-error");if("num"===a){t=r.val();var l=0;"top"===i&&(l=1),!(t=Number(t))||!Number.isInteger(t)||t<=l?(r.tooltip("show"),o="error"):p.length&&r.tooltip("hide")}else if("selection"===a){var u=r.parents(".row").find(":input[type=checkbox]"),h=u.filter(function(){return/-all$/.test($(this).attr("id"))});if("all"===i)u.not(r).each(function(){var e=$(this);!0===e.prop("checked")&&(e.parents(".btn").removeClass("active"),e.prop("checked",!1))}),!0!==r.prop("checked")&&(r.parents(".btn").addClass("active"),r.prop("checked",!0));else if(!0===h.prop("checked")&&(h.parents(".btn").removeClass("active"),h.prop("checked",!1)),"rank"===s||"ros"===s){var d=r.parents("#experts-"+s+"-top");if(1===d.length)d.find(":input[type=checkbox]").not(r).each(function(){var e=$(this);!0===e.prop("checked")&&(e.parents(".btn").removeClass("active"),e.prop("checked",!1))})}var f=u.filter(function(){return!0===$(this).prop("checked")});0===f.length&&(h.parents(".btn").addClass("active"),h.prop("checked",!0),f=h),t=[],f.each(function(){t.push($(this).attr("id").split("-").pop())})}Array.isArray(t)&&Array.isArray(c)?(o=!(c.length===t.length&&c.every(function(e){return t.includes(e)})),changes[e][s][a]=o):("error"!==o&&(o=c[i]!==t),changes[e][s][a][i]=o),v()}),$.each(misc,function(e,t){$("#"+e).prop("checked",t)}),g.on("click","input",function(){var e=$(this),t=e.attr("id"),r=e.prop("checked");changes.misc[t]=misc[t]!==r,v()});var i=$(".settings").outerHeight(!0),c=$(".contact"),o=c.outerHeight(!0),p=c.outerHeight()-c.innerHeight();$(".changes").height(i-o-p)}),l.on("click",function(){l.text("Saving...");var e={fp_user_settings:{}},t=e.fp_user_settings,r={};$.each(columns,function(e,t){r[e]=$("#show"+e).prop("checked")}),t.columns=r;var a={};$.each(update_freq,function(e,t){var r=h.filter('[data-name="'+e+'"]').first(),n=parseInt(r.val().toString()),s=d.filter('[data-name="'+e+'"]').first().val();a[e]={time:n,typ:s}}),t.update_freq=a;var c={};$.each(experts,function(e,t){var r={},n=$("#experts-"+e),s=n.find(":checked"),a=[];if(s.each(function(){var e=$(this).attr("id").split("-").pop();a.push(e)}),r.selection=a,"rank"===e||"ros"===e){var i={};n.find("input[type=text]").each(function(){var e=$(this).attr("id").split("-").pop();i[e]=Number($(this).val())}),r.num=i}c[e]=r}),t.experts=c;var n={};$.each(misc,function(e,t){n[e]=$("#"+e).prop("checked")}),t.misc=n,ga("send","event","Settings","Changed","prev: "+JSON.stringify(user_settings)+"; Current: "+JSON.stringify(t)),chrome.storage.local.set(e,function(){l.text("-> Saved Successfully! <-"),l.attr("disabled","disabled"),columns=r,update_freq=a,experts=c,misc=n,check_recursive(changes,"set")})})});