"use strict";var user_settings={},columns={proj:!0,rank:!0,ros:!0,depth:!0,spark:!0,avg:!0,med:!0,current:!0},update_freq={player:{time:30,typ:"m"}},experts={proj:{selection:["all"]},rank:{selection:["all"],num:{top:10,updated:1}},ros:{selection:["all"],num:{top:5,updated:7}}},misc={remove_ads:!0,fix_css:!0},changes={};changes.columns=$.extend(!0,{},columns),changes.update_freq=$.extend(!0,{},update_freq),changes.experts=$.extend(!0,{},experts),changes.misc=$.extend(!0,{},misc);var has_change=!1;function check_recursive(a,b){for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];if($.isPlainObject(d))check_recursive(d,b);else if("set"===b)a[c]=!1;else if("check"===b)if(!0===d)has_change=!0;else if("error"===d){has_change="error";break}}}check_recursive(changes,"set");function is_changed(){check_recursive(changes,"check");var a=has_change;return has_change=!1,a}$(function(){function a(){var a=is_changed();"error"===a?(b.attr("disabled","disabled"),b.text("Save (fix errors)")):!0===a?(b.removeAttr("disabled"),b.text("Save")):(b.attr("disabled","disabled"),b.text("Save (no changes)"))}var b=$("#save");b.text("Loading...");var c=$("#columns"),d=$("input[type=\"range\"]"),e=$(".freq-typ"),f=$("#experts :input"),g=$("#misc");$("input[type=\"text\"][id$=top]").tooltip({placement:"bottom",trigger:"manual",template:"<div class=\"tooltip tooltip-error\" role=\"tooltip\"><div class=\"tooltip-arrow\"></div><div class=\"tooltip-inner\"></div></div>",title:"Must be an integer greater than 1"}),$("input[type=\"text\"][id$=updated]").tooltip({placement:"bottom",trigger:"manual",template:"<div class=\"tooltip tooltip-error\" role=\"tooltip\"><div class=\"tooltip-arrow\"></div><div class=\"tooltip-inner\"></div></div>",title:"Must be a positive integer"}),chrome.storage.local.get("fp_user_settings",function(h){if(b.text("Save (no changes)"),user_settings=h.fp_user_settings,(!user_settings||0>=Object.keys(user_settings).length)&&(user_settings={}),user_settings.hasOwnProperty("columns")){var i=user_settings.columns;$.each(i,function(a,b){columns[a]=b})}if(user_settings.hasOwnProperty("update_freq")){var j=user_settings.update_freq;$.each(j,function(a,b){update_freq[a]=b})}if(user_settings.hasOwnProperty("experts")){var k=user_settings.experts;$.each(k,function(a,b){experts[a]=b})}if(user_settings.hasOwnProperty("misc")){var l=user_settings.misc;$.each(l,function(a,b){misc[a]=b})}$.each(columns,function(a,b){$("#show"+a).prop("checked",b)}),c.on("click","input",function(){var b=$(this),c=b.attr("id").replace("show",""),d=b.prop("checked");changes.columns[c]=columns[c]!==d,a()});var m;d.rangeslider({polyfill:!1,onInit:function(){m=$(".rangeslider__handle",this.$range);var a=this.$range.siblings("input:first"),b=a.data("name"),c=update_freq[b]||{};m[0].textContent=c.time||this.value}}).on("input",function(){var b="time",c=parseInt(this.value);m[0].textContent=c;var d=$(this).data("name"),e=update_freq[d]||{};changes.update_freq[d][b]=e[b]!==c,a()}),d.each(function(){var a=$(this),b=a.data("name"),c=update_freq[b]||{},d=c.time||a.val();a.val(d).trigger("change")}),e.each(function(){var a=$(this),b=a.data("name"),c=update_freq[b]||{};a.val(c.typ)}),e.on("change",function(){var b="typ",c=$(this),d=c.data("name"),e=c.val(),f=update_freq[d]||{};changes.update_freq[d][b]=f[b]!==e,a()}),$.each(experts,function(c,a){var b=a.selection;if(-1<b.indexOf("all"))$("#experts-"+c+"-selection-all").trigger("click");else for(var d,f=0;f<b.length;f++)d=b[f].toLowerCase(),$("#experts-"+c+"-selection-"+d).trigger("click");if("rank"===c||"ros"===c){var g=a.num;$.each(g,function(d,a){$("#experts-"+c+"-num-"+d).val(a)})}}),f.on("change",function(){var b,c=$(this),d=c.attr("id").split("-"),e=d[1],f=d[2],g=d[3],h=experts[e][f],i=!1,j=c.siblings(".tooltip-error");if("num"===f){b=c.val(),b=+b;var k=0;"top"===g&&(k=1),b&&Number.isInteger(b)&&!(b<=k)?j.length&&c.tooltip("hide"):(c.tooltip("show"),i="error")}else if("selection"===f){var l=c.parents(".row").find(":input[type=checkbox]"),m=l.filter(function(){return /-all$/.test($(this).attr("id"))});if("all"===g)l.not(c).each(function(){var a=$(this);!0===a.prop("checked")&&(a.parents(".btn").removeClass("active"),a.prop("checked",!1))}),!0!==c.prop("checked")&&(c.parents(".btn").addClass("active"),c.prop("checked",!0));else if(!0===m.prop("checked")&&(m.parents(".btn").removeClass("active"),m.prop("checked",!1)),"rank"===e||"ros"===e){var n=c.parents("#experts-"+e+"-top");if(1===n.length){var o=n.find(":input[type=checkbox]").not(c);o.each(function(){var a=$(this);!0===a.prop("checked")&&(a.parents(".btn").removeClass("active"),a.prop("checked",!1))})}}var p=l.filter(function(){return!0===$(this).prop("checked")});0===p.length&&(m.parents(".btn").addClass("active"),m.prop("checked",!0),p=m),b=[],p.each(function(){b.push($(this).attr("id").split("-").pop())})}Array.isArray(b)&&Array.isArray(h)?(i=!(h.length===b.length&&h.every(function(a){return b.includes(a)})),changes.experts[e][f]=i):("error"!==i&&(i=h[g]!==b),changes.experts[e][f][g]=i),a()}),$.each(misc,function(a,b){$("#"+a).prop("checked",b)}),g.on("click","input",function(){var b=$(this),c=b.attr("id"),d=b.prop("checked");changes.misc[c]=misc[c]!==d,a()});var n=$(".settings").outerHeight(!0),o=$(".contact"),p=o.outerHeight(!0),q=o.outerHeight()-o.innerHeight();$(".changes").height(n-p-q)}),b.on("click",function(){b.text("Saving...");var a={fp_user_settings:{}},c=a.fp_user_settings,f={};$.each(columns,function(a){f[a]=$("#show"+a).prop("checked")}),c.columns=f;var g={};$.each(update_freq,function(a){var b=d.filter("[data-name=\""+a+"\"]").first(),c=parseInt(b.val().toString()),f=e.filter("[data-name=\""+a+"\"]").first(),h=f.val();g[a]={time:c,typ:h}}),c.update_freq=g;var h={};$.each(experts,function(a){var b={},c=$("#experts-"+a),d=c.find(":checked"),e=[];if(d.each(function(){var a=$(this).attr("id").split("-").pop();e.push(a)}),b.selection=e,"rank"===a||"ros"===a){var f={},g=c.find("input[type=text]");g.each(function(){var a=$(this).attr("id").split("-").pop();f[a]=+$(this).val()}),b.num=f}h[a]=b}),c.experts=h;var i={};$.each(misc,function(a){i[a]=$("#"+a).prop("checked")}),c.misc=i,ga("send","event","Settings","Changed","prev: "+JSON.stringify(user_settings)+"; Current: "+JSON.stringify(c)),chrome.storage.local.set(a,function(){b.text("-> Saved Successfully! <-"),b.attr("disabled","disabled"),columns=f,update_freq=g,experts=h,misc=i,check_recursive(changes,"set")})})});